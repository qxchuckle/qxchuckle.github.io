<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><script>if ('serviceWorker' in navigator) {
  if (Number(window.localStorage.getItem('ChenBlogHelper_Set')) < 1) {
    (async()=>{window.stop()})()
    window.localStorage.setItem('ChenBlogHelper_Set', 1)
  }
  navigator.serviceWorker.register('/giggles.js')
    .then(async () => {
      if (Number(window.localStorage.getItem('ChenBlogHelper_Set')) < 2) {
        window.localStorage.setItem('ChenBlogHelper_Set', 2)
        setTimeout(() => {
          window.location.reload()
        }, 150)
      }
    })
}
//- function setQXCookies(obj, limitTime, customDomain) {
//-     let data = new Date(new Date().getTime() + limitTime * 24 * 60 * 60 * 1000).toGMTString();
//-     for (let i in obj) {
//-       document.cookie = i + '=' + obj[i] + ';expires=' + data + ';domain=' + customDomain;
//-     }
//- }
//- function getQXCookie(name) {
//-     var arr, reg = new RegExp("(^| )" + name + "=([^;]*)(;|$)");
//-     if (arr = document.cookie.match(reg))
//-         return decodeURIComponent(arr[2]);
//-     else
//-         return null;
//- }
//- if(getQXCookie('qcqx')!=="chuckle"){
//-   setQXCookies({ qcqx: 'chuckle' }, 365, 'qcqx.cn');
//- }else{
//-   console.log("qcqx");
//- }</script><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"><title>TypeScript笔记 | 轻笑Chuckle</title><meta name="keywords" content="前端,TypeScript"><meta name="author" content="『轻笑Chuckle』"><meta name="copyright" content="『轻笑Chuckle』"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="baidu-site-verification" content="codeva-BLXfA46XrF"><meta name="description" content="TypeScript，用起来折磨但确实方便">
<meta property="og:type" content="article">
<meta property="og:title" content="TypeScript笔记">
<meta property="og:url" content="https://www.qcqx.cn/article/9d362be7.html">
<meta property="og:site_name" content="轻笑Chuckle">
<meta property="og:description" content="TypeScript，用起来折磨但确实方便">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/59-1.webp">
<meta property="article:published_time" content="2023-05-17T02:37:54.000Z">
<meta property="article:modified_time" content="2023-11-27T02:37:54.000Z">
<meta property="article:author" content="『轻笑Chuckle』">
<meta property="article:tag" content="前端">
<meta property="article:tag" content="TypeScript">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/59-1.webp"><link rel="shortcut icon" href="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp"><link rel="canonical" href="https://www.qcqx.cn/article/9d362be7"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/css/index.css?285"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/css/fontawesome.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/css/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.json","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":160},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#49b1f5","bgDark":"#1f1f1f","position":"top-left"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery@2/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'TypeScript笔记',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2023-11-27 10:37:54'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          const now = new Date()
          const hour = now.getHours()
          const isNight = hour <= 6 || hour >= 18
          if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
          else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><!-- hexo injector head_end start --><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hexo-butterfly-tag-plugins-plus@latest/lib/assets/font-awesome-animation.min.css" media="defer" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/css/tag_plugins.css" media="defer" onload="this.media='all'"><!-- hexo injector head_end end --><meta name="generator" content="Hexo 5.4.1"><link rel="alternate" href="/atom.xml" title="轻笑Chuckle" type="application/atom+xml">
</head><body><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp"/></div></div><div id="web_bg"></div><div id="svg_bg"></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="is-center" id="sidebar-avatar"><div class="avatar-img"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.gif'" alt="avatar"/></div><div class="author-info__name">『轻笑Chuckle』</div><div class="author-info__description">漫天倾尘 风中轻笑</div></div><div class="site-data is-center"><div class="data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a></div><div class="data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a></div><div class="data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qxchuckle"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="menu-info-social-icons is-center"><a class="social-icon" href="https://blog.csdn.net/qxchuckle" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="https://gitee.com/qxchuckle" target="_blank" title="Gitee"><i class="iconfont icon-gitee"></i></a><a class="social-icon" href="https://space.bilibili.com/353049313" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=1395730595" target="_blank" title="网易云"><i class="iconfont icon-wangyiyunyinle"></i></a><a class="social-icon" href="http://www.coolapk.com/u/4137393" target="_blank" title="酷安"><i class="iconfont icon-kuan"></i></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-wenzhang"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-bendiwenjianjia"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw iconfont icon-suijiceliang"></i><span> 随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongji"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-_lianjie"></i><span> 空间</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw iconfont icon-pengyouquan"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/bb/"><i class="fa-fw iconfont icon-shejiao"></i><span> 哔哔</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-fasong-"></i><span> 其它</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/update/"><i class="fa-fw iconfont icon-yuangongrizhi"></i><span> 日志</span></a></li><li><a class="site-page child" href="/agreement/"><i class="fa-fw iconfont icon-yinsixieyi"></i><span> 协议</span></a></li><li><a class="site-page child" href="/atom.xml" target="_blank"><i class="fa-fw iconfont icon-RSS"></i><span> RSS</span></a></li><li><a class="site-page child" href="/sitemap.xml" target="_blank"><i class="fa-fw iconfont icon-ditu"></i><span> Sitemap</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw iconfont icon-liuyanban"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-aixin"></i><span> 关于我</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><div id="nav-group"><div id="chuckle_home"><div class="back-home-button"><i class="back-home-button-icon fas fa-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">传送门</div><div class="back-menu-list"><a class="back-menu-item" href="/" title="前往博客主页" target="_blank"><img class="back-menu-item-icon entered loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp" loading="lazy"/><span class="back-menu-item-text">博客主页</span></a><a class="back-menu-item" href="https://waline.qcqx.cn/ui" rel="external nofollow" title="前往评论后端" target="_blank"><img class="back-menu-item-icon entered loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/c4.webp" loading="lazy"/><span class="back-menu-item-text">评论管理</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">博客线路</div><div class="back-menu-list"><a class="back-menu-item" href="https://www.qcqx.cn/" title="前往博客主站" target="_blank" rel="noopener nofollow"><img class="back-menu-item-icon entered loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/h4.webp" loading="lazy"/><span class="back-menu-item-text">主域名线路</span></a><a class="back-menu-item" href="https://qxchuckle.github.io" title="前往博客Github线路" target="_blank" rel="noopener nofollow"><img class="back-menu-item-icon entered loading" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/c6.webp" loading="lazy"/><span class="back-menu-item-text">Github线路</span></a></div></div></div></div></div><span id="blog_name"><a id="site-name" href="/">轻笑Chuckle</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw iconfont icon-zhuye"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-wenzhang"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/archives/"><i class="fa-fw iconfont icon-bendiwenjianjia"></i><span> 归档</span></a></li><li><a class="site-page child" href="/categories/"><i class="fa-fw iconfont icon-fenlei1"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw iconfont icon-biaoqian1"></i><span> 标签</span></a></li><li><a class="site-page child" href="javascript:toRandomPost();"><i class="fa-fw iconfont icon-suijiceliang"></i><span> 随机文章</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/charts/"><i class="fa-fw iconfont icon-tongji"></i><span> 统计</span></a></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-_lianjie"></i><span> 空间</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/link/"><i class="fa-fw iconfont icon-lianjie"></i><span> 友链</span></a></li><li><a class="site-page child" href="/fcircle/"><i class="fa-fw iconfont icon-pengyouquan"></i><span> 朋友圈</span></a></li><li><a class="site-page child" href="/bb/"><i class="fa-fw iconfont icon-shejiao"></i><span> 哔哔</span></a></li></ul></div><div class="menus_item"><a class="site-page group hide" href="javascript:void(0);"><i class="fa-fw iconfont icon-fasong-"></i><span> 其它</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/update/"><i class="fa-fw iconfont icon-yuangongrizhi"></i><span> 日志</span></a></li><li><a class="site-page child" href="/agreement/"><i class="fa-fw iconfont icon-yinsixieyi"></i><span> 协议</span></a></li><li><a class="site-page child" href="/atom.xml" target="_blank"><i class="fa-fw iconfont icon-RSS"></i><span> RSS</span></a></li><li><a class="site-page child" href="/sitemap.xml" target="_blank"><i class="fa-fw iconfont icon-ditu"></i><span> Sitemap</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw iconfont icon-liuyanban"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw iconfont icon-aixin"></i><span> 关于我</span></a></div></div><div id="buttons"><div id="switch-bg"><a class="site-page social-icon search" href="javascript:;" rel="noopener external nofollow" onclick="toggleWinbox()" title="切换背景-换一种感觉。"><i class="fas fa-images fa-fw"></i></a></div><div id="switch-darkmode"><a class="site-page social-icon" onclick="kk.switchDarkMode()" title="切换模式"><i class="fas fa-adjust fa-fw"></i></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info" style="background-image: url('https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/59-1.webp')"><div id="post-meta-top"><span class="post-categories"><i class="iconfont icon-fenlei fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">学习笔记</a></span><span class="post-tags"><a class="post-meta-tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta-tags" href="/tags/TypeScript/">TypeScript</a></span></div><h1 class="post-title">TypeScript笔记<a class="post-share" id="share-post" href="javascript:;" rel="noopener external nofollow" onclick="kk.postURL()"><i class="fa fa-share-alt"></i></a></h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="iconfont icon-shalou fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-05-17T02:37:54.000Z" title="发表于 2023-05-17 10:37:54">2023-05-17</time></span><span class="post-meta-date"><i class="iconfont icon-gengxin fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-11-27T02:37:54.000Z" title="更新于 2023-11-27 10:37:54">2023-11-27</time></span></div><div class="meta-secondline"><span class="post-meta-wordcount"><i class="iconfont icon-tongji1 fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">20k</span></span><span class="post-meta-wordcount"><i class="iconfont icon-tubiaozhizuomoban- fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>86分钟</span></span><span class="leancloud_visitors" id="/article/9d362be7.html" data-flag-title="TypeScript笔记"><i class="iconfont icon-yanjing fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span class="leancloud-visitors-count"></span></span><span class="post-meta-commentcount"><i class="iconfont icon-pinglun fa-fw post-meta-icon"></i><span class="post-meta-label">评论数:</span><a href="/article/9d362be7.html#post-comment"><span class="waline-comment-count" id="/article/9d362be7.html"></span></a></span></div></div></div><article class="post-content" id="article-container"><div class="Copyright-Notice" id="Copyright-Notice"><div id="post-Copyright-bar"></div><div id="Copyright-box"><span>本站博文未在任何平台</span><span class="copyright-phone-none">以任何形式</span><span>售卖，详情:</span><a href="/agreement/">协议</a></div></div><h1 id="初识"><a href="#初识" class="headerlink" title="初识"></a>初识</h1><p><a target="_blank" rel="noopener" href="https://www.tslang.cn/index.html">TypeScript</a> 是由巨硬开发的 <strong>JS 的超集</strong>，通过添加可选的静态类型和基于类的面向对象编程思想，使得代码更易于理解、维护和重构。此外，<strong>TS</strong> 还支持其他高级语言功能，如接口、泛型、命名空间和装饰器等</p>
<p><strong>规范：</strong>TS 提供了更好的类型检查和代码提示工具，并且可以使用第三方库中的类型声明文件进行代码补全和类型检查</p>
<p><strong>开发：</strong>TS 为现代Web应用程序和大型项目提供了一个强大的编程环境，可以帮助开发人员减少错误、提高开发效率和代码质量</p>
<p><strong>运行：</strong>TS 可以转换成 JS 并在任何支持 JS 的环境中运行，包括浏览器、Node.js和移动应用程序等</p>
<p><strong>安装：</strong><code>npm install typescript -g</code> 会在全局暴露一个 <strong>tsc</strong> 命令</p>
<p><code>tsc -init</code> 初始化，创建 <strong>tsconfig.json</strong></p>
<p><code>tsc -w</code> 监视所有 TS 文件变化，实时编译成 JS</p>
<p><code>npm install ts-node -g</code> 安装 <strong>ts-node</strong> 更方便地运行 TS</p>
<h1 id="配置文件"><a href="#配置文件" class="headerlink" title="配置文件"></a>配置文件</h1><p><strong>tsconfig.json</strong> 是 TS 的配置文件</p>
<p>可以定义哪些文件需要包含在编译过程中、使用哪个ECMAScript目标版本、生成哪种模块系统、是否开启严格模式等等</p>
<p><strong>常用配置项：</strong></p>
<ol>
<li><strong>target</strong> 设置编译后的 JavaScript 代码使用的 ECMAScript 版本，默认为 ES3，可设置为 ES5、ES6/ES2015、ES7 等。</li>
<li><strong>strict</strong> 开启所有严格类型检查选项，包括noImplicitAny，noImplicitThis，alwaysStrict等等。如果希望 TypeScript 给出尽可能多的类型检查错误提示，可以将此选项设置为 true。</li>
<li><strong>module</strong> 指定生成的模块规范类型，可选值有 commonjs、amd、system 和 es2015。</li>
<li><strong>lib</strong> 指定编译过程中需要引入的库文件，默认情况下只包含 DOM 和 ES 标准库，可以通过指定其他库来获得更好的类型检查支持。</li>
<li><strong>moduleResolution</strong> 指定模块解析策略，可选值有 classic、node、和 yarn pnp。</li>
<li><strong>esModuleInterop</strong> 简化导入cjs模块功能</li>
<li><strong>outDir</strong> 输出目录，指定编译后的 JavaScript 代码所在的目录。</li>
<li><strong>rootDir</strong> 项目根目录</li>
<li><strong>allowJs</strong> 允许编译器编译 .js 文件（通常是为了容易迁移现有的 JavaScript 项目到 TypeScript 项目）</li>
<li><strong>sourceMap</strong> 生成 sourcemap 文件，方便调试 TypeScript 代码时能够正确地映射回原始的 TypeScript 代码。</li>
<li><strong>noImplicitAny</strong> 当 TypeScript 无法推导出变量的类型时，给出一个错误提醒</li>
<li><strong>noImplicitThis</strong> 禁止 this 关键字的隐式 any 类型</li>
<li><strong>strictNullChecks</strong> 严格模式下对 null 和 undefined 的检查。</li>
</ol>
<h1 id="TS检查相关注释"><a href="#TS检查相关注释" class="headerlink" title="TS检查相关注释"></a>TS检查相关注释</h1><p>(1) <code>// @ts-nocheck</code> 加到文件首行，当前文件不需要 ts 校验<br>(2) <code>// @ts-check</code> 加到文件首行，对当前文件进行 ts 校验<br>(3) <code>// @ts-ignore</code> 忽略下一行代码的 ts 校验<br>(4) <code>// eslint-disable-next-line</code> 忽略下一行代码的 eslint 校验<br>(5) <code>/* eslint-disable */</code> eslint忽略</p>
<h1 id="类型标注"><a href="#类型标注" class="headerlink" title="类型标注"></a>类型标注</h1><p>通过 <code>&lt;数据&gt;:&lt;类型&gt;</code> 对变量、函数返回值、函数参数等数据进行类型的标注、限制</p>
<p><strong>思想：</strong>定义任何东西的时候要注明类型，调用任何东西的时候要检查类型。</p>
<p>可以标注的类型：<br>(1) <strong>基础类型：</strong>Boolean、Number、String、null、undefined 以及 ES6 的 Symbol 和 ES10 的 BigInt。<br>(2) <strong>空值</strong>：Void<br>(3) <strong>顶级类型：</strong>任意类型 Any 和 不知道的类型 Unknown<br>(4) Object、object 和 {}<br>(5) <strong>接口和对象类型：</strong>interface定义<br>(6) <strong>数组类型</strong><br>(7) <strong>函数类型</strong></p>
<h2 id="基本类型"><a href="#基本类型" class="headerlink" title="基本类型"></a>基本类型</h2><p><strong>1、字符串类型：string</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span> = <span class="string">&quot;chuckle&quot;</span>;</span><br><span class="line">str = <span class="string">`1+1=<span class="subst">$&#123;<span class="number">1</span>+<span class="number">1</span>&#125;</span>`</span>; <span class="comment">// 可以使用模板字符串</span></span><br><span class="line">str = <span class="string">&quot;1+1=&quot;</span> + <span class="string">&quot;2&quot;</span>; <span class="comment">// 可以拼接</span></span><br></pre></td></tr></table></figure>
<p><strong>2、数字类型：number</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">number</span> = <span class="number">1</span></span><br><span class="line">num = <span class="title class_">NaN</span></span><br><span class="line">num = <span class="title class_">Infinity</span></span><br><span class="line">num = <span class="number">0xf00d</span> <span class="comment">// 十六进制</span></span><br><span class="line">num = <span class="number">0b1010</span> <span class="comment">// 二进制</span></span><br></pre></td></tr></table></figure>
<p><strong>3、布尔类型：boolean</strong></p>
<p><strong>注意：</strong>new Boolean() 返回的是一个 Boolean 对象，而不是布尔值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">bool</span>: <span class="built_in">boolean</span> = <span class="literal">true</span></span><br><span class="line">bool = <span class="title class_">Boolean</span>(<span class="number">0</span>) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p><strong>4、Null 和 undefined 类型</strong></p>
<p>undefined 和 null 是所有类型的<strong>子类型</strong>，在<strong>非严格模式</strong>下可以赋给其它<strong>任何类型</strong>的变量</p>
<p><strong>严格模式下：</strong><br>(1) undefined 和 null 不能赋给其它类型的变量，但 undefined 可以赋给 void 类型（一般也用不到）<br>(2) null 和 undefined 类型也不能相互赋值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="literal">null</span> = <span class="literal">null</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="literal">undefined</span> =  <span class="literal">undefined</span></span><br><span class="line">a = b <span class="comment">// 严格模式下不允许</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span> = a <span class="comment">// 严格模式下不允许</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">c</span>: <span class="built_in">void</span> = <span class="literal">null</span> <span class="comment">// 严格模式下不允许</span></span><br><span class="line">c = <span class="literal">undefined</span> <span class="comment">// 始终允许</span></span><br></pre></td></tr></table></figure>
<h2 id="空值void"><a href="#空值void" class="headerlink" title="空值void"></a>空值void</h2><p>JS 中没有空值的概念，TS 中可以使用 void 表示函数无返回值</p>
<p><strong>注意：</strong><br>(1) 不能将 void 赋给除 any 外其它类型的变量。<br>(2) 使用 any 类型的变量接收函数返回的空值，打印 undefined<br>(3) Boolean(void) 值是 false</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params"></span>): <span class="built_in">void</span>&#123;&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">any</span> = <span class="title function_">fun</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// undefined</span></span><br><span class="line">a = <span class="title class_">Boolean</span>(<span class="title function_">fun</span>());</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a); <span class="comment">// false</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="built_in">string</span> = <span class="title function_">fun</span>() <span class="comment">// 不允许</span></span><br></pre></td></tr></table></figure>
<h2 id="any和unknown"><a href="#any和unknown" class="headerlink" title="any和unknown"></a>any和unknown</h2><p>any 和 unknown 是 TS 中的顶级类型，可以包含所有类型的数据</p>
<p>如果所有变量都是 any 类型，那就是 AnyScript，写起来和 JS 没什么区别，最好不要这么做</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">any</span> = <span class="number">1</span>;</span><br><span class="line">a = <span class="string">&quot;qx&quot;</span></span><br><span class="line">a = <span class="literal">true</span></span><br><span class="line">a = <span class="literal">null</span></span><br></pre></td></tr></table></figure>
<p><strong>any 与 unknown 的区别：</strong><br>any 可以赋给其它类型，而 unknown 不能赋值给除 any 和 unknown 以外的其它类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">any</span> = <span class="number">1</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: unknown = <span class="number">2</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">num</span>: <span class="built_in">number</span> = a <span class="comment">// any可以赋给其它类型</span></span><br><span class="line">a = b <span class="comment">// unknown可以赋给any</span></span><br><span class="line">num = b <span class="comment">// unknown不能赋给其它类型</span></span><br></pre></td></tr></table></figure>
<p>unknown 类型不能读任何元素、属性，也不能调用任何方法，所以 unknown 比 any 安全</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">u</span>: unknown = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(u); <span class="comment">// 可以</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(u.<span class="property">a</span>); <span class="comment">// 错误</span></span><br><span class="line">u =  <span class="function">()=&gt;</span>&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;@@&#x27;</span>) &#125;</span><br><span class="line"><span class="title function_">u</span>() <span class="comment">// 错误</span></span><br></pre></td></tr></table></figure>
<h2 id="Object、object和"><a href="#Object、object和" class="headerlink" title="Object、object和{}"></a>Object、object和{}</h2><p>Object、object 和 {} 虽然能保存的数据类型不同，但都和 <strong>unknown</strong> 类型一样，不能读任何元素、属性，也不能调用任何方法</p>
<p><strong>1、</strong>Object 类型是所有 Object 类的实例的类型，字面量 {} 代表的也是 Object</p>
<p>由于原型链顶层就是 Object，所有基本数据类型和引用类型最终都指向 Object，所以他也包含所有类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>: <span class="title class_">Object</span> = <span class="number">1</span>;</span><br><span class="line">obj = <span class="string">&quot;chuckle&quot;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj); <span class="comment">// chuckle</span></span><br><span class="line">obj = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(obj.<span class="property">a</span>); <span class="comment">// 报错：类型Object上不存在属性a</span></span><br></pre></td></tr></table></figure>
<p><strong>2、</strong>object 代表所有<strong>非值类型</strong>的类型（数组、对象、函数）等，常用于泛型约束</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">o</span>: <span class="built_in">object</span> = <span class="function">()=&gt;</span>&#123; <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;@@&#x27;</span>) &#125;</span><br><span class="line"><span class="title function_">o</span>() <span class="comment">// 此表达式不可调用。类型&#123;&#125;没有调用签名</span></span><br><span class="line">o = [<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;2&#x27;</span>]</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o[<span class="number">1</span>]) <span class="comment">// 错误</span></span><br><span class="line">o = &#123; <span class="attr">a</span>: <span class="number">1</span> &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(o) <span class="comment">// 报错：类型object上不存在属性a</span></span><br></pre></td></tr></table></figure>
<h2 id="接口和对象类型"><a href="#接口和对象类型" class="headerlink" title="接口和对象类型"></a>接口和对象类型</h2><p>在 TypeScript 中，使用接口（Interfaces）来定义对象的类型。</p>
<p>即使用 <strong>interface</strong> 来定义一种对对象的约束</p>
<p>接口是一个非常灵活的概念，除了可用于对类的一部分<strong>行为</strong>进行抽象外，也常用于<strong>对象的形状</strong>的描述。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 定义一个对象</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 必须按照定义的形状来声明</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">person</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1、重名的接口会合并，共同起作用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">person</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>2、任意属性 [propName: string] (索引签名)</p>
<p>声明的对象中可以有任意个数所定义的类型（或其子类型）的属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  [<span class="attr">propName</span>: <span class="built_in">string</span>]: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">person</span>: <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">  <span class="comment">// 接下来可以有任意个数any类型的属性</span></span><br><span class="line">  <span class="attr">a</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">b</span>: <span class="string">&quot;qx&quot;</span>,</span><br><span class="line">  <span class="title function_">c</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">a</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3、readonly 让属性只读</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4、定义对象中的函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">fun</span>: <span class="function">(<span class="params">value:<span class="built_in">number</span></span>)=&gt;</span><span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6、接口继承 extends</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> A&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> B <span class="keyword">extends</span> A&#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: B = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="数组类型"><a href="#数组类型" class="headerlink" title="数组类型"></a>数组类型</h2><p>使用 <code>:&lt;元素类型&gt;[]</code> 来定义一个数组</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] <span class="comment">// 定义数值类型的数组</span></span><br></pre></td></tr></table></figure>
<p>使用泛型的方式定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt;</span><br></pre></td></tr></table></figure>
<p>定义二维数组</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="built_in">number</span>[][]</span><br><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: <span class="title class_">Array</span>&lt;<span class="title class_">Array</span>&lt;<span class="built_in">number</span>&gt;&gt;</span><br></pre></td></tr></table></figure>
<p>定义包含多种类型的数组</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: (<span class="built_in">number</span>|<span class="built_in">string</span>)[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="string">&#x27;3&#x27;</span>, <span class="number">4</span>]</span><br></pre></td></tr></table></figure>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><p>元组：赋值时，元素的类型、位置、个数必须一一对应</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">arr</span>: [<span class="built_in">number</span>,<span class="built_in">string</span>] = [<span class="number">1</span>,<span class="string">&#x27;qx&#x27;</span>]</span><br></pre></td></tr></table></figure>
<p>允许起名加上可选修饰符，对于越界的元素他的类型被限制为联合类型，也就是可以push已有的元素类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>: [<span class="attr">x</span>: <span class="built_in">number</span>, y?: <span class="built_in">boolean</span>] = [<span class="number">1</span>, <span class="literal">true</span>]</span><br><span class="line">arr.<span class="title function_">push</span>(<span class="number">1</span>) <span class="comment">// 允许push已有的元素类型</span></span><br><span class="line">arr.<span class="title function_">push</span>(<span class="string">&quot;1&quot;</span>) <span class="comment">// 类型“&quot;1&quot;”的参数不能赋给类型“number | boolean | undefined”的参数。</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(arr)</span><br></pre></td></tr></table></figure>
<p>可以用于表格数据的约束</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">excel</span>: [<span class="attr">name</span>: string, <span class="attr">sex</span>: string, <span class="attr">age</span>: number][] = [</span><br><span class="line">  [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">18</span>],</span><br><span class="line">  [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">18</span>],</span><br><span class="line">  [<span class="string">&#x27;张三&#x27;</span>, <span class="string">&#x27;男&#x27;</span>, <span class="number">18</span>]</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
<h2 id="函数类型与定义"><a href="#函数类型与定义" class="headerlink" title="函数类型与定义"></a>函数类型与定义</h2><p>定义一个函数类型变量</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">fun</span>: <span class="title class_">Function</span></span><br><span class="line">fun = <span class="function">()=&gt;</span>&#123;&#125;</span><br></pre></td></tr></table></figure>
<p>定义函数的参数和返回值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params">a:<span class="built_in">number</span>, b:<span class="built_in">number</span></span>):<span class="built_in">number</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> a+b;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title function_">fun</span>(<span class="number">1</span>,<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<p>使用 interface 定义函数类型（函数也是一种对象）</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Fn</span> &#123;</span><br><span class="line">  <span class="comment">// 只有一个string类型的参数，返回值是数值类型</span></span><br><span class="line">  (<span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">fun</span>: <span class="title class_">Fn</span> = <span class="function">(<span class="params">name</span>)=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(name)</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fun</span>(<span class="string">&quot;chuckle&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>TS 可以定义函数中的 this 类型，用于增强补全，必须写在函数的第一个参数上，不作为真正的参数定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Obj</span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="comment">// TS可以定义this的类型（一般用于增强补全），必须在第一个参数上定义</span></span><br><span class="line">  <span class="attr">add</span>: <span class="function">(<span class="params"><span class="variable language_">this</span>:Obj, num:<span class="built_in">number</span></span>)=&gt;</span><span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>:<span class="title class_">Obj</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="title function_">add</span>(<span class="params">num:<span class="built_in">number</span></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(num);</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">    <span class="comment">// 此时this.就会有补全</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.<span class="title function_">add</span>(<span class="number">1</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="可选符"><a href="#可选符" class="headerlink" title="?可选符"></a>?可选符</h1><p>使用 <code>?:</code> 定义函数参数或对象属性作为可选项</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span>&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="title class_">String</span>,</span><br><span class="line">  age?: <span class="built_in">number</span>, <span class="comment">// 年龄可选</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二个b参数可选</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params">a:<span class="built_in">number</span>, b?:<span class="built_in">number</span></span>):<span class="built_in">number</span>&#123;</span><br><span class="line">  <span class="keyword">return</span> b ? a+b : a;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h1><p>使用 <code>&lt;类型1&gt;|&lt;类型2&gt;</code> 标注多个类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数可传入两种参数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params">a: <span class="built_in">number</span> | <span class="built_in">string</span></span>) &#123; &#125;</span><br><span class="line"><span class="comment">// 可保存两种类型的变量</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: <span class="built_in">number</span> | <span class="built_in">string</span></span><br></pre></td></tr></table></figure>
<h1 id="交叉类型"><a href="#交叉类型" class="headerlink" title="交叉类型"></a>交叉类型</h1><p><code>&lt;类型1&gt;&amp;&lt;类型2&gt;</code> 需同时满足两种类型，通常配合接口使用</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Student</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">id</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">p</span>: <span class="title class_">Student</span> &amp; <span class="title class_">Person</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span>,</span><br><span class="line">  <span class="attr">id</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h1 id="类型断言"><a href="#类型断言" class="headerlink" title="类型断言"></a>类型断言</h1><p><code>值 as 类型</code>或<code>&lt;类型&gt;值</code> 欺骗 TypeScript 编译器，但无法避免运行时的错误</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">fun</span>(<span class="params">a: <span class="built_in">number</span> | <span class="built_in">string</span></span>)&#123;</span><br><span class="line">  <span class="comment">// console.log(a.length); // 数值类型没.length方法，会报错</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>((&lt;<span class="built_in">string</span>&gt;a).<span class="property">length</span>); <span class="comment">// 断言a一定是string类型</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="title function_">fun</span>(<span class="number">123</span>) <span class="comment">// undefined</span></span><br><span class="line"><span class="title function_">fun</span>(<span class="string">&#x27;123&#x27;</span>) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure>
<p>TS 直接在 window 上添加属性是不允许的，但可以将 window 断言为 any 类型，就可以添加属性了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable language_">window</span>.<span class="property">a</span> = <span class="number">1</span>; <span class="comment">// 不可以</span></span><br><span class="line">(&lt;<span class="built_in">any</span>&gt;<span class="variable language_">window</span>).<span class="property">a</span> = <span class="number">1</span>; <span class="comment">// 断言成any就可以了</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>((&lt;<span class="built_in">any</span>&gt;<span class="variable language_">window</span>).<span class="property">a</span>);</span><br></pre></td></tr></table></figure>
<h1 id="内置对象"><a href="#内置对象" class="headerlink" title="内置对象"></a>内置对象</h1><p>JS 中有很多内置对象，它们可以直接在 TS 中当做定义好了的类型来使用</p>
<p><strong>1、ECMAScript 的内置对象：</strong>内置对象名就是类型名</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">b</span>: <span class="title class_">Boolean</span> = <span class="keyword">new</span> <span class="title class_">Boolean</span>(<span class="number">1</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(b)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">n</span>: <span class="title class_">Number</span> = <span class="keyword">new</span> <span class="title class_">Number</span>(<span class="literal">true</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(n)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: <span class="title class_">String</span> = <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&#x27;chuckle&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(s)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="title class_">Date</span> = <span class="keyword">new</span> <span class="title class_">Date</span>()</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(d)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">r</span>: <span class="title class_">RegExp</span> = <span class="regexp">/^123/</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(r)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">e</span>: <span class="title class_">Error</span> = <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;error&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(e)</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>2、DOM 和 BOM 的内置对象：</strong><br><code>HTML&lt;标签名&gt;Element</code> 某个内置标签的类型，input、span 等<br><code>HTMLElement</code> 语义化的标签名，footer、header，以及自定义标签名<br><code>Element</code> 任何标签元素的类型<br><code>NodeList</code> 任何元素集合的类型<br><code>NodeListOf&lt;其它类型&gt;</code> 指定元素集合的类型</p>
<p>由于元素可能获取不到，要加上 null 组成联合类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">div1</span>: <span class="title class_">HTMLInputElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;input&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">div2</span>: <span class="title class_">HTMLDivElement</span> | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;div&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">div3</span>: <span class="title class_">NodeListOf</span>&lt;<span class="title class_">HTMLElement</span>&gt; | <span class="literal">null</span> = <span class="variable language_">document</span>.<span class="title function_">querySelectorAll</span>(<span class="string">&#x27;.content&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> <span class="attr">local</span>: <span class="built_in">string</span> | <span class="literal">null</span> = <span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(<span class="string">&#x27;token&#x27;</span>)</span><br><span class="line"><span class="keyword">let</span> <span class="attr">lct</span>: <span class="title class_">Location</span>  = location</span><br><span class="line"><span class="keyword">let</span> <span class="attr">pms</span>: <span class="title class_">Promise</span>&lt;<span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Promise</span>(<span class="function">(<span class="params">r</span>)=&gt;</span><span class="title function_">r</span>(<span class="number">1</span>))</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//dom元素的映射表</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">HTMLElementTagNameMap</span> &#123;</span><br><span class="line">  <span class="string">&quot;a&quot;</span>: <span class="title class_">HTMLAnchorElement</span>;</span><br><span class="line">  <span class="string">&quot;abbr&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;address&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;applet&quot;</span>: <span class="title class_">HTMLAppletElement</span>;</span><br><span class="line">  <span class="string">&quot;area&quot;</span>: <span class="title class_">HTMLAreaElement</span>;</span><br><span class="line">  <span class="string">&quot;article&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;aside&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;audio&quot;</span>: <span class="title class_">HTMLAudioElement</span>;</span><br><span class="line">  <span class="string">&quot;b&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;base&quot;</span>: <span class="title class_">HTMLBaseElement</span>;</span><br><span class="line">  <span class="string">&quot;bdi&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;bdo&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;blockquote&quot;</span>: <span class="title class_">HTMLQuoteElement</span>;</span><br><span class="line">  <span class="string">&quot;body&quot;</span>: <span class="title class_">HTMLBodyElement</span>;</span><br><span class="line">  <span class="string">&quot;br&quot;</span>: <span class="title class_">HTMLBRElement</span>;</span><br><span class="line">  <span class="string">&quot;button&quot;</span>: <span class="title class_">HTMLButtonElement</span>;</span><br><span class="line">  <span class="string">&quot;canvas&quot;</span>: <span class="title class_">HTMLCanvasElement</span>;</span><br><span class="line">  <span class="string">&quot;caption&quot;</span>: <span class="title class_">HTMLTableCaptionElement</span>;</span><br><span class="line">  <span class="string">&quot;cite&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;code&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;col&quot;</span>: <span class="title class_">HTMLTableColElement</span>;</span><br><span class="line">  <span class="string">&quot;colgroup&quot;</span>: <span class="title class_">HTMLTableColElement</span>;</span><br><span class="line">  <span class="string">&quot;data&quot;</span>: <span class="title class_">HTMLDataElement</span>;</span><br><span class="line">  <span class="string">&quot;datalist&quot;</span>: <span class="title class_">HTMLDataListElement</span>;</span><br><span class="line">  <span class="string">&quot;dd&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;del&quot;</span>: <span class="title class_">HTMLModElement</span>;</span><br><span class="line">  <span class="string">&quot;details&quot;</span>: <span class="title class_">HTMLDetailsElement</span>;</span><br><span class="line">  <span class="string">&quot;dfn&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;dialog&quot;</span>: <span class="title class_">HTMLDialogElement</span>;</span><br><span class="line">  <span class="string">&quot;dir&quot;</span>: <span class="title class_">HTMLDirectoryElement</span>;</span><br><span class="line">  <span class="string">&quot;div&quot;</span>: <span class="title class_">HTMLDivElement</span>;</span><br><span class="line">  <span class="string">&quot;dl&quot;</span>: <span class="title class_">HTMLDListElement</span>;</span><br><span class="line">  <span class="string">&quot;dt&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;em&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;embed&quot;</span>: <span class="title class_">HTMLEmbedElement</span>;</span><br><span class="line">  <span class="string">&quot;fieldset&quot;</span>: <span class="title class_">HTMLFieldSetElement</span>;</span><br><span class="line">  <span class="string">&quot;figcaption&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;figure&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;font&quot;</span>: <span class="title class_">HTMLFontElement</span>;</span><br><span class="line">  <span class="string">&quot;footer&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;form&quot;</span>: <span class="title class_">HTMLFormElement</span>;</span><br><span class="line">  <span class="string">&quot;frame&quot;</span>: <span class="title class_">HTMLFrameElement</span>;</span><br><span class="line">  <span class="string">&quot;frameset&quot;</span>: <span class="title class_">HTMLFrameSetElement</span>;</span><br><span class="line">  <span class="string">&quot;h1&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;h2&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;h3&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;h4&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;h5&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;h6&quot;</span>: <span class="title class_">HTMLHeadingElement</span>;</span><br><span class="line">  <span class="string">&quot;head&quot;</span>: <span class="title class_">HTMLHeadElement</span>;</span><br><span class="line">  <span class="string">&quot;header&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;hgroup&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;hr&quot;</span>: <span class="title class_">HTMLHRElement</span>;</span><br><span class="line">  <span class="string">&quot;html&quot;</span>: <span class="title class_">HTMLHtmlElement</span>;</span><br><span class="line">  <span class="string">&quot;i&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;iframe&quot;</span>: <span class="title class_">HTMLIFrameElement</span>;</span><br><span class="line">  <span class="string">&quot;img&quot;</span>: <span class="title class_">HTMLImageElement</span>;</span><br><span class="line">  <span class="string">&quot;input&quot;</span>: <span class="title class_">HTMLInputElement</span>;</span><br><span class="line">  <span class="string">&quot;ins&quot;</span>: <span class="title class_">HTMLModElement</span>;</span><br><span class="line">  <span class="string">&quot;kbd&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;label&quot;</span>: <span class="title class_">HTMLLabelElement</span>;</span><br><span class="line">  <span class="string">&quot;legend&quot;</span>: <span class="title class_">HTMLLegendElement</span>;</span><br><span class="line">  <span class="string">&quot;li&quot;</span>: <span class="title class_">HTMLLIElement</span>;</span><br><span class="line">  <span class="string">&quot;link&quot;</span>: <span class="title class_">HTMLLinkElement</span>;</span><br><span class="line">  <span class="string">&quot;main&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;map&quot;</span>: <span class="title class_">HTMLMapElement</span>;</span><br><span class="line">  <span class="string">&quot;mark&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;marquee&quot;</span>: <span class="title class_">HTMLMarqueeElement</span>;</span><br><span class="line">  <span class="string">&quot;menu&quot;</span>: <span class="title class_">HTMLMenuElement</span>;</span><br><span class="line">  <span class="string">&quot;meta&quot;</span>: <span class="title class_">HTMLMetaElement</span>;</span><br><span class="line">  <span class="string">&quot;meter&quot;</span>: <span class="title class_">HTMLMeterElement</span>;</span><br><span class="line">  <span class="string">&quot;nav&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;noscript&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;object&quot;</span>: <span class="title class_">HTMLObjectElement</span>;</span><br><span class="line">  <span class="string">&quot;ol&quot;</span>: <span class="title class_">HTMLOListElement</span>;</span><br><span class="line">  <span class="string">&quot;optgroup&quot;</span>: <span class="title class_">HTMLOptGroupElement</span>;</span><br><span class="line">  <span class="string">&quot;option&quot;</span>: <span class="title class_">HTMLOptionElement</span>;</span><br><span class="line">  <span class="string">&quot;output&quot;</span>: <span class="title class_">HTMLOutputElement</span>;</span><br><span class="line">  <span class="string">&quot;p&quot;</span>: <span class="title class_">HTMLParagraphElement</span>;</span><br><span class="line">  <span class="string">&quot;param&quot;</span>: <span class="title class_">HTMLParamElement</span>;</span><br><span class="line">  <span class="string">&quot;picture&quot;</span>: <span class="title class_">HTMLPictureElement</span>;</span><br><span class="line">  <span class="string">&quot;pre&quot;</span>: <span class="title class_">HTMLPreElement</span>;</span><br><span class="line">  <span class="string">&quot;progress&quot;</span>: <span class="title class_">HTMLProgressElement</span>;</span><br><span class="line">  <span class="string">&quot;q&quot;</span>: <span class="title class_">HTMLQuoteElement</span>;</span><br><span class="line">  <span class="string">&quot;rp&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;rt&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;ruby&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;s&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;samp&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;script&quot;</span>: <span class="title class_">HTMLScriptElement</span>;</span><br><span class="line">  <span class="string">&quot;section&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;select&quot;</span>: <span class="title class_">HTMLSelectElement</span>;</span><br><span class="line">  <span class="string">&quot;slot&quot;</span>: <span class="title class_">HTMLSlotElement</span>;</span><br><span class="line">  <span class="string">&quot;small&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;source&quot;</span>: <span class="title class_">HTMLSourceElement</span>;</span><br><span class="line">  <span class="string">&quot;span&quot;</span>: <span class="title class_">HTMLSpanElement</span>;</span><br><span class="line">  <span class="string">&quot;strong&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;style&quot;</span>: <span class="title class_">HTMLStyleElement</span>;</span><br><span class="line">  <span class="string">&quot;sub&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;summary&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;sup&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;table&quot;</span>: <span class="title class_">HTMLTableElement</span>;</span><br><span class="line">  <span class="string">&quot;tbody&quot;</span>: <span class="title class_">HTMLTableSectionElement</span>;</span><br><span class="line">  <span class="string">&quot;td&quot;</span>: <span class="title class_">HTMLTableDataCellElement</span>;</span><br><span class="line">  <span class="string">&quot;template&quot;</span>: <span class="title class_">HTMLTemplateElement</span>;</span><br><span class="line">  <span class="string">&quot;textarea&quot;</span>: <span class="title class_">HTMLTextAreaElement</span>;</span><br><span class="line">  <span class="string">&quot;tfoot&quot;</span>: <span class="title class_">HTMLTableSectionElement</span>;</span><br><span class="line">  <span class="string">&quot;th&quot;</span>: <span class="title class_">HTMLTableHeaderCellElement</span>;</span><br><span class="line">  <span class="string">&quot;thead&quot;</span>: <span class="title class_">HTMLTableSectionElement</span>;</span><br><span class="line">  <span class="string">&quot;time&quot;</span>: <span class="title class_">HTMLTimeElement</span>;</span><br><span class="line">  <span class="string">&quot;title&quot;</span>: <span class="title class_">HTMLTitleElement</span>;</span><br><span class="line">  <span class="string">&quot;tr&quot;</span>: <span class="title class_">HTMLTableRowElement</span>;</span><br><span class="line">  <span class="string">&quot;track&quot;</span>: <span class="title class_">HTMLTrackElement</span>;</span><br><span class="line">  <span class="string">&quot;u&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;ul&quot;</span>: <span class="title class_">HTMLUListElement</span>;</span><br><span class="line">  <span class="string">&quot;var&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">  <span class="string">&quot;video&quot;</span>: <span class="title class_">HTMLVideoElement</span>;</span><br><span class="line">  <span class="string">&quot;wbr&quot;</span>: <span class="title class_">HTMLElement</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h2 id="代码雨"><a href="#代码雨" class="headerlink" title="代码雨"></a>代码雨</h2><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">*&#123;</span><br><span class="line">  <span class="attribute">padding</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span>;</span><br><span class="line">  <span class="attribute">overflow</span>: hidden;</span><br><span class="line">&#125;</span><br><span class="line"><span class="selector-tag">body</span>&#123;</span><br><span class="line">  <span class="attribute">background-color</span>: <span class="number">#000</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;./index.css&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">canvas</span>: <span class="title class_">HTMLCanvasElement</span> = <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="string">&#x27;#canvas&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> ctx = canvas.<span class="title function_">getContext</span>(<span class="string">&#x27;2d&#x27;</span>);</span><br><span class="line">canvas.<span class="property">width</span> = screen.<span class="property">availWidth</span>;</span><br><span class="line">canvas.<span class="property">height</span> = screen.<span class="property">availHeight</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">str</span>: <span class="built_in">string</span>[] = <span class="string">&#x27;qcqxchuckle0101010101&#x27;</span>.<span class="title function_">split</span>(<span class="string">&#x27;&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> arr = <span class="title class_">Array</span>(<span class="title class_">Math</span>.<span class="title function_">ceil</span>(canvas.<span class="property">width</span> / <span class="number">10</span>)).<span class="title function_">fill</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> <span class="title function_">rain</span> = (<span class="params"></span>) =&gt; &#123;</span><br><span class="line">  <span class="comment">// 不断的在绘制矩形，没有清除上一次画布，矩形是叠加起来的半透明的，所以背景越来越黑，文字越来越谈，感觉像渐变</span></span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;rgba(0,0,0,0.05)&#x27;</span>;</span><br><span class="line">  ctx.<span class="title function_">fillRect</span>(<span class="number">0</span>, <span class="number">0</span>, canvas.<span class="property">width</span>, canvas.<span class="property">height</span>);</span><br><span class="line">  ctx.<span class="property">fillStyle</span> = <span class="string">&#x27;#0f0&#x27;</span>;</span><br><span class="line">  arr.<span class="title function_">forEach</span>(<span class="function">(<span class="params">item, index</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title class_">Math</span>.<span class="title function_">random</span>() &gt; <span class="number">0.2</span>) &#123; <span class="comment">// 控制字符显示的概率</span></span><br><span class="line">      <span class="keyword">const</span> text = str[<span class="title class_">Math</span>.<span class="title function_">floor</span>(<span class="title class_">Math</span>.<span class="title function_">random</span>() * str.<span class="property">length</span>)]; <span class="comment">// 随机获取一个文字</span></span><br><span class="line">      ctx.<span class="title function_">fillText</span>(text, index * <span class="number">10</span>, item); <span class="comment">// 间隔10px绘制文字</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 文字到底部或者大于一个随机数则重置到顶部</span></span><br><span class="line">    arr[index] = item &gt; canvas.<span class="property">height</span> || item &gt; <span class="title class_">Math</span>.<span class="title function_">random</span>() * canvas.<span class="property">height</span> * (canvas.<span class="property">height</span> &gt; <span class="number">1000</span> ? <span class="number">20</span> : <span class="number">10</span>) ? <span class="number">0</span> : item + <span class="number">10</span></span><br><span class="line">  &#125;);</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> stv = <span class="built_in">setInterval</span>(rain, <span class="number">40</span>);</span><br><span class="line"><span class="variable language_">window</span>.<span class="title function_">addEventListener</span>(<span class="string">&#x27;resize&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">clearInterval</span>(stv);</span><br><span class="line">  canvas.<span class="property">width</span> = screen.<span class="property">availWidth</span>;</span><br><span class="line">  canvas.<span class="property">height</span> = screen.<span class="property">availHeight</span>;</span><br><span class="line">  stv = <span class="built_in">setInterval</span>(rain, <span class="number">40</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h1 id="Class"><a href="#Class" class="headerlink" title="Class"></a>Class</h1><p>Class类是ES6新特性，详见：<a href="/article/383b041f.html#Class%E7%B1%BB">ES6-Class类</a></p>
<p>在TS中使用<strong>interface</strong>定义类，当然interface还能定义对象，因为对象是类的实例，类是对象的模板</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用来定义对象的类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Options</span> &#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="built_in">string</span> | <span class="title class_">HTMLElement</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 用来约束Class</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// implements关键字定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">implements</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">options</span>) <span class="comment">// &#123; el: &#x27;#app&#x27; &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>一个类可以由多个interface进行约束</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls1</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls2</span> &#123;</span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// implements关键字定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">implements</span> <span class="title class_">VueCls1</span>, <span class="title class_">VueCls2</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">options</span>) <span class="comment">// &#123; el: &#x27;#app&#x27; &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="继承"><a href="#继承" class="headerlink" title="继承"></a>继承</h2><p>Class 通过 <code>extends</code> 关键字实现继承，详见：<a href="/article/383b041f.html#%E7%B1%BB%E7%9A%84%E7%BB%A7%E6%89%BF">ES6-类的继承</a></p>
<p>一个简化版的虚拟DOM案例：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用来定义对象的类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Options</span> &#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="built_in">string</span> | <span class="title class_">HTMLElement</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用来约束Class</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义节点的数据结构</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Vnode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: <span class="built_in">string</span> <span class="comment">// 标签名</span></span><br><span class="line">  text?: <span class="built_in">string</span> <span class="comment">// 文本内容</span></span><br><span class="line">  children?: <span class="title class_">Vnode</span>[] <span class="comment">// 子节点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化版虚拟Dom</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dom</span> &#123;</span><br><span class="line">  <span class="comment">// 创建节点</span></span><br><span class="line">  <span class="title function_">createElement</span>(<span class="params">tag: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">document</span>.<span class="title function_">createElement</span>(tag);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 填充文本</span></span><br><span class="line">  <span class="title function_">setText</span>(<span class="params">el: HTMLElement, value: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    el.<span class="property">textContent</span> = value;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染</span></span><br><span class="line">  <span class="title function_">render</span>(<span class="params">data: Vnode</span>) &#123;</span><br><span class="line">    <span class="comment">// 创建当前节点</span></span><br><span class="line">    <span class="keyword">const</span> root = <span class="variable language_">this</span>.<span class="title function_">createElement</span>(data.<span class="property">tag</span>);</span><br><span class="line">    <span class="comment">// 如果有文本则填充</span></span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">text</span>) &#123;</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">setText</span>(root, data.<span class="property">text</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 如果该有子节点，则递归渲染</span></span><br><span class="line">    <span class="keyword">if</span> (data.<span class="property">children</span> &amp;&amp; <span class="title class_">Array</span>.<span class="title function_">isArray</span>(data.<span class="property">children</span>)) &#123;</span><br><span class="line">      data.<span class="property">children</span>.<span class="title function_">forEach</span>(<span class="function"><span class="params">child</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 渲染并获取子节点</span></span><br><span class="line">        <span class="keyword">const</span> e = <span class="variable language_">this</span>.<span class="title function_">render</span>(child)</span><br><span class="line">        <span class="comment">// 将子节点添加给父节点</span></span><br><span class="line">        root.<span class="title function_">appendChild</span>(e);</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 返回当前节点</span></span><br><span class="line">    <span class="keyword">return</span> root;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 虚拟dom数据</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">data</span>: <span class="title class_">Vnode</span> = &#123;</span><br><span class="line">  <span class="attr">tag</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">  <span class="attr">text</span>: <span class="string">&quot;这是一个div标签&quot;</span>,</span><br><span class="line">  <span class="attr">children</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">      <span class="attr">text</span>: <span class="string">&quot;这是一个p标签&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">tag</span>: <span class="string">&#x27;div&#x27;</span>,</span><br><span class="line">      <span class="attr">children</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;p&#x27;</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">&quot;这是一个p标签&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">tag</span>: <span class="string">&#x27;span&#x27;</span>,</span><br><span class="line">          <span class="attr">text</span>: <span class="string">&quot;这是一个span标签&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">      ]</span><br><span class="line">    &#125;,</span><br><span class="line">  ],</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// extends实现继承，需要写在implements之前</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Dom</span> <span class="keyword">implements</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">options</span> = options</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">init</span>()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">// 调用父类的方法</span></span><br><span class="line">    <span class="keyword">const</span> dom = <span class="variable language_">this</span>.<span class="title function_">render</span>(data)</span><br><span class="line">    <span class="keyword">const</span> app = <span class="keyword">typeof</span> <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span> === <span class="string">&quot;string&quot;</span> ? <span class="variable language_">document</span>.<span class="title function_">querySelector</span>(<span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span>) : <span class="variable language_">this</span>.<span class="property">options</span>.<span class="property">el</span></span><br><span class="line">    <span class="comment">// app存在则将Dom挂载到页面上</span></span><br><span class="line">    app?.<span class="title function_">appendChild</span>(dom)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 创建实例</span></span><br><span class="line"><span class="keyword">const</span> vue = <span class="keyword">new</span> <span class="title class_">Vue</span>(&#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="string">&#x27;#app&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>渲染结果：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span>这是一个div标签</span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个p标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">p</span>&gt;</span>这是一个p标签<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">span</span>&gt;</span>这是一个span标签<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>
<h2 id="访问修饰符"><a href="#访问修饰符" class="headerlink" title="访问修饰符"></a>访问修饰符</h2><p>访问修饰符是TS提供的特性，总共有三个：<strong>public</strong> <strong>private</strong> <strong>protected</strong>，用于控制对类内部成员的访问权限</p>
<ol>
<li><code>public</code> 默认，实例和子类都能访问</li>
<li><code>private</code> 私有的，只能在类内部访问，实例和子类都不能访问</li>
<li><code>protected</code> 类和子类能访问，实例不能访问</li>
</ol>
<p>一个特殊的：<code>readonly</code> 只能访问，不能修改(可以在constructor中初始化)</p>
<p>对上面的虚拟dom案例进行修饰：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 用来定义对象的类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Options</span> &#123;</span><br><span class="line">  <span class="attr">el</span>: <span class="built_in">string</span> | <span class="title class_">HTMLElement</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 用来约束Class</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义节点的数据结构</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Vnode</span> &#123;</span><br><span class="line">  <span class="attr">tag</span>: <span class="built_in">string</span> <span class="comment">// 标签名</span></span><br><span class="line">  text?: <span class="built_in">string</span> <span class="comment">// 文本内容</span></span><br><span class="line">  children?: <span class="title class_">Vnode</span>[] <span class="comment">// 子节点</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 简化版虚拟Dom</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Dom</span> &#123;</span><br><span class="line">  <span class="comment">// 创建节点</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">createElement</span>(<span class="params">tag: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 填充文本</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">setText</span>(<span class="params">el: HTMLElement, value: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 渲染</span></span><br><span class="line">  <span class="keyword">protected</span> <span class="title function_">render</span>(<span class="params">data: Vnode</span>) &#123;</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// implements关键字定义类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Dom</span> <span class="keyword">implements</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="keyword">readonly</span> <span class="attr">options</span>: <span class="title class_">Options</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">options: Options</span>) &#123;</span><br><span class="line">    <span class="variable language_">super</span>();</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>接口中不能出现 public, protected, private 修饰符，因为默认只能规定类中的 public 属性和方法，也就是说接口中定义的成员都是 public 的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="comment">/*****/</span></span><br><span class="line">  <span class="title function_">init</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Vue</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Dom</span> <span class="keyword">implements</span> <span class="title class_">VueCls</span> &#123;</span><br><span class="line">  <span class="comment">/*****/</span></span><br><span class="line">  <span class="comment">// 报错：属性“init”在类型“Vue”中是私有属性，但在类型“VueCls”中不是。</span></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">init</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="comment">/*****/</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="抽象类"><a href="#抽象类" class="headerlink" title="抽象类"></a>抽象类</h2><p><code>abstract</code> 关键字定义抽象类和抽象方法，抽象类无法实例化，抽象方法只能描述</p>
<p>作用：用于顶层设计，派生类实现功能</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">abstract</span> <span class="title function_">setName</span>(<span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Person</span> &#123;</span><br><span class="line">  <span class="comment">// 子类必须实现抽象父类的抽象方法</span></span><br><span class="line">  <span class="title function_">setName</span>(<span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> stu = <span class="keyword">new</span> <span class="title class_">Student</span>(<span class="string">&quot;chuckle&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">name</span>) <span class="comment">// chuckle</span></span><br><span class="line">stu.<span class="title function_">setName</span>(<span class="string">&quot;qcqx&quot;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(stu.<span class="property">name</span>) <span class="comment">// qcqx</span></span><br></pre></td></tr></table></figure>
<h1 id="枚举类型"><a href="#枚举类型" class="headerlink" title="枚举类型"></a>枚举类型</h1><p><code>enum</code> 定义枚举类型，枚举成员只能是数字或字符串，且readonly</p>
<p>枚举成员也可以被当做一个类型，可以指定某些变量的值必须是枚举成员的值</p>
<p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000040817957">聊聊TypeScript中枚举对象(Enum)</a></p>
<p><strong>1、数字枚举</strong><br>默认从0开始枚举，可以<strong>反向映射</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red,</span><br><span class="line">  green,</span><br><span class="line">  blue</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>)</span><br><span class="line"><span class="comment">// &#123; &#x27;0&#x27;: &#x27;red&#x27;, &#x27;1&#x27;: &#x27;green&#x27;, &#x27;2&#x27;: &#x27;blue&#x27;, red: 0, green: 1, blue: 2 &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>[<span class="number">0</span>]) <span class="comment">// red</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>.<span class="property">red</span>) <span class="comment">// 0</span></span><br></pre></td></tr></table></figure>
<p>可以指定初值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red = <span class="number">1</span>,</span><br><span class="line">  green,</span><br><span class="line">  blue</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>)</span><br><span class="line"><span class="comment">// &#123; &#x27;1&#x27;: &#x27;red&#x27;, &#x27;2&#x27;: &#x27;green&#x27;, &#x27;3&#x27;: &#x27;blue&#x27;, red: 1, green: 2, blue: 3 &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>[<span class="number">0</span>]) <span class="comment">// undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>.<span class="property">red</span>) <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p><strong>2、字符串枚举</strong><br>每个成员都必须用字符串字面量，或另外一个字符串枚举成员进行初始化</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red = <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">  green = <span class="string">&#x27;green&#x27;</span>,</span><br><span class="line">  blue = <span class="string">&#x27;blue&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>)</span><br><span class="line"><span class="comment">// &#123; red: &#x27;red&#x27;, green: &#x27;green&#x27;, blue: &#x27;blue&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>.<span class="property">red</span>) <span class="comment">// red</span></span><br></pre></td></tr></table></figure>
<p><strong>3、异构枚举</strong><br>枚举可以混合字符串和数字成员</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red = <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">  green = <span class="string">&#x27;green&#x27;</span>,</span><br><span class="line">  blue = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Color</span>)</span><br><span class="line"><span class="comment">// &#123; &#x27;3&#x27;: &#x27;blue&#x27;, red: &#x27;red&#x27;, green: &#x27;green&#x27;, blue: 3 &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>4、接口枚举</strong><br>用于约束成员值的范围</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">enum</span> <span class="title class_">Color</span> &#123;</span><br><span class="line">  red = <span class="string">&#x27;red&#x27;</span>,</span><br><span class="line">  green = <span class="string">&#x27;green&#x27;</span>,</span><br><span class="line">  blue = <span class="number">3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> A &#123;</span><br><span class="line">  <span class="attr">red</span>: <span class="title class_">Color</span>.<span class="property">red</span>;</span><br><span class="line">  <span class="attr">blue</span>: <span class="title class_">Color</span>.<span class="property">blue</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">obj</span>: A = &#123;</span><br><span class="line">  <span class="comment">// red: &#x27;red&#x27;, // 不能将类型“&quot;red&quot;”分配给类型“Color.red”。</span></span><br><span class="line">  <span class="attr">red</span>: <span class="title class_">Color</span>.<span class="property">red</span>,</span><br><span class="line">  <span class="comment">// blue: 2 // 不能将类型“2”分配给类型“Color.blue”。</span></span><br><span class="line">  <span class="attr">blue</span>: <span class="number">3</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>4、const枚举</strong><br>直接将枚举编译为常量，而普通声明的枚举编译完后是个对象，可以避免在额外生成的代码上的开销和额外的非直接的对枚举成员的访问</p>
<p>注意：const枚举不能反向映射</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="built_in">enum</span> <span class="title class_">Types</span>&#123;</span><br><span class="line">  <span class="title class_">No</span> = <span class="string">&quot;No&quot;</span>,</span><br><span class="line">  <span class="title class_">Yes</span> = <span class="number">1</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Types</span>.<span class="property">No</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Types</span>.<span class="property">Yes</span>)</span><br><span class="line"><span class="comment">// 编译后</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;No&quot;</span> <span class="comment">/* Types.No */</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">1</span> <span class="comment">/* Types.Yes */</span>);</span><br><span class="line"><span class="comment">// 非const编译后</span></span><br><span class="line"><span class="keyword">var</span> <span class="title class_">Types</span>;</span><br><span class="line">(<span class="keyword">function</span> (<span class="params">Types</span>) &#123;</span><br><span class="line">    <span class="title class_">Types</span>[<span class="string">&quot;No&quot;</span>] = <span class="string">&quot;No&quot;</span>;</span><br><span class="line">    <span class="title class_">Types</span>[<span class="title class_">Types</span>[<span class="string">&quot;Yes&quot;</span>] = <span class="number">1</span>] = <span class="string">&quot;Yes&quot;</span>;</span><br><span class="line">&#125;)(<span class="title class_">Types</span> || (<span class="title class_">Types</span> = &#123;&#125;));</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Types</span>.<span class="property">No</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Types</span>.<span class="property">Yes</span>);</span><br></pre></td></tr></table></figure>
<h1 id="类型推论"><a href="#类型推论" class="headerlink" title="类型推论"></a>类型推论</h1><p>TS会在没有明确的指定类型的时候推断出一个类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 推论为string类型</span></span><br><span class="line"><span class="keyword">let</span> str = <span class="string">&quot;chuckle&quot;</span></span><br><span class="line"><span class="comment">// 不能再赋予其它类型</span></span><br><span class="line">str = <span class="number">123</span> <span class="comment">// 不能将类型“number”分配给类型“string”。</span></span><br></pre></td></tr></table></figure>
<p>若变量没有初始化，会在首次赋值时推断类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> str</span><br><span class="line">str = <span class="string">&quot;qx&quot;</span></span><br><span class="line">str = <span class="number">123</span> <span class="comment">// 不能将类型“number”分配给类型“string”。</span></span><br></pre></td></tr></table></figure>
<h1 id="类型别名"><a href="#类型别名" class="headerlink" title="类型别名"></a>类型别名</h1><p><code>type</code> 定义类型别名，多用于复合类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 复合类型</span></span><br><span class="line"><span class="keyword">type</span> t1 = <span class="built_in">number</span> | <span class="built_in">string</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">s</span>: t1</span><br><span class="line"><span class="comment">// 函数类型</span></span><br><span class="line"><span class="keyword">type</span> t2 = <span class="function">(<span class="params">name: <span class="built_in">string</span></span>) =&gt;</span> <span class="built_in">string</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">fn1</span>: t2 = <span class="function">(<span class="params">name</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> name</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 值别名，只能是value定义的值</span></span><br><span class="line"><span class="keyword">type</span> value = <span class="built_in">boolean</span> | <span class="number">0</span> | <span class="string">&#x27;123&#x27;</span></span><br><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: value = <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p>type 和 interface 区别：</p>
<ol>
<li>interface可以继承  type 只能通过 &amp; 交叉类型合并</li>
<li>type 可以定义联合类型、可以使用一些操作符 interface 不行</li>
<li>interface 遇到重名的会合并 type 不行</li>
</ol>
<p>type 中的 extends 表示包含，判断左值是否为右类型的子类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> num1 = <span class="number">1</span> <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num2 = <span class="number">1</span> <span class="keyword">extends</span> <span class="built_in">string</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num3 = &#123;&#125; <span class="keyword">extends</span> <span class="built_in">number</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num5 = <span class="number">1</span> <span class="keyword">extends</span> <span class="title class_">Object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num6 = (<span class="function">()=&gt;</span>&#123;&#125;) <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num7 = <span class="title class_">Number</span> <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num8 = <span class="built_in">number</span> <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num9 = <span class="title class_">Object</span> <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num10 = <span class="built_in">any</span> <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br><span class="line"><span class="keyword">type</span> num11 = <span class="built_in">void</span> <span class="keyword">extends</span> <span class="title class_">Object</span> | <span class="built_in">string</span> | <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num12 = <span class="built_in">void</span> <span class="keyword">extends</span> <span class="literal">null</span> | <span class="literal">undefined</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num13 = <span class="literal">null</span> | <span class="literal">undefined</span> <span class="keyword">extends</span> <span class="built_in">object</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num14 = <span class="literal">null</span> <span class="keyword">extends</span> <span class="literal">undefined</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num15 = <span class="literal">undefined</span> <span class="keyword">extends</span> <span class="literal">null</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num16 = <span class="literal">undefined</span> | <span class="literal">null</span> <span class="keyword">extends</span> <span class="built_in">never</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 0</span></span><br><span class="line"><span class="keyword">type</span> num17 = <span class="built_in">never</span> <span class="keyword">extends</span> <span class="literal">undefined</span> &amp; <span class="literal">null</span> ? <span class="number">1</span> : <span class="number">0</span> <span class="comment">// 1</span></span><br></pre></td></tr></table></figure>
<p>类型的层级：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">object 包含所有非值类型(undefined,null除外)</span><br><span class="line">any unknown</span><br><span class="line">Object</span><br><span class="line">Number String Boolean </span><br><span class="line">number string boolean</span><br><span class="line">never</span><br></pre></td></tr></table></figure>
<h1 id="never类型"><a href="#never类型" class="headerlink" title="never类型"></a>never类型</h1><p>never 类型来表示不应该存在的状态</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> A = <span class="built_in">void</span> | <span class="built_in">number</span> | <span class="built_in">never</span> <span class="comment">// void | number</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="built_in">number</span> &amp; <span class="built_in">string</span> <span class="comment">// never</span></span><br><span class="line"><span class="comment">// 因为必定抛出异常，所以 error 将不会有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(message);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 因为存在死循环，所以 loop 将不会有返回值</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">loop</span>(<span class="params"></span>): <span class="built_in">never</span> &#123;</span><br><span class="line">  <span class="keyword">while</span> (<span class="literal">true</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>作用：便于TS检查一些可能存在的运行时的期望错误</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Value</span> = <span class="number">1</span> | <span class="number">2</span> | <span class="number">3</span> <span class="comment">// 限制值</span></span><br><span class="line"><span class="comment">// type Value = 1 | 2 | 3 | 4 // 增加值而没有相对应的匹配</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">choice</span>(<span class="params">value: Value</span>) &#123;</span><br><span class="line">  <span class="keyword">switch</span> (value) &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">      <span class="keyword">break</span></span><br><span class="line">    <span class="comment">// 进入default肯定有问题</span></span><br><span class="line">    <span class="attr">default</span>:</span><br><span class="line">       <span class="comment">// 若增加了一个4，则编辑器报错：不能将类型“number”分配给类型“never”。</span></span><br><span class="line">      <span class="keyword">const</span> <span class="attr">error</span>: <span class="built_in">never</span> = value;</span><br><span class="line">      <span class="keyword">return</span> error</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="泛型"><a href="#泛型" class="headerlink" title="泛型"></a>泛型</h1><p>泛型是动态类型，即在使用时确定类型，相比于暴力使用any，泛型即保留了方便的类型检查又增加了灵活性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> toArray&lt;T&gt;(<span class="attr">a</span>: T, <span class="attr">b</span>: T): <span class="title class_">Array</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b]</span><br><span class="line">&#125;</span><br><span class="line">toArray&lt;<span class="built_in">number</span>&gt;(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 完整写法，将类型传入&lt;&gt;</span></span><br><span class="line"><span class="title function_">toArray</span>(<span class="number">1</span>, <span class="number">2</span>) <span class="comment">// 自动推断</span></span><br></pre></td></tr></table></figure>
<p>泛型有些类似类型的函数，先用个T作为形式类型占位，再由外部传入实际类型，或者让TS自动推断，所以&lt;&gt;中可以用多个形式类型占位</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> toArray&lt;T, K&gt;(<span class="attr">a</span>: T, <span class="attr">b</span>: K): <span class="title class_">Array</span>&lt;T | K&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [a, b]</span><br><span class="line">&#125;</span><br><span class="line">toArray&lt;<span class="built_in">number</span>, <span class="built_in">string</span>&gt;(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>) <span class="comment">// 完整写法，将类型传入&lt;&gt;</span></span><br><span class="line"><span class="title function_">toArray</span>(<span class="number">1</span>, <span class="string">&quot;a&quot;</span>) <span class="comment">// 自动推断</span></span><br></pre></td></tr></table></figure>
<p>除了在函数中，interface、type、class 等都可以使用泛型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// type</span></span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">AA</span>&lt;T&gt; = <span class="built_in">number</span> | <span class="built_in">string</span> | T</span><br><span class="line"><span class="keyword">let</span> <span class="attr">aa</span>: <span class="variable constant_">AA</span>&lt;<span class="built_in">boolean</span>&gt; <span class="comment">// 声明变量时确定第三个类型</span></span><br><span class="line">aa = <span class="literal">false</span></span><br><span class="line">aa = <span class="number">1</span></span><br><span class="line">aa = <span class="string">&quot;aa&quot;</span></span><br><span class="line"><span class="comment">// interface</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Data</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">msg</span>: T</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">d</span>: <span class="title class_">Data</span>&lt;<span class="built_in">string</span>&gt; = &#123; <span class="attr">msg</span>: <span class="string">&quot;hello&quot;</span> &#125;</span><br><span class="line"><span class="comment">// class</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Sub</span>&lt;T&gt;&#123;</span><br><span class="line">  <span class="attr">attr</span>: T[] = [];</span><br><span class="line">  <span class="title function_">add</span>(<span class="attr">a</span>: T): T[] &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">attr</span>.<span class="title function_">push</span>(a)</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">attr</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> ss = <span class="keyword">new</span> <span class="title class_">Sub</span>&lt;<span class="built_in">number</span>&gt;()</span><br><span class="line">ss.<span class="property">attr</span> = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">ss.<span class="title function_">add</span>(<span class="number">123</span>)</span><br><span class="line"><span class="keyword">let</span> sss = <span class="keyword">new</span> <span class="title class_">Sub</span>&lt;<span class="built_in">string</span>&gt;()</span><br><span class="line">sss.<span class="property">attr</span> = [<span class="string">&#x27;1&#x27;</span>, <span class="string">&#x27;2&#x27;</span>, <span class="string">&#x27;3&#x27;</span>]</span><br><span class="line">sss.<span class="title function_">add</span>(<span class="string">&#x27;123&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>一个常用的技巧：<br>因为 js 中的 number/string/boolean 这些基本量是传值的，而 object/array 这些对象传引用地址，当我们想在函数内部通过参数修改传进来的数据时，就得使用引用数据类型，所以我们把基本量包装成一个对象传进去，就可以实现在函数内部修改参数了</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> ref&lt;T&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: T</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>泛型在封装请求方法时也经常使用：</p>
<figure class="highlight json"><figcaption><span>data.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;code&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0000&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;msg&quot;</span><span class="punctuation">:</span> <span class="string">&quot;成功&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;data&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qx&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;age&quot;</span><span class="punctuation">:</span> <span class="number">20</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> axios = &#123;</span><br><span class="line">  get&lt;T&gt;(<span class="attr">url</span>: <span class="built_in">string</span>): <span class="title class_">Promise</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Promise</span>&lt;T&gt;(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">let</span> xhr = <span class="keyword">new</span> <span class="title class_">XMLHttpRequest</span>()</span><br><span class="line">      xhr.<span class="title function_">open</span>(<span class="string">&#x27;get&#x27;</span>, url)</span><br><span class="line">      xhr.<span class="property">onreadystatechange</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.<span class="property">readyState</span> === <span class="number">4</span> &amp;&amp; xhr.<span class="property">status</span> === <span class="number">200</span>) &#123;</span><br><span class="line">          <span class="title function_">resolve</span>(<span class="title class_">JSON</span>.<span class="title function_">parse</span>(xhr.<span class="property">responseText</span>))</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      xhr.<span class="title function_">send</span>(<span class="literal">null</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 定义返回的数据类型</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ResData</span> &#123;</span><br><span class="line">  <span class="attr">code</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">msg</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">data</span>: <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">axios.<span class="property">get</span>&lt;<span class="title class_">ResData</span>&gt;(<span class="string">&#x27;./data.json&#x27;</span>).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(res.<span class="property">data</span>) <span class="comment">// &#123;name: &#x27;qx&#x27;, age: 20&#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="泛型约束keyof"><a href="#泛型约束keyof" class="headerlink" title="泛型约束keyof"></a>泛型约束keyof</h2><p>在&lt;&gt;中使用extends约束泛型的类型范围</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function getLegnth&lt;T&gt;(arg:T) &#123;</span></span><br><span class="line"><span class="comment">//   return arg.length // 类型“T”上不存在属性“length”。</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Len</span> &#123;</span><br><span class="line">  <span class="attr">length</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">function</span> getLegnth&lt;T <span class="keyword">extends</span> <span class="title class_">Len</span>&gt;(<span class="attr">arg</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> arg.<span class="property">length</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>keyof</code> 可以获取一个对象类型的所有键，作为联合类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// function prop&lt;T&gt;(obj: T, key: string) &#123;</span></span><br><span class="line"><span class="comment">//   return obj[key] // 元素隐式具有 &quot;any&quot; 类型，因为类型为 &quot;string&quot; 的表达式不能用于索引类型 &quot;unknown&quot;。</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">function</span> prop&lt;T, K <span class="keyword">extends</span> keyof T&gt;(<span class="attr">obj</span>: T, <span class="attr">key</span>: K) &#123;</span><br><span class="line">  <span class="keyword">return</span> obj[key]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = &#123; <span class="attr">a</span>: <span class="number">1</span>, <span class="attr">b</span>: <span class="number">2</span>, <span class="attr">c</span>: <span class="number">3</span> &#125;</span><br><span class="line"><span class="title function_">prop</span>(o, <span class="string">&#x27;a&#x27;</span>) </span><br><span class="line"><span class="comment">// prop(o, &#x27;d&#x27;) // 类型“&quot;d&quot;”的参数不能赋给类型“&quot;a&quot; | &quot;b&quot; | &quot;c&quot;”的参数</span></span><br></pre></td></tr></table></figure>
<p>更灵活的用法：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Info</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">InfoOptions</span>&lt;T <span class="keyword">extends</span> <span class="built_in">object</span>&gt; = &#123;</span><br><span class="line">  [<span class="title class_">Key</span> <span class="keyword">in</span> keyof T]?: T[<span class="title class_">Key</span>]</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="variable constant_">BB</span> = <span class="title class_">InfoOptions</span>&lt;<span class="title class_">Info</span>&gt;</span><br><span class="line"><span class="comment">// type BB = &#123;</span></span><br><span class="line"><span class="comment">//   name?: string | undefined;</span></span><br><span class="line"><span class="comment">//   age?: number | undefined;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="tsconfig-json"><a href="#tsconfig-json" class="headerlink" title="tsconfig.json"></a>tsconfig.json</h1><p><code>tsconfig.json</code> 是TS的配置文件，通过 <code>tsc --init</code> 生成</p>
<p>配置详解：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;incremental&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度</span></span><br><span class="line">    <span class="attr">&quot;tsBuildInfoFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./buildFile&quot;</span><span class="punctuation">,</span> <span class="comment">// 增量编译文件的存储位置</span></span><br><span class="line">    <span class="attr">&quot;diagnostics&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 打印诊断信息 </span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ES5&quot;</span><span class="punctuation">,</span> <span class="comment">// 目标语言的版本</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;CommonJS&quot;</span><span class="punctuation">,</span> <span class="comment">// 生成代码的模板标准</span></span><br><span class="line">    <span class="comment">// &quot;outFile&quot;: &quot;./app.js&quot;, // 将多个相互依赖的文件生成一个文件，可以用在AMD模块中，即开启时应设置&quot;module&quot;: &quot;AMD&quot;,</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;DOM&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;ES5&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;ES6&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入&quot;ES2019.Array&quot;,</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许编译器编译JS，JSX文件</span></span><br><span class="line">    <span class="attr">&quot;checkJs&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许在JS文件中报错，通常与allowJS一起使用</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定输出目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定输出文件目录(用于输出)，用于控制输出目录结构</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 生成声明文件，开启后会自动生成声明文件</span></span><br><span class="line">    <span class="attr">&quot;declarationDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./file&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定生成声明文件存放目录</span></span><br><span class="line">    <span class="comment">// &quot;emitDeclarationOnly&quot;: true, // 只生成声明文件，而不会生成js文件</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 生成目标文件的sourceMap文件</span></span><br><span class="line">    <span class="comment">// &quot;inlineSourceMap&quot;: true, // 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中</span></span><br><span class="line">    <span class="attr">&quot;declarationMap&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 为声明文件生成sourceMap</span></span><br><span class="line">    <span class="attr">&quot;typeRoots&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 声明文件目录，默认时node_modules/@types</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 加载的声明文件包</span></span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 删除注释 </span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不输出文件,即编译后不会生成任何js文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitOnError&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 发送错误时不输出任何文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitHelpers&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用</span></span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 通过tslib引入helper函数，文件必须是模块</span></span><br><span class="line">    <span class="attr">&quot;downlevelIteration&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 开启所有严格的类型检查</span></span><br><span class="line">    <span class="attr">&quot;alwaysStrict&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 在代码中注入&#x27;use strict&#x27;</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许把null、undefined赋值给其他类型的变量</span></span><br><span class="line">    <span class="attr">&quot;strictFunctionTypes&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许函数参数双向协变</span></span><br><span class="line">    <span class="attr">&quot;strictPropertyInitialization&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 类的实例属性必须初始化</span></span><br><span class="line">    <span class="attr">&quot;strictBindCallApply&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 严格的bind/call/apply检查</span></span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许this有隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 检查只声明、未使用的局部变量(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 检查未使用的函数参数(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 防止switch语句贯穿(即如果没有break语句后面不会执行)</span></span><br><span class="line">    <span class="attr">&quot;noImplicitReturns&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">//每个分支都会有返回值</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许export=导出，由import from 导入</span></span><br><span class="line">    <span class="attr">&quot;allowUmdGlobalAccess&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许在模块中全局变量的方式访问umd模块</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span> <span class="comment">// 模块解析策略，ts默认用node的解析策略，即相对的方式导入</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span> <span class="comment">// 解析非相对模块的基地址，默认是当前目录</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 路径映射，相对于baseUrl</span></span><br><span class="line">      <span class="comment">// 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置</span></span><br><span class="line">      <span class="comment">// &quot;jquery&quot;: [</span></span><br><span class="line">      <span class="comment">//   &quot;node_modules/jquery/dist/jquery.min.js&quot;</span></span><br><span class="line">      <span class="comment">// ],</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span><span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;./&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootDirs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;src&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;out&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错</span></span><br><span class="line">    <span class="attr">&quot;listEmittedFiles&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 打印输出文件</span></span><br><span class="line">    <span class="attr">&quot;listFiles&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span> <span class="comment">// 打印编译的文件(包括引用的声明文件)</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 指定一个匹配列表（属于自动指定该路径下的所有ts相关文件）</span></span><br><span class="line">  <span class="comment">// &quot;include&quot;: [</span></span><br><span class="line">  <span class="comment">//   &quot;src/**/*&quot;</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line">  <span class="comment">// 指定一个排除列表（include的反向操作）</span></span><br><span class="line">  <span class="comment">// &quot;exclude&quot;: [</span></span><br><span class="line">  <span class="comment">//   &quot;demo.ts&quot;</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line">  <span class="comment">// 指定哪些文件使用该配置（属于手动一个个指定文件）</span></span><br><span class="line">  <span class="comment">// &quot;files&quot;: [</span></span><br><span class="line">  <span class="comment">//   &quot;demo.ts&quot;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h1><p><code>namespace</code> 定义命名空间，内部成员默认私有，通过 <code>export</code> 暴露</p>
<p><strong>作用：</strong>组织代码，避免命名冲突</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line">  <span class="comment">// export暴露命名空间内部成员</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> B = <span class="number">123</span>;</span><br><span class="line">  <span class="comment">// 默认是命名空间私有成员</span></span><br><span class="line">  <span class="keyword">const</span> C = <span class="number">456</span>;</span><br><span class="line">  <span class="comment">// 可以嵌套使用</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">namespace</span> AA &#123;</span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">const</span> <span class="variable constant_">BB</span> = B + C;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(A.<span class="property">B</span>); <span class="comment">// 123</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(A.<span class="property">AA</span>.<span class="property">BB</span>); <span class="comment">// 579</span></span><br><span class="line"><span class="comment">// 同名命名空间自动合并成员</span></span><br><span class="line"><span class="keyword">namespace</span> A &#123;</span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">const</span> D = <span class="number">678</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(A.<span class="property">D</span>); <span class="comment">// 678</span></span><br><span class="line"><span class="comment">// 简化命名空间</span></span><br><span class="line"><span class="keyword">import</span> X = A.<span class="property">AA</span>;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(X.<span class="property">BB</span>); <span class="comment">// 579</span></span><br></pre></td></tr></table></figure>
<h1 id="三斜线指令"><a href="#三斜线指令" class="headerlink" title="三斜线指令"></a>三斜线指令</h1><p><a target="_blank" rel="noopener" href="https://www.tslang.cn/docs/handbook/triple-slash-directives.html">三斜线指令</a>是包含单个XML标签的单行注释。注释的内容会做为编译器指令使用。</p>
<p>TS3.0后建议用import</p>
<p><code>&lt;reference path=&quot;...&quot; /&gt;</code> 类似import，导入依赖，但无需export先暴露</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">///&lt;reference path=&quot;./1.ts&quot; /&gt;</span></span><br><span class="line"><span class="comment">///&lt;reference path=&quot;./2.ts&quot; /&gt;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable constant_">X1</span>.<span class="property">A</span>, <span class="variable constant_">X2</span>.<span class="property">A</span>);</span><br></pre></td></tr></table></figure>
<p><code>&lt;reference types=&quot;node&quot; /&gt;</code> 声明文件引入，表明这个文件使用了 <code>@types/node/index.d.ts</code> 里面声明的名字； 并且，这个包需要在编译阶段与声明文件一起被包含进来。</p>
<h1 id="声明文件d-ts"><a href="#声明文件d-ts" class="headerlink" title="声明文件d.ts"></a>声明文件d.ts</h1><p><code>.d.ts</code> (declare)，TS的声明文件。对于第三方纯js库，通过d.ts可以获得完整的TS静态类型检查、提示、补全等功能</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">var</span> <span class="comment">// 声明全局变量</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">function</span> <span class="comment">// 声明全局方法</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">class</span> <span class="comment">// 声明全局类</span></span><br><span class="line"><span class="keyword">declare</span> <span class="built_in">enum</span> <span class="comment">// 声明全局枚举类型</span></span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> // 声明（含有子属性的）全局对象</span><br><span class="line">interface 和 type // 声明全局类型</span><br><span class="line">/// &lt;reference /&gt; 三斜线指令</span><br></pre></td></tr></table></figure>
<p>TS会解析项目中所有的 *.ts 文件，当然也包含 .d.ts，注意 files、include 和 exclude 配置</p>
<p>TS2.0后，还会默认的查看 <code>node_modules/@types</code> 文件夹，用于为 TypeScript 提供有关用 JavaScript 编写的 API(第三方库) 的类型信息</p>
<p>热门的JS第三方库通常社区已经维护了其声明文件，安装：<code>npm i @types/&lt;包名&gt; -D</code></p>
<p>部分库如axios，已经在package.json中指定了声明文件</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="string">&quot;index.d.ts&quot;</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>对于社区没有维护声明文件的第三方库，就需要通过<code>declare module</code>语法自己写了，<a target="_blank" rel="noopener" href="https://wangdoc.com/typescript/declare">declare关键字</a></p>
<p>以express为例：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> express <span class="keyword">from</span> <span class="string">&#x27;express&#x27;</span></span><br><span class="line"><span class="keyword">const</span> app = <span class="title function_">express</span>()</span><br><span class="line"><span class="keyword">const</span> router = express.<span class="title class_">Router</span>()</span><br><span class="line">app.<span class="title function_">use</span>(<span class="string">&#x27;/api&#x27;</span>, router)</span><br><span class="line">router.<span class="title function_">get</span>(<span class="string">&#x27;/list&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.<span class="title function_">json</span>(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="number">200</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line">app.<span class="title function_">listen</span>(<span class="number">9001</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="number">9001</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// express.d.ts</span></span><br><span class="line"><span class="keyword">declare</span> <span class="variable language_">module</span> <span class="string">&#x27;express&#x27;</span> &#123;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">Router</span> &#123;</span><br><span class="line">    <span class="title function_">get</span>(<span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">cb</span>: <span class="function">(<span class="params">req: <span class="built_in">any</span>, res: <span class="built_in">any</span></span>) =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">App</span> &#123;</span><br><span class="line">    <span class="title function_">use</span>(<span class="attr">path</span>: <span class="built_in">string</span>, <span class="attr">router</span>: <span class="built_in">any</span>): <span class="built_in">void</span></span><br><span class="line">    <span class="title function_">listen</span>(<span class="attr">port</span>: <span class="built_in">number</span>, cb?: <span class="function">() =&gt;</span> <span class="built_in">void</span>): <span class="built_in">void</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">interface</span> <span class="title class_">Express</span> &#123;</span><br><span class="line">    (): <span class="title class_">App</span></span><br><span class="line">    <span class="title class_">Router</span>(): <span class="title class_">Router</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">express</span>: <span class="title class_">Express</span></span><br><span class="line">  <span class="keyword">export</span> <span class="keyword">default</span> express</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以为项目中常用的类型编写一个声明文件，声明语句中只能定义类型，不能在声明语句中定义具体的实现</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">num</span>: ref&lt;<span class="built_in">number</span>&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: <span class="number">0</span>,</span><br><span class="line">&#125;</span><br><span class="line">x = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><figcaption><span>index.d.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">type</span> ref&lt;T&gt; = &#123;</span><br><span class="line">  <span class="attr">value</span>: T</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">declare</span> <span class="keyword">let</span> <span class="attr">x</span>:<span class="built_in">number</span>;</span><br></pre></td></tr></table></figure>
<h1 id="Mixins混入"><a href="#Mixins混入" class="headerlink" title="Mixins混入"></a>Mixins混入</h1><p>对象的混入：<code>Object.assign</code> 合并多个对象</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Name</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Age</span> &#123;</span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Sex</span> &#123;</span><br><span class="line">  <span class="attr">sex</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> <span class="attr">people1</span>: <span class="title class_">Name</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;chuckle&quot;</span> &#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">people2</span>: <span class="title class_">Age</span> = &#123; <span class="attr">age</span>: <span class="number">20</span> &#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">people3</span>: <span class="title class_">Sex</span> = &#123; <span class="attr">sex</span>: <span class="number">1</span> &#125;</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 推断为交叉类型const people: Name &amp; Age &amp; Sex</span></span><br><span class="line"><span class="keyword">const</span> people = <span class="title class_">Object</span>.<span class="title function_">assign</span>(people1,people2,people3)</span><br></pre></td></tr></table></figure>
<p>类方法的混入：</p>
<p>TS并没有Mixins关键字，实现类的混入需要用赋值断言、写混入函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">O1</span> &#123;</span><br><span class="line">  name!: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">getName</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">O2</span> &#123;</span><br><span class="line">  age!: <span class="built_in">number</span>;</span><br><span class="line">  <span class="title function_">getAge</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">age</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">O3</span> <span class="keyword">implements</span> <span class="variable constant_">O1</span>, <span class="variable constant_">O2</span> &#123;</span><br><span class="line">  <span class="comment">// O1</span></span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span> = <span class="string">&#x27;chuckle&#x27;</span>;</span><br><span class="line">  getName!: <span class="function">() =&gt;</span> <span class="built_in">void</span> <span class="comment">// 待混入的方法</span></span><br><span class="line">  <span class="comment">// O2</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span> = <span class="number">20</span>;</span><br><span class="line">  getAge!: <span class="function">() =&gt;</span> <span class="built_in">void</span> <span class="comment">// 待混入的方法</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="title function_">applyMixins</span>(<span class="variable constant_">O3</span>, [<span class="variable constant_">O1</span>, <span class="variable constant_">O2</span>]);</span><br><span class="line"><span class="keyword">let</span> smartObj = <span class="keyword">new</span> <span class="title function_">O3</span>();</span><br><span class="line">smartObj.<span class="title function_">getName</span>();</span><br><span class="line">smartObj.<span class="title function_">getAge</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">applyMixins</span>(<span class="params">derivedCtor: <span class="built_in">any</span>, baseCtors: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">  baseCtors.<span class="title function_">forEach</span>(<span class="function"><span class="params">baseCtor</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(baseCtor.<span class="property"><span class="keyword">prototype</span></span>);</span><br><span class="line">    <span class="title class_">Object</span>.<span class="title function_">getOwnPropertyNames</span>(baseCtor.<span class="property"><span class="keyword">prototype</span></span>).<span class="title function_">forEach</span>(<span class="function"><span class="params">name</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">// 挂载到原型上</span></span><br><span class="line">      derivedCtor.<span class="property"><span class="keyword">prototype</span></span>[name] = baseCtor.<span class="property"><span class="keyword">prototype</span></span>[name];</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>相较于继承，这样混入使得只有类方法被“继承”</p>
<h1 id="装饰器"><a href="#装饰器" class="headerlink" title="装饰器"></a>装饰器</h1><p>装饰器就是一个函数，可以注入到类、方法、属性、参数，对象上，扩展其功能，增加了代码的可读性，清晰地表达了意图。</p>
<p>这是一个实验性的功能，虽然<a target="_blank" rel="noopener" href="https://devblogs.microsoft.com/typescript/announcing-typescript-5-0/#decorators">TS5.0</a>后已经正式推出</p>
<figure class="highlight json"><figcaption><span>tsconfig.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许普通装饰器</span></span><br><span class="line"><span class="attr">&quot;experimentalDecorators&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br></pre></td></tr></table></figure>
<h2 id="类装饰器"><a href="#类装饰器" class="headerlink" title="类装饰器"></a>类装饰器</h2><p>类装饰器<code>ClassDecorator</code>应用于类构造函数，可以用来监视，修改或替换类定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ClassDecorator</span> = &lt;<span class="title class_">TFunction</span> <span class="keyword">extends</span> <span class="title class_">Function</span>&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  target: TFunction <span class="comment">// 类的构造函数(也就是类本身)作为其唯一的参数</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">TFunction</span> | <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>
<p>通过装饰器给类添加属性和方法：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title class_">Base</span>: <span class="title class_">ClassDecorator</span> = <span class="function">(<span class="params">target: <span class="built_in">Function</span></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">// [class CLS]</span></span><br><span class="line">  target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">fn</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;chuckle&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Base</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> cls = <span class="keyword">new</span> <span class="title function_">CLS</span>() <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">cls.<span class="title function_">fn</span>() <span class="comment">// chuckle</span></span><br></pre></td></tr></table></figure>
<h3 id="返回值"><a href="#返回值" class="headerlink" title="返回值"></a>返回值</h3><p>如果类装饰器返回一个值，它会使用提供的构造函数(类)来替换类的声明。并且必须保证能覆盖原来类的属性和方法，所以通常继承原来的类。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> classDecorator&lt;T <span class="keyword">extends</span> &#123; <span class="title function_">new</span>(...<span class="attr">args</span>: <span class="built_in">any</span>[]): &#123;&#125; &#125;&gt;(<span class="attr">constructor</span>: T) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">class</span> <span class="title class_">extends</span> constructor &#123;</span><br><span class="line">    newProperty = <span class="string">&quot;new property&quot;</span>;</span><br><span class="line">    hello = <span class="string">&quot;override&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@classDecorator</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  property = <span class="string">&quot;property&quot;</span>;</span><br><span class="line">  <span class="attr">hello</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">m: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hello</span> = m;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> greeter = <span class="keyword">new</span> <span class="title class_">Greeter</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeter);</span><br><span class="line"><span class="comment">// Greeter &#123;</span></span><br><span class="line"><span class="comment">//   property: &#x27;property&#x27;,</span></span><br><span class="line"><span class="comment">//   hello: &#x27;override&#x27;,</span></span><br><span class="line"><span class="comment">//   newProperty: &#x27;new property&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>注意，应该返回一个匿名类，否则实例前面的类型提示是返回的类名，而不是原来的类名，这容易造成误解</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">a</span>: any = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">function</span> classDecorator&lt;T <span class="keyword">extends</span> &#123; <span class="title function_">new</span>(...<span class="attr">args</span>: any[]): &#123;&#125; &#125;&gt;(<span class="attr">constructor</span>: T) &#123;</span><br><span class="line">  <span class="keyword">class</span> <span class="title class_">A</span> <span class="keyword">extends</span> <span class="title class_ inherited__">constructor</span> &#123;</span><br><span class="line">    newProperty = <span class="string">&quot;new property&quot;</span>;</span><br><span class="line">    hello = <span class="string">&quot;override&quot;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  a =	A;</span><br><span class="line">  <span class="keyword">return</span>  A</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">@classDecorator</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Greeter</span> &#123;</span><br><span class="line">  property = <span class="string">&quot;property&quot;</span>;</span><br><span class="line">  <span class="attr">hello</span>: string;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">m: string</span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">hello</span> = m;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> greeter = <span class="keyword">new</span> <span class="title class_">Greeter</span>(<span class="string">&quot;world&quot;</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(greeter);</span><br><span class="line"><span class="comment">// A &#123;</span></span><br><span class="line"><span class="comment">//   property: &#x27;property&#x27;,</span></span><br><span class="line"><span class="comment">//   hello: &#x27;override&#x27;,</span></span><br><span class="line"><span class="comment">//   newProperty: &#x27;new property&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"><span class="comment">// 实际上并没有发生继承，装饰器返回的类直接覆盖了原来的类的声明，现在的 Greeter 和 A 指的都是同一个类</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(a === <span class="title class_">Greeter</span>); <span class="comment">// true</span></span><br></pre></td></tr></table></figure>
<h2 id="装饰器工厂"><a href="#装饰器工厂" class="headerlink" title="装饰器工厂"></a>装饰器工厂</h2><p>装饰器工厂是一个高阶函数（函数柯里化），外层的函数接受值，里层的函数最终接受类的构造函数</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="title function_">Base</span> = (<span class="params">name: <span class="built_in">string</span></span>) =&gt; &#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="attr">fn</span>: <span class="title class_">ClassDecorator</span> = <span class="function">(<span class="params">target: <span class="built_in">Function</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(target); <span class="comment">// [class CLS]</span></span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">name</span> = name;</span><br><span class="line">    target.<span class="property"><span class="keyword">prototype</span></span>.<span class="property">fn</span> = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(name);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> fn;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Base</span>(<span class="string">&quot;chuckle&quot;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cls = <span class="keyword">new</span> <span class="title function_">CLS</span>() <span class="keyword">as</span> <span class="built_in">any</span>;</span><br><span class="line">cls.<span class="title function_">fn</span>() <span class="comment">// chuckle</span></span><br></pre></td></tr></table></figure>
<h2 id="方法装饰器"><a href="#方法装饰器" class="headerlink" title="方法装饰器"></a>方法装饰器</h2><p>方法装饰器<code>MethodDecorator</code>应用到方法的属性描述符上，用来监视，修改或者替换方法定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">MethodDecorator</span> = &lt;T&gt;<span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  target: <span class="built_in">Object</span>, <span class="comment">// 对于静态成员来说是类的构造函数，对于实例成员是类的原型对象。</span></span></span></span><br><span class="line"><span class="params"><span class="function">  propertyKey: <span class="built_in">string</span> | symbol, <span class="comment">// 成员的名字(函数名)</span></span></span></span><br><span class="line"><span class="params"><span class="function">  descriptor: TypedPropertyDescriptor&lt;T&gt; <span class="comment">// 成员的属性描述符</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="title class_">TypedPropertyDescriptor</span>&lt;T&gt; | <span class="built_in">void</span>; <span class="comment">// 如果返回一个值，会被用作方法的属性描述符。</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">met</span>:<span class="title class_">MethodDecorator</span> = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(args);</span><br><span class="line">  <span class="comment">// [</span></span><br><span class="line">  <span class="comment">//   &#123;&#125;,</span></span><br><span class="line">  <span class="comment">//   &#x27;getName&#x27;,</span></span><br><span class="line">  <span class="comment">//   &#123;</span></span><br><span class="line">  <span class="comment">//     value: [Function: getName], // 原方法</span></span><br><span class="line">  <span class="comment">//     writable: true, // 可写</span></span><br><span class="line">  <span class="comment">//     enumerable: false, // 不可枚举</span></span><br><span class="line">  <span class="comment">//     configurable: true // 可配置</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">A</span> &#123;</span><br><span class="line">  <span class="meta">@met</span></span><br><span class="line">  getName ():<span class="built_in">string</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;chuckle&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> a = <span class="keyword">new</span> <span class="title function_">A</span>();</span><br></pre></td></tr></table></figure>
<p>实现对原方法的拦截加工：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">MethodInterceptor</span>(<span class="params">params?: <span class="built_in">string</span></span>): <span class="title class_">MethodDecorator</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">target: <span class="built_in">Object</span>, name: <span class="built_in">string</span> | symbol, decr: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = decr.<span class="property">value</span>; <span class="comment">// 保存原方法</span></span><br><span class="line">    <span class="comment">// 拦截加工原方法，不能是箭头函数, 否则 this 指向不是类的实例</span></span><br><span class="line">    decr.<span class="property">value</span> = <span class="keyword">function</span> (<span class="params">...args: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;前置拦截&#x27;</span>);</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>); <span class="comment">// CLS &#123; name: &#x27;chuckle&#x27; &#125;</span></span><br><span class="line">      temp.<span class="title function_">call</span>(<span class="variable language_">this</span>, ...args) <span class="comment">// 调用原方法</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&#x27;后置拦截&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;chuckle&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@MethodInterceptor</span>(<span class="string">&quot;chuckle&quot;</span>)</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params">...args: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(args); <span class="comment">// [ 1, 2, 3 ]</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> cls = <span class="keyword">new</span> <span class="title function_">CLS</span>()</span><br><span class="line">cls.<span class="title function_">fn</span>(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="comment">// 前置拦截</span></span><br><span class="line"><span class="comment">// CLS &#123;&#125;</span></span><br><span class="line"><span class="comment">// [ 1, 2, 3 ]</span></span><br><span class="line"><span class="comment">// 后置拦截</span></span><br></pre></td></tr></table></figure>
<h3 id="实现GET装饰器"><a href="#实现GET装饰器" class="headerlink" title="实现GET装饰器"></a>实现GET装饰器</h3><p>请求通过装饰器工厂传入的url，将返回的数据传给原方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">GET</span>(<span class="params">url: <span class="built_in">string</span></span>): <span class="title class_">MethodDecorator</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">target: <span class="built_in">Object</span>, name: <span class="built_in">string</span> | symbol, decr: PropertyDescriptor</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> fnc = decr.<span class="property">value</span>; <span class="comment">// 保存原方法</span></span><br><span class="line">    <span class="title function_">fetch</span>(url).<span class="title function_">then</span>(<span class="function"><span class="params">res</span> =&gt;</span> res.<span class="title function_">json</span>())</span><br><span class="line">      .<span class="title function_">then</span>(<span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fnc</span>(&#123;</span><br><span class="line">          <span class="attr">code</span>: <span class="number">200</span>,</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;success&#x27;</span>,</span><br><span class="line">          data</span><br><span class="line">        &#125;) <span class="comment">// 调用原方法</span></span><br><span class="line">      &#125;).<span class="title function_">catch</span>(<span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="title function_">fnc</span>(&#123;</span><br><span class="line">          <span class="attr">code</span>: <span class="number">500</span>,</span><br><span class="line">          <span class="attr">msg</span>: err,</span><br><span class="line">          <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line">  <span class="meta">@GET</span>(<span class="string">&#x27;https://api.github.com/&#x27;</span>)</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params">result: <span class="built_in">any</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">code</span>); <span class="comment">// 200</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">msg</span>); <span class="comment">// success</span></span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(result.<span class="property">data</span>); <span class="comment">// &#123; current_user_url: ..... &#125;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cls = <span class="keyword">new</span> <span class="title function_">CLS</span>();</span><br></pre></td></tr></table></figure>
<h2 id="参数装饰器"><a href="#参数装饰器" class="headerlink" title="参数装饰器"></a>参数装饰器</h2><p>参数装饰器应用于类构造函数或方法声明，没有返回值。用来监视一个方法的参数是否被传入。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ParameterDecorator</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  target: <span class="built_in">Object</span>, <span class="comment">// 对于静态成员来说是类的构造函数，对于实例成员是类的原型对象。</span></span></span></span><br><span class="line"><span class="params"><span class="function">  propertyKey: <span class="built_in">string</span> | symbol | <span class="literal">undefined</span>, <span class="comment">// 成员的名字（函数名） </span></span></span></span><br><span class="line"><span class="params"><span class="function">  parameterIndex: <span class="built_in">number</span> <span class="comment">// 参数在函数参数列表中的索引</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">currency</span>: <span class="title class_">ParameterDecorator</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  target: <span class="built_in">Object</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  key: <span class="built_in">string</span> | symbol | <span class="literal">undefined</span>,</span></span></span><br><span class="line"><span class="params"><span class="function">  index: <span class="built_in">number</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target === <span class="variable constant_">CLS</span>.<span class="property"><span class="keyword">prototype</span></span>) <span class="comment">// true</span></span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target, key, index)</span><br><span class="line">  <span class="comment">// &#123;&#125; setName 0</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line">  name = <span class="string">&#x27;chuckle&#x27;</span></span><br><span class="line">  <span class="title function_">setName</span>(<span class="params"><span class="meta">@currency</span> name: <span class="built_in">string</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="属性装饰器"><a href="#属性装饰器" class="headerlink" title="属性装饰器"></a>属性装饰器</h2><p>属性装饰器应用较少，用来监视类中是否声明了某个名字的属性。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">PropertyDecorator</span> = <span class="function">(<span class="params"></span></span></span><br><span class="line"><span class="params"><span class="function">  target: <span class="built_in">Object</span>, <span class="comment">// 对于静态成员来说是类的构造函数，对于实例成员是类的原型对象。</span></span></span></span><br><span class="line"><span class="params"><span class="function">  propertyKey: <span class="built_in">string</span> | symbol <span class="comment">// 成员的名字(属性名)</span></span></span></span><br><span class="line"><span class="params"><span class="function"></span>) =&gt;</span> <span class="built_in">void</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">met</span>: <span class="title class_">PropertyDecorator</span> = <span class="function">(<span class="params">target: <span class="built_in">Object</span>, key: <span class="built_in">string</span> | symbol</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(target, key); <span class="comment">// &#123;&#125; name</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line">  <span class="meta">@met</span></span><br><span class="line">  name = <span class="string">&#x27;chuckle&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="顺序"><a href="#顺序" class="headerlink" title="顺序"></a>顺序</h2><p>多个同类型装饰器可以同时应用到一个声明上</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 书写在同一行上：</span></span><br><span class="line"><span class="meta">@f</span> <span class="meta">@g</span> x</span><br><span class="line"><span class="comment">// 书写在多行上：</span></span><br><span class="line"><span class="meta">@f</span></span><br><span class="line"><span class="meta">@g</span></span><br><span class="line">x</span><br></pre></td></tr></table></figure>
<p>求值方式与复合函数相似。复合的结果(f ∘ g)(x)等同于f(g(x))。</p>
<p>当多个装饰器应用在一个声明上时会进行如下步骤的操作：</p>
<ol>
<li>由上至下依次对装饰器表达式求值。</li>
<li>求值的结果会被当作函数，由下至上依次调用（应用）。</li>
</ol>
<h3 id="装饰器求值"><a href="#装饰器求值" class="headerlink" title="装饰器求值"></a>装饰器求值</h3><p>类中不同声明上的装饰器将按以下规定的顺序应用：</p>
<ol>
<li>参数装饰器，然后依次是方法装饰器，访问符装饰器，或属性装饰器应用到每个实例成员。</li>
<li>参数装饰器，然后依次是方法装饰器，访问符装饰器，或属性装饰器应用到每个静态成员。</li>
<li>参数装饰器应用到构造函数。</li>
<li>类装饰器应用到类。</li>
</ol>
<p>方法参数装饰器执行的优先级最高，而方法和属性装饰器受到定义顺序的影响。类与构造器参数装饰器优先级最低。</p>
<h1 id="元数据"><a href="#元数据" class="headerlink" title="元数据"></a>元数据</h1><p>对象、类等都是数据，它们描述了某种数据，而<strong>描述这些数据的数据就是元数据</strong></p>
<p><a target="_blank" rel="noopener" href="https://www.npmjs.com/package/reflect-metadata">reflect-metadata</a> 库通过添加对元数据的支持，使得装饰器能够更方便地访问和修改类和方法的元数据，也许还会提示安装tslib</p>
<p>安装：<code>npm i reflect-metadata tslib</code></p>
<figure class="highlight ts"><figcaption><span>引入，扩展了全局API Reflect</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> <span class="string">&#x27;reflect-metadata&#x27;</span></span><br></pre></td></tr></table></figure>
<p>在装饰器中可以拿到类、方法、访问符、属性、参数的基本信息，如名称，描述符等。获取更多信息就需要元数据。</p>
<p>在编译过程中产生的元数据是非常重要的信息，在 nestjs 框架中 DI 和 IOC 的实现就依赖了他们。</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/617505961">深入浅出Typescript装饰器</a><br><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/480376523">TS 装饰器(2): 元数据</a></p>
<h2 id="定义-获取元数据"><a href="#定义-获取元数据" class="headerlink" title="定义/获取元数据"></a>定义/获取元数据</h2><p><code>Reflect.defineMetadata()</code>定义元数据：给对象、类等数据附加额外的描述信息，但又不会影响到数据本身。<br><code>Reflect.getMetadata()</code> 获取元数据。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 为类或对象定义元数据</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(key, value, classObject)</span><br><span class="line"><span class="comment">// 为classPrototype[methodName]方法定义元数据</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(key, value, classPrototype, methodName)</span><br><span class="line"><span class="comment">// 为classPrototype[propKey]属性定义元数据</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(key, value, classPrototype, propKey)</span><br><span class="line"><span class="comment">// 获取元数据</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(metadataKey, target, propertyKey?)</span><br></pre></td></tr></table></figure>
<p>前两个参数分别是元数据的key和value，<strong>都是any类型</strong>，后面的参数设定了要将元数据定义给谁。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123; </span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;chuckle&#x27;</span>,</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>)&#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义在obj对象上</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(<span class="string">&#x27;testKey1&#x27;</span>, <span class="string">&#x27;testValue1&#x27;</span>, obj)</span><br><span class="line"><span class="comment">// 定义在obj对象的name属性上</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(<span class="string">&#x27;testKey2&#x27;</span>, <span class="string">&#x27;testValue2&#x27;</span>, obj, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="comment">// 定义在obj对象的fn方法上</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(<span class="string">&#x27;testKey3&#x27;</span>, <span class="string">&#x27;testValue3&#x27;</span>, obj, <span class="string">&#x27;fn&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取obj对象上的元数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey1&#x27;</span>, obj)) <span class="comment">// testValue2</span></span><br><span class="line"><span class="comment">// 获取obj对象的name属性上的元数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey2&#x27;</span>, obj, <span class="string">&#x27;name&#x27;</span>)) <span class="comment">// testValue2</span></span><br><span class="line"><span class="comment">// 获取obj对象的fn方法上的元数据</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey3&#x27;</span>, obj, <span class="string">&#x27;fn&#x27;</span>)) <span class="comment">// testValue3</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 不存在的元数据，返回undefined</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;test&#x27;</span>, obj)) <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure>
<p>元数据可以定义在不存在的对象成员上，并且能正常获取</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;&#125;</span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">defineMetadata</span>(<span class="string">&#x27;testKey&#x27;</span>, <span class="string">&#x27;testValue&#x27;</span>, obj, <span class="string">&#x27;name&#x27;</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey&#x27;</span>, obj, <span class="string">&#x27;name&#x27;</span>)) <span class="comment">// testValue</span></span><br></pre></td></tr></table></figure>
<h3 id="在类中定义"><a href="#在类中定义" class="headerlink" title="在类中定义"></a>在类中定义</h3><p><code>Reflect.defineMetadata</code>多给普通对象定义元数据</p>
<p>类使用 <code>@Reflect.metadata</code> 元数据装饰器，更方便地定义元数据，参数只有key和value</p>
<p>类元数据直接定义在类的构造函数上，而类成员的元数据定义在原型对象对应的属性上（无论实际上是否存在该属性），实例也会被赋予类成员元数据的副本</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;testKey1&#x27;</span>, <span class="string">&#x27;testValue1&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CLS</span> &#123;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;testKey2&#x27;</span>, <span class="string">&#x27;testValue2&#x27;</span>)</span><br><span class="line">  name = <span class="string">&#x27;chuckle&#x27;</span></span><br><span class="line"></span><br><span class="line">  <span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;testKey3&#x27;</span>, <span class="string">&#x27;testValue3&#x27;</span>)</span><br><span class="line">  <span class="title function_">fn</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> cls = <span class="keyword">new</span> <span class="title function_">CLS</span>();</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey1&#x27;</span>, <span class="variable constant_">CLS</span>)) <span class="comment">// testValue1</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey2&#x27;</span>, <span class="variable constant_">CLS</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;name&#x27;</span>)) <span class="comment">// testValue2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey3&#x27;</span>, <span class="variable constant_">CLS</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;fn&#x27;</span>)) <span class="comment">// testValue3</span></span><br><span class="line"><span class="comment">// 实例也会被赋予类成员的元数据的副本</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;testKey2&#x27;</span>, cls, <span class="string">&#x27;name&#x27;</span>)) <span class="comment">// testValue2</span></span><br></pre></td></tr></table></figure>
<h2 id="其它方法"><a href="#其它方法" class="headerlink" title="其它方法"></a>其它方法</h2><p><strong>Reflect</strong>还有一些方法</p>
<ol>
<li><code>hasMetadata</code> 判断指定目标是否存在指定key的元数据</li>
<li><code>hasOwnMetadata</code> 判断指定目标是否存在指定key的元数据</li>
<li><code>getMetadataKeys</code> 获取指定目标的所有的元数据key组成的数组，包括其父类的元数据key</li>
<li><code>getOwnMetadataKeys</code> 获取指定目标自身的所有的元数据key组成的数组，不包括其父类的元数据key</li>
</ol>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;key1&#x27;</span>, <span class="string">&#x27;value1&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span>&#123; &#125;</span><br><span class="line"><span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;key2&#x27;</span>, <span class="string">&#x27;value2&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span>&#123; &#125;</span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadataKeys</span>(<span class="title class_">Child</span>)) <span class="comment">// [ &#x27;key2&#x27;, &#x27;key1&#x27; ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getOwnMetadataKeys</span>(<span class="title class_">Child</span>)) <span class="comment">// [ &#x27;key2&#x27; ]</span></span><br><span class="line"></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">hasMetadata</span>(<span class="string">&#x27;key1&#x27;</span>, <span class="title class_">Child</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">hasOwnMetadata</span>(<span class="string">&#x27;key1&#x27;</span>, <span class="title class_">Child</span>)) <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<h2 id="内置元数据"><a href="#内置元数据" class="headerlink" title="内置元数据"></a>内置元数据</h2><p>开启<code>emitDecoratorMetadata</code>配置，TS 会在编译后自动给类和类成员添加如下元数据:</p>
<ol>
<li><code>design:type</code>：被装饰目标的类型<ul>
<li>成员属性：属性的标注类型</li>
<li>成员方法：Function 类型</li>
</ul>
</li>
<li><code>design:paramtypes</code>: 被装饰目标的参数类型<ul>
<li>成员方法：方法形参列表的标注类型</li>
<li>类：构造函数形参列表的标注类型</li>
</ul>
</li>
<li><code>design:returntype</code><ul>
<li>成员方法：函数返回值的标注类型</li>
</ul>
</li>
</ol>
<figure class="highlight json"><figcaption><span>tsconfig.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 允许自动添加内置元数据</span></span><br><span class="line"><span class="attr">&quot;emitDecoratorMetadata&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span>  </span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong></p>
<ol>
<li>只有你已经给目标添加了元数据，TS才会自动为这些目标添加内置元数据。</li>
<li>标注类型，即在代码中显式标注参数、返回值、属性等的类型，而不能靠自动推断。</li>
</ol>
<p>通过 <code>design:paramtypes</code> 可以获取到方法中有多少个参数，每个参数的类型等信息</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">People</span> &#123;</span><br><span class="line">  <span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line"></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params">name: <span class="built_in">string</span>, age: <span class="built_in">number</span></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;key&#x27;</span>, <span class="string">&#x27;value&#x27;</span>)</span><br><span class="line">  <span class="title function_">setName</span>(<span class="attr">name</span>: <span class="built_in">string</span>): <span class="built_in">string</span>&#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">name</span> = name</span><br><span class="line">    <span class="keyword">return</span> <span class="variable language_">this</span>.<span class="property">name</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取标注的参数信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;design:paramtypes&#x27;</span>, <span class="title class_">People</span>))</span><br><span class="line"><span class="comment">// [ [Function: String], [Function: Number] ]</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;design:paramtypes&#x27;</span>, <span class="title class_">People</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;setName&#x27;</span>))</span><br><span class="line"><span class="comment">// [ [Function: String] ]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取标注的返回值信息</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;design:returntype&#x27;</span>, <span class="title class_">People</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;setName&#x27;</span>))</span><br><span class="line"><span class="comment">// [Function: String]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 获取标注的属性类型</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadata</span>(<span class="string">&#x27;design:type&#x27;</span>, <span class="title class_">People</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;name&#x27;</span>))</span><br><span class="line"><span class="comment">// [Function: String]</span></span><br></pre></td></tr></table></figure>
<p>总之就是将你在代码中显式标注的类型信息，转为对应元数据定义在对应的类或类成员上</p>
<h2 id="元数据的继承"><a href="#元数据的继承" class="headerlink" title="元数据的继承"></a>元数据的继承</h2><p>元数据可以很好的适配于类之间的继承关系，父类会将其元数据的副本赋予子类，包括类本身和类成员的元数据</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Parent</span> &#123;</span><br><span class="line">  <span class="meta">@Reflect</span>.<span class="title function_">metadata</span>(<span class="string">&#x27;aa&#x27;</span>, <span class="string">&#x27;aa&#x27;</span>)</span><br><span class="line">  aa = <span class="number">1</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Child</span> <span class="keyword">extends</span> <span class="title class_ inherited__">Parent</span> &#123; &#125;</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">Reflect</span>.<span class="title function_">getMetadataKeys</span>(<span class="title class_">Child</span>.<span class="property"><span class="keyword">prototype</span></span>, <span class="string">&#x27;aa&#x27;</span>))</span><br><span class="line"><span class="comment">// [ &#x27;design:type&#x27;, &#x27;aa&#x27; ]</span></span><br></pre></td></tr></table></figure>
<h1 id="搭建TS环境"><a href="#搭建TS环境" class="headerlink" title="搭建TS环境"></a>搭建TS环境</h1><p>使用Rollup、Webpack等打包构建工具开发TS项目</p>
<h2 id="Rollup"><a href="#Rollup" class="headerlink" title="Rollup"></a>Rollup</h2><p>详见：<a href="/article/d9966eb3.html#配置TS环境">Rollup#配置TS环境</a></p>
<figure class="highlight json"><figcaption><span>我的tsconfig.json</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;incremental&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// TS编译器在第一次编译之后会生成一个存储编译信息的文件，第二次编译会在第一次的基础上进行增量编译，可以提高编译的速度</span></span><br><span class="line">    <span class="attr">&quot;tsBuildInfoFile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./buildFile&quot;</span><span class="punctuation">,</span> <span class="comment">// 增量编译文件的存储位置</span></span><br><span class="line">    <span class="attr">&quot;diagnostics&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 打印诊断信息 </span></span><br><span class="line">    <span class="attr">&quot;target&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span> <span class="comment">/* 指定 ECMAScript 目标版本：&#x27;ES3&#x27; (default), &#x27;ES5&#x27;, &#x27;ES2015&#x27;, &#x27;ES2016&#x27;, &#x27;ES2017&#x27;,&#x27;ES2018&#x27; or &#x27;ESNEXT&#x27;. */</span></span><br><span class="line">    <span class="attr">&quot;module&quot;</span><span class="punctuation">:</span> <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span> <span class="comment">/* 输出的代码使用什么方式进行模块化： &#x27;none&#x27;, &#x27;commonjs&#x27;, &#x27;amd&#x27;, &#x27;system&#x27;, &#x27;umd&#x27;, &#x27;es2015&#x27;, or &#x27;ESNext&#x27;. */</span></span><br><span class="line">    <span class="attr">&quot;lib&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span> <span class="comment">/* 指定引用的标准库 */</span></span><br><span class="line">      <span class="string">&quot;esnext&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;dom&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="string">&quot;dom.iterable&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// TS需要引用的库，即声明文件，es5 默认引用dom、es5、scripthost,如需要使用es的高级版本特性，通常都需要配置，如es8的数组新特性需要引入&quot;ES2019.Array&quot;,</span></span><br><span class="line">    <span class="attr">&quot;allowJs&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许编译器编译JS，JSX文件</span></span><br><span class="line">    <span class="attr">&quot;checkJs&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许在JS文件中报错，通常与allowJS一起使用</span></span><br><span class="line">    <span class="attr">&quot;outDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定输出目录</span></span><br><span class="line">    <span class="attr">&quot;rootDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./src&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定输出文件目录(用于输出)，用于控制输出目录结构</span></span><br><span class="line">    <span class="attr">&quot;declaration&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 生成声明文件，开启后会自动生成声明文件</span></span><br><span class="line">    <span class="attr">&quot;declarationDir&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./dist/typings&quot;</span><span class="punctuation">,</span> <span class="comment">// 指定生成声明文件存放目录</span></span><br><span class="line">    <span class="comment">// &quot;emitDeclarationOnly&quot;: true, // 只生成声明文件，而不会生成js文件</span></span><br><span class="line">    <span class="attr">&quot;sourceMap&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="comment">// 生成目标文件的sourceMap文件</span></span><br><span class="line">    <span class="comment">// &quot;inlineSourceMap&quot;: true, // 生成目标文件的inline SourceMap，inline SourceMap会包含在生成的js文件中</span></span><br><span class="line">    <span class="attr">&quot;declarationMap&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span> <span class="comment">// 为声明文件生成sourceMap</span></span><br><span class="line">    <span class="comment">// &quot;typeRoots&quot;: [], // 声明文件目录，默认时node_modules/@types</span></span><br><span class="line">    <span class="attr">&quot;types&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 加载的声明文件包</span></span><br><span class="line">    <span class="attr">&quot;removeComments&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 删除注释 </span></span><br><span class="line">    <span class="attr">&quot;noEmit&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不输出文件,即编译后不会生成任何js文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitOnError&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 发送错误时不输出任何文件</span></span><br><span class="line">    <span class="attr">&quot;noEmitHelpers&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不生成helper函数，减小体积，需要额外安装，常配合importHelpers一起使用</span></span><br><span class="line">    <span class="attr">&quot;importHelpers&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 通过tslib引入helper函数，文件必须是模块</span></span><br><span class="line">    <span class="attr">&quot;downlevelIteration&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 降级遍历器实现，如果目标源是es3/5，那么遍历器会有降级的实现</span></span><br><span class="line">    <span class="attr">&quot;strict&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 开启所有严格的类型检查</span></span><br><span class="line">    <span class="attr">&quot;alwaysStrict&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 在代码中注入&#x27;use strict&#x27;</span></span><br><span class="line">    <span class="attr">&quot;noImplicitAny&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;strictNullChecks&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许把null、undefined赋值给其他类型的变量</span></span><br><span class="line">    <span class="attr">&quot;strictFunctionTypes&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许函数参数双向协变</span></span><br><span class="line">    <span class="attr">&quot;strictPropertyInitialization&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 类的实例属性必须初始化</span></span><br><span class="line">    <span class="attr">&quot;strictBindCallApply&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 严格的bind/call/apply检查</span></span><br><span class="line">    <span class="attr">&quot;noImplicitThis&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 不允许this有隐式的any类型</span></span><br><span class="line">    <span class="attr">&quot;noUnusedLocals&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 检查只声明、未使用的局部变量(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noUnusedParameters&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 检查未使用的函数参数(只提示不报错)</span></span><br><span class="line">    <span class="attr">&quot;noFallthroughCasesInSwitch&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 防止switch语句贯穿(即如果没有break语句后面不会执行)</span></span><br><span class="line">    <span class="attr">&quot;noImplicitReturns&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">//每个分支都会有返回值</span></span><br><span class="line">    <span class="attr">&quot;esModuleInterop&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许export=导出，由import from 导入</span></span><br><span class="line">    <span class="attr">&quot;allowUmdGlobalAccess&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 允许在模块中全局变量的方式访问umd模块</span></span><br><span class="line">    <span class="attr">&quot;moduleResolution&quot;</span><span class="punctuation">:</span> <span class="string">&quot;node&quot;</span><span class="punctuation">,</span> <span class="comment">// 模块解析策略，ts默认用node的解析策略，即相对的方式导入</span></span><br><span class="line">    <span class="attr">&quot;baseUrl&quot;</span><span class="punctuation">:</span> <span class="string">&quot;./&quot;</span><span class="punctuation">,</span> <span class="comment">// 解析非相对模块的基地址，默认是当前目录</span></span><br><span class="line">    <span class="attr">&quot;paths&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span> <span class="comment">// 路径映射，相对于baseUrl</span></span><br><span class="line">      <span class="comment">// 如使用jq时不想使用默认版本，而需要手动指定版本，可进行如下配置</span></span><br><span class="line">      <span class="comment">// &quot;jquery&quot;: [</span></span><br><span class="line">      <span class="comment">//   &quot;node_modules/jquery/dist/jquery.min.js&quot;</span></span><br><span class="line">      <span class="comment">// ],</span></span><br><span class="line">      <span class="attr">&quot;@/*&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="string">&quot;src/*&quot;</span></span><br><span class="line">      <span class="punctuation">]</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;rootDirs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="string">&quot;src&quot;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span> <span class="comment">// 将多个目录放在一个虚拟目录下，用于运行时，即编译后引入文件的位置可能发生变化，这也设置可以虚拟src和out在同一个目录下，不用再去改变路径也不会报错</span></span><br><span class="line">    <span class="attr">&quot;listEmittedFiles&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 打印输出文件</span></span><br><span class="line">    <span class="attr">&quot;listFiles&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span> <span class="comment">// 打印编译的文件(包括引用的声明文件)</span></span><br><span class="line">    <span class="attr">&quot;experimentalDecorators&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;emitDecoratorMetadata&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;resolveJsonModule&quot;</span><span class="punctuation">:</span> <span class="keyword">true</span></span><br><span class="line">  <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 指定一个匹配列表（属于自动指定该路径下的所有ts相关文件）</span></span><br><span class="line">  <span class="attr">&quot;include&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">    <span class="string">&quot;src/**/*&quot;</span><span class="punctuation">,</span></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="comment">// 指定一个排除列表（include的反向操作）</span></span><br><span class="line">  <span class="comment">// &quot;exclude&quot;: [</span></span><br><span class="line">  <span class="comment">//   &quot;demo.ts&quot;</span></span><br><span class="line">  <span class="comment">// ],</span></span><br><span class="line">  <span class="comment">// 指定哪些文件使用该配置（属于手动一个个指定文件）</span></span><br><span class="line">  <span class="comment">// &quot;files&quot;: [</span></span><br><span class="line">  <span class="comment">//   &quot;demo.ts&quot;</span></span><br><span class="line">  <span class="comment">// ]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="Webpack"><a href="#Webpack" class="headerlink" title="Webpack"></a>Webpack</h2><p>详见：<a href="/article/764f33bc.html#配置TS环境">Webpack#配置TS环境</a></p>
<h2 id="esbuild-swc"><a href="#esbuild-swc" class="headerlink" title="esbuild+swc"></a>esbuild+swc</h2><p>安装：<code>npm i @swc/core esbuild @swc/helpers -D</code></p>
<p><strong>@swc/core</strong> 是 swc 的核心包，用于编译 JavaScript 和 TypeScript 代码；<strong>esbuild</strong> 是一个快速的 JavaScript 和 TypeScript 构建工具；<strong>@swc/helpers</strong> 是 swc 的辅助包，用于转换 JSX 代码</p>
<p>运行：node ./config.mjs</p>
<figure class="highlight js"><figcaption><span>config.mjs</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> esbuild <span class="keyword">from</span> <span class="string">&#x27;esbuild&#x27;</span><span class="comment">//打包工具</span></span><br><span class="line"><span class="keyword">import</span> swc <span class="keyword">from</span> <span class="string">&#x27;@swc/core&#x27;</span><span class="comment">//类似于babel es6 转 es5</span></span><br><span class="line"><span class="keyword">import</span> fs <span class="keyword">from</span> <span class="string">&#x27;node:fs&#x27;</span></span><br><span class="line">esbuild.<span class="title function_">build</span>(&#123;</span><br><span class="line">  <span class="attr">entryPoints</span>: [<span class="string">&#x27;./src/index.ts&#x27;</span>], <span class="comment">//入口文件</span></span><br><span class="line">  <span class="attr">bundle</span>: <span class="literal">true</span>, <span class="comment">//模块单独打包</span></span><br><span class="line">  <span class="attr">loader</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;.js&#x27;</span>: <span class="string">&#x27;js&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.ts&#x27;</span>: <span class="string">&#x27;ts&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.jsx&#x27;</span>: <span class="string">&#x27;jsx&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;.tsx&#x27;</span>: <span class="string">&#x27;tsx&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">treeShaking</span>:<span class="literal">true</span>,</span><br><span class="line">  <span class="attr">define</span>: &#123;</span><br><span class="line">    <span class="string">&#x27;process.env.NODE_ENV&#x27;</span>: <span class="string">&#x27;&quot;production&quot;&#x27;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">plugins</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="comment">//实现自定义loader</span></span><br><span class="line">      <span class="attr">name</span>: <span class="string">&quot;swc-loader&quot;</span>,</span><br><span class="line">      <span class="title function_">setup</span>(<span class="params">build</span>) &#123;</span><br><span class="line">        build.<span class="title function_">onLoad</span>(&#123; <span class="attr">filter</span>: <span class="regexp">/\.(js|ts|tsx|jsx)$/</span> &#125;, <span class="function">(<span class="params">args</span>) =&gt;</span> &#123;</span><br><span class="line">          <span class="comment">// console.log(args);</span></span><br><span class="line">          <span class="keyword">const</span> content = fs.<span class="title function_">readFileSync</span>(args.<span class="property">path</span>, <span class="string">&quot;utf-8&quot;</span>)</span><br><span class="line">          <span class="keyword">const</span> &#123; code &#125; = swc.<span class="title function_">transformSync</span>(content, &#123;</span><br><span class="line">            <span class="attr">filename</span>: args.<span class="property">path</span></span><br><span class="line">          &#125;)</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="attr">contents</span>: code</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">outdir</span>: <span class="string">&quot;dist&quot;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>写一些小玩意练练手</p>
<h2 id="封装LocalStorage"><a href="#封装LocalStorage" class="headerlink" title="封装LocalStorage"></a>封装LocalStorage</h2><p>实验 Rollup + TS 封装一个支持过期时间的LocalStorage</p>
<figure class="highlight ts"><figcaption><span>src/enum/index.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 字典</span></span><br><span class="line"><span class="keyword">export</span> <span class="built_in">enum</span> <span class="title class_">Dictionaries</span> &#123;</span><br><span class="line">  <span class="comment">// 过期时间key</span></span><br><span class="line">  expire = <span class="string">&#x27;__expire__&#x27;</span>,</span><br><span class="line">  <span class="comment">// 永不过期</span></span><br><span class="line">  permanent = <span class="string">&#x27;permanent&#x27;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><figcaption><span>src/types/index.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dictionaries</span> &#125; <span class="keyword">from</span> <span class="string">&quot;../enum&quot;</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> <span class="title class_">Key</span> = <span class="built_in">string</span> <span class="comment">// key类型</span></span><br><span class="line"><span class="comment">// 永不过期 | 过期时间的时间戳</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">type</span> expire = <span class="title class_">Dictionaries</span>.<span class="property">permanent</span> | <span class="built_in">number</span></span><br><span class="line"><span class="comment">// LocalStorage数据结构</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Data</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">value</span>: T,</span><br><span class="line">  [<span class="title class_">Dictionaries</span>.<span class="property">expire</span>]: expire</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 获取LocalStorage结果</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">  <span class="attr">message</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="attr">value</span>: T | <span class="literal">null</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 定义封装LocalStorage类</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> <span class="title class_">StorageCls</span> &#123;</span><br><span class="line">  <span class="attr">set</span>: &lt;T&gt;<span class="function">(<span class="params">key: Key, value: T, expire: expire</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="attr">get</span>: &lt;T&gt;<span class="function">(<span class="params">key: Key</span>) =&gt;</span> <span class="title class_">Result</span>&lt;T | <span class="literal">null</span>&gt;</span><br><span class="line">  <span class="attr">remove</span>: <span class="function">(<span class="params">key: Key</span>) =&gt;</span> <span class="built_in">void</span></span><br><span class="line">  <span class="attr">clear</span>: <span class="function">() =&gt;</span> <span class="built_in">void</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><figcaption><span>src/index.ts</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Dictionaries</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./enum&quot;</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; <span class="title class_">Key</span>, <span class="title class_">Result</span>, <span class="title class_">StorageCls</span>, expire, <span class="title class_">Data</span> &#125; <span class="keyword">from</span> <span class="string">&quot;./types&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LLS</span> <span class="keyword">implements</span> <span class="title class_">StorageCls</span> &#123;</span><br><span class="line">  set&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">key</span>: <span class="title class_">Key</span>, <span class="attr">value</span>: T, <span class="attr">expire</span>: expire): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="title class_">Data</span>&lt;T&gt; = &#123;</span><br><span class="line">      value,</span><br><span class="line">      [<span class="title class_">Dictionaries</span>.<span class="property">expire</span>]: expire</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">setItem</span>(key, <span class="title class_">JSON</span>.<span class="title function_">stringify</span>(data))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  get&lt;T = <span class="built_in">any</span>&gt;(<span class="attr">key</span>: <span class="title class_">Key</span>): <span class="title class_">Result</span>&lt;T | <span class="literal">null</span>&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">data</span>: <span class="title class_">Data</span>&lt;T&gt; | <span class="literal">null</span> = <span class="title class_">JSON</span>.<span class="title function_">parse</span>(<span class="variable language_">localStorage</span>.<span class="title function_">getItem</span>(key) || <span class="string">&#x27;null&#x27;</span>)</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">result</span>: <span class="title class_">Result</span>&lt;T | <span class="literal">null</span>&gt; = &#123;</span><br><span class="line">      <span class="attr">message</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">      <span class="attr">value</span>: <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (data === <span class="literal">null</span>) &#123;</span><br><span class="line">      result.<span class="property">message</span> = <span class="string">`找不到<span class="subst">$&#123;key&#125;</span>`</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="variable language_">this</span>.<span class="title function_">isOverdue</span>(data[<span class="title class_">Dictionaries</span>.<span class="property">expire</span>])) &#123;</span><br><span class="line">      result.<span class="property">message</span> = <span class="string">`<span class="subst">$&#123;key&#125;</span>已过期`</span></span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">remove</span>(key)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      result.<span class="property">message</span> = <span class="string">`获取<span class="subst">$&#123;key&#125;</span>成功`</span></span><br><span class="line">      result.<span class="property">value</span> = data.<span class="property">value</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">remove</span>(<span class="attr">key</span>: <span class="built_in">string</span>): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">removeItem</span>(key)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="title function_">clear</span>(): <span class="built_in">void</span> &#123;</span><br><span class="line">    <span class="variable language_">localStorage</span>.<span class="title function_">clear</span>()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">private</span> <span class="title function_">isOverdue</span>(<span class="attr">expire</span>: expire): <span class="built_in">boolean</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> now = <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>()</span><br><span class="line">    <span class="keyword">if</span> (expire === <span class="title class_">Dictionaries</span>.<span class="property">permanent</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">typeof</span> expire === <span class="string">&#x27;number&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> expire &lt; now ? <span class="literal">true</span> : <span class="literal">false</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 测试代码</span></span><br><span class="line"><span class="keyword">const</span> sl = <span class="keyword">new</span> <span class="title function_">LLS</span>()</span><br><span class="line"><span class="comment">// 5s后过期</span></span><br><span class="line">sl.<span class="property">set</span>&lt;<span class="built_in">number</span>&gt;(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>, <span class="keyword">new</span> <span class="title class_">Date</span>().<span class="title function_">getTime</span>() + <span class="number">5000</span>)</span><br><span class="line"><span class="built_in">setInterval</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> a = sl.<span class="property">get</span>&lt;<span class="built_in">number</span>&gt;(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(a)</span><br><span class="line">&#125;, <span class="number">500</span>)</span><br></pre></td></tr></table></figure>
<h2 id="发布订阅模式"><a href="#发布订阅模式" class="headerlink" title="发布订阅模式"></a>发布订阅模式</h2><p>实现个类似addEventListener、Vue evnetBus的发布订阅模式Demo</p>
<p>一个消息可以挂载多个订阅方法</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅方法</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EventFun</span> &#123;</span><br><span class="line">  (...<span class="attr">args</span>: <span class="built_in">any</span>[]): <span class="built_in">any</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EventCls</span> &#123;</span><br><span class="line">  <span class="comment">// 订阅消息</span></span><br><span class="line">  <span class="title function_">on</span>(<span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">callback</span>: <span class="title class_">EventFun</span>): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 发布消息</span></span><br><span class="line">  <span class="title function_">emit</span>(<span class="attr">name</span>: <span class="built_in">string</span>, ...<span class="attr">args</span>: <span class="built_in">any</span>[]): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 取消订阅</span></span><br><span class="line">  <span class="title function_">off</span>(<span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">fn</span>: <span class="title class_">EventFun</span>): <span class="built_in">void</span></span><br><span class="line">  <span class="comment">// 只订阅一次</span></span><br><span class="line">  <span class="title function_">once</span>(<span class="attr">name</span>: <span class="built_in">string</span>, <span class="attr">fn</span>: <span class="title class_">EventFun</span>): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">CallbackArr</span> = <span class="title class_">Array</span>&lt;<span class="title class_">EventFun</span>&gt;</span><br><span class="line"><span class="comment">// 保存所有消息</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">EventList</span> &#123;</span><br><span class="line">  <span class="comment">// 消息名:订阅的方法集合</span></span><br><span class="line">  [<span class="attr">key</span>: <span class="built_in">string</span>]: <span class="title class_">CallbackArr</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SubPub</span> <span class="keyword">implements</span> <span class="title class_">EventCls</span> &#123;</span><br><span class="line">  <span class="attr">list</span>: <span class="title class_">EventList</span></span><br><span class="line">  <span class="title function_">constructor</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span> = &#123;&#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">on</span>(<span class="params">name: <span class="built_in">string</span>, callback: EventFun</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">callbackList</span>: <span class="title class_">CallbackArr</span> = <span class="variable language_">this</span>.<span class="property">list</span>[name] || [];</span><br><span class="line">    callbackList.<span class="title function_">push</span>(callback)</span><br><span class="line">    <span class="variable language_">this</span>.<span class="property">list</span>[name] = callbackList</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">emit</span>(<span class="params">name: <span class="built_in">string</span>, ...args: <span class="built_in">any</span>[]</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">callbackList</span>: <span class="title class_">CallbackArr</span> = <span class="variable language_">this</span>.<span class="property">list</span>[name]</span><br><span class="line">    <span class="keyword">if</span> (callbackList) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callbackList.<span class="property">length</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;该消息没有订阅者&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      callbackList.<span class="title function_">forEach</span>(<span class="function"><span class="params">callback</span> =&gt;</span> &#123;</span><br><span class="line">        callback.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;没有该消息&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">off</span>(<span class="params">name: <span class="built_in">string</span>, fn: EventFun</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">callbackList</span>: <span class="title class_">CallbackArr</span> = <span class="variable language_">this</span>.<span class="property">list</span>[name]</span><br><span class="line">    <span class="keyword">if</span> (callbackList) &#123;</span><br><span class="line">      <span class="keyword">if</span> (callbackList.<span class="property">length</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;该消息没有订阅者&quot;</span>)</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">const</span> index = callbackList.<span class="title function_">findIndex</span>(<span class="function"><span class="params">fns</span> =&gt;</span> fns === fn)</span><br><span class="line">      index &gt; -<span class="number">1</span> ? callbackList.<span class="title function_">splice</span>(index, <span class="number">1</span>) : <span class="literal">null</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">warn</span>(<span class="string">&quot;没有该消息&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="title function_">once</span>(<span class="params">name: <span class="built_in">string</span>, fn: EventFun</span>) &#123;</span><br><span class="line">    <span class="keyword">const</span> <span class="attr">decor</span>: <span class="title class_">EventFun</span> = <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">      fn.<span class="title function_">apply</span>(<span class="variable language_">this</span>, args)</span><br><span class="line">      <span class="variable language_">this</span>.<span class="title function_">off</span>(name, decor)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="variable language_">this</span>.<span class="title function_">on</span>(name, decor)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>测试：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> subPub = <span class="keyword">new</span> <span class="title class_">SubPub</span>()</span><br><span class="line"><span class="comment">// 测试on和off</span></span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">678</span>) <span class="comment">// 没有该消息</span></span><br><span class="line"><span class="keyword">const</span> <span class="attr">fn</span>: <span class="title class_">EventFun</span> = <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg);</span><br><span class="line">&#125;</span><br><span class="line">subPub.<span class="title function_">on</span>(<span class="string">&#x27;abc&#x27;</span>, fn)</span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">131</span>, <span class="literal">true</span>) <span class="comment">// [ 131, true ]</span></span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">678</span>, <span class="literal">false</span>, <span class="string">&#x27;qx&#x27;</span>) <span class="comment">// [ 678, false, &#x27;qx&#x27; ]</span></span><br><span class="line">subPub.<span class="title function_">off</span>(<span class="string">&#x27;abc&#x27;</span>, fn)</span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;abc&#x27;</span>, <span class="number">321</span>, <span class="string">&#x27;qx&#x27;</span>) <span class="comment">// 该消息没有订阅者</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;=======================&quot;</span>);</span><br><span class="line"><span class="comment">// 测试once</span></span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">678</span>) <span class="comment">// 没有该消息</span></span><br><span class="line">subPub.<span class="title function_">once</span>(<span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg);</span><br><span class="line">&#125;)</span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">678</span>, <span class="string">&#x27;abc&#x27;</span>) <span class="comment">// [ 678, &#x27;abc&#x27; ]</span></span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>, <span class="string">&#x27;qx&#x27;</span>) <span class="comment">// 该消息没有订阅者</span></span><br><span class="line">subPub.<span class="title function_">on</span>(<span class="string">&#x27;a&#x27;</span>, <span class="function">(<span class="params">...arg</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(arg);</span><br><span class="line">&#125;)</span><br><span class="line">subPub.<span class="title function_">emit</span>(<span class="string">&#x27;a&#x27;</span>, <span class="number">123</span>, <span class="string">&#x27;qx&#x27;</span>) <span class="comment">// [ 123, &#x27;qx&#x27; ]</span></span><br></pre></td></tr></table></figure>
<h1 id="Proxy、Reflect"><a href="#Proxy、Reflect" class="headerlink" title="Proxy、Reflect"></a>Proxy、Reflect</h1><p>Proxy(代理)和Reflect(反射)是ES6为了操作对象而提供的新API，它们为开发者提供了对对象行为进行拦截和自定义的能力</p>
<p>Proxy和Reflect都有13个名字和参数一模一样的方法，因为对象的操作无非就get、set等</p>
<p>ES6推荐用Proxy去代理对对象的操作，用Reflect实现对对象的实际操作</p>
<h2 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h2><p><strong>Proxy基本操作：</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@interface</span> <span class="variable">ProxyHandler</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@template</span> <span class="variable">T</span> - 泛型，代表被代理对象的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ProxyHandler</span>&lt;T <span class="keyword">extends</span> <span class="built_in">object</span>&gt; &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1、用于拦截函数调用操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始可调用对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">thisArg</span> - 函数调用时的原始 this 上下文。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">argArray</span> - 传递给函数调用的参数数组。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">*</span>&#125; 函数调用的结果。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  apply?(<span class="attr">target</span>: T, <span class="attr">thisArg</span>: <span class="built_in">any</span>, <span class="attr">argArray</span>: <span class="built_in">any</span>[]): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2、用于拦截 `new` 操作符，即构造函数的调用。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">argArray</span> - 传递给构造函数的参数数组。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; <span class="variable">newTarget</span> - 最初调用的构造函数。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">object</span>&#125; 构造函数调用的结果。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  construct?(<span class="attr">target</span>: T, <span class="attr">argArray</span>: <span class="built_in">any</span>[], <span class="attr">newTarget</span>: <span class="title class_">Function</span>): <span class="built_in">object</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 3、用于拦截 `Object.defineProperty()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">property</span> - 要定义或修改的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyDescriptor</span>&#125; <span class="variable">attributes</span> - 属性的描述符。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功定义或修改。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  defineProperty?(<span class="attr">target</span>: T, <span class="attr">property</span>: <span class="built_in">string</span> | symbol, <span class="attr">attributes</span>: <span class="title class_">PropertyDescriptor</span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 4、用于拦截 `delete` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">p</span> - 要删除的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功删除。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  deleteProperty?(<span class="attr">target</span>: T, <span class="attr">p</span>: <span class="built_in">string</span> | symbol): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 5、用于拦截属性值的获取操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">p</span> - 要获取的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">receiver</span> - 代理或从代理继承的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">*</span>&#125; 属性的值。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  get?(<span class="attr">target</span>: T, <span class="attr">p</span>: <span class="built_in">string</span> | symbol, <span class="attr">receiver</span>: <span class="built_in">any</span>): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 6、用于拦截 `Object.getOwnPropertyDescriptor()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">p</span> - 要获取属性描述符的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">PropertyDescriptor | undefined</span>&#125; 属性的描述符或 `undefined`。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getOwnPropertyDescriptor?(<span class="attr">target</span>: T, <span class="attr">p</span>: <span class="built_in">string</span> | symbol): <span class="title class_">PropertyDescriptor</span> | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 7、用于拦截 `[[GetPrototypeOf]]` 内部方法。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">object | null</span>&#125; 对象的原型或 `null`。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  getPrototypeOf?(<span class="attr">target</span>: T): <span class="built_in">object</span> | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 8、用于拦截 `in` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">p</span> - 要检查存在性的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否存在。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  has?(<span class="attr">target</span>: T, <span class="attr">p</span>: <span class="built_in">string</span> | symbol): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 9、用于拦截 `Object.isExtensible()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示对象是否可扩展。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  isExtensible?(<span class="attr">target</span>: T): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 10、用于拦截 `Reflect.ownKeys()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">ArrayLike&lt;string | symbol&gt;</span>&#125; 一个可迭代对象，包含对象自身的所有属性键。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  ownKeys?(<span class="attr">target</span>: T): <span class="title class_">ArrayLike</span>&lt;<span class="built_in">string</span> | symbol&gt;;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 11、用于拦截 `Object.preventExtensions()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示对象是否成功变为不可扩展。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  preventExtensions?(<span class="attr">target</span>: T): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 12、用于拦截属性值的设置操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">string | symbol</span>&#125; <span class="variable">p</span> - 要设置的属性的名称或 `Symbol`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">newValue</span> - 要设置的新值。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">receiver</span> - 最初分配操作的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功设置。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  set?(<span class="attr">target</span>: T, <span class="attr">p</span>: <span class="built_in">string</span> | symbol, <span class="attr">newValue</span>: <span class="built_in">any</span>, <span class="attr">receiver</span>: <span class="built_in">any</span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 13、用于拦截 `Object.setPrototypeOf()` 操作。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">T</span>&#125; <span class="variable">target</span> - 被代理的原始对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object | null</span>&#125; <span class="variable">v</span> - 对象的新原型或 `null`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示是否成功设置对象的原型。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  setPrototypeOf?(<span class="attr">target</span>: T, <span class="attr">v</span>: <span class="built_in">object</span> | <span class="literal">null</span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>Reflect基本操作：</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">namespace</span> <span class="title class_">Reflect</span> &#123;</span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 1、调用具有指定对象作为 this 值和指定数组的元素作为参数的函数。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; <span class="variable">target</span> - 要调用的函数。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">*</span>&#125; <span class="variable">thisArgument</span> - 用作 this 对象的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">argumentsList</span> - 传递给函数的参数值的数组。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">*</span>&#125; 函数调用的结果。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> apply&lt;T, A <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[], R&gt;(</span><br><span class="line">      <span class="attr">target</span>: <span class="function">(<span class="params"><span class="variable language_">this</span>: T, ...args: A</span>) =&gt;</span> R,</span><br><span class="line">      <span class="attr">thisArgument</span>: T,</span><br><span class="line">      <span class="attr">argumentsList</span>: <span class="title class_">Readonly</span>&lt;A&gt;,</span><br><span class="line">  ): R;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">apply</span>(<span class="params">target: <span class="built_in">Function</span>, thisArgument: <span class="built_in">any</span>, argumentsList: ArrayLike&lt;<span class="built_in">any</span>&gt;</span>): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 2、使用指定数组的元素作为参数以及指定的构造函数作为 `new.target` 值构造目标。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; <span class="variable">target</span> - 要调用的构造函数。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Array</span>&#125; <span class="variable">argumentsList</span> - 传递给构造函数的参数值的数组。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">Function</span>&#125; <span class="variable">newTarget</span> - 用作 `new.target` 对象的构造函数。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">object</span>&#125; 构造函数调用的结果。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> construct&lt;A <span class="keyword">extends</span> <span class="keyword">readonly</span> <span class="built_in">any</span>[], R&gt;(</span><br><span class="line">      <span class="attr">target</span>: <span class="keyword">new</span> (...<span class="attr">args</span>: A) =&gt; R,</span><br><span class="line">      <span class="attr">argumentsList</span>: <span class="title class_">Readonly</span>&lt;A&gt;,</span><br><span class="line">      newTarget?: <span class="keyword">new</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>,</span><br><span class="line">  ): R;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">construct</span>(<span class="params">target: <span class="built_in">Function</span>, argumentsList: ArrayLike&lt;<span class="built_in">any</span>&gt;, newTarget?: <span class="built_in">Function</span></span>): <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 3、向对象添加属性或修改现有属性的属性。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 要添加或修改属性的对象。这可以是原生 JavaScript 对象</span></span><br><span class="line"><span class="comment">   *         （即用户定义的对象或内置对象）或 DOM 对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyDescriptor &amp; ThisType&lt;any&gt;</span>&#125; <span class="variable">attributes</span> - 属性的描述符。可以是数据属性或访问器属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功定义或修改。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">defineProperty</span>(<span class="params">target: <span class="built_in">object</span>, propertyKey: PropertyKey, attributes: PropertyDescriptor &amp; ThisType&lt;<span class="built_in">any</span>&gt;</span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 4、从对象中删除属性，相当于 `delete target[propertyKey]`，除非 `target[propertyKey]` 是不可配置的，否则不会抛出异常。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 从中删除自有属性的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功删除。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">deleteProperty</span>(<span class="params">target: <span class="built_in">object</span>, propertyKey: PropertyKey</span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 5、获取目标的属性，相当于 `target[propertyKey]` 当 `receiver === target` 时。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 包含属性的对象，可以是直接在对象上定义的属性，也可以是原型链中继承的属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">unknown</span>&#125; <span class="variable">receiver</span> - 作为 getter 函数中的 `this` 值使用的引用，</span></span><br><span class="line"><span class="comment">   *         如果 `target[propertyKey]` 是访问器属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">*</span>&#125; 属性的值。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> get&lt;T <span class="keyword">extends</span> <span class="built_in">object</span>, P <span class="keyword">extends</span> <span class="title class_">PropertyKey</span>&gt;(</span><br><span class="line">      <span class="attr">target</span>: T,</span><br><span class="line">      <span class="attr">propertyKey</span>: P,</span><br><span class="line">      receiver?: unknown,</span><br><span class="line">  ): P <span class="keyword">extends</span> keyof T ? T[P] : <span class="built_in">any</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 6、获取指定对象的自有属性描述符。</span></span><br><span class="line"><span class="comment">   * 自有属性描述符是直接在对象上定义的，而不是从对象的原型继承的描述符。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 包含属性的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">TypedPropertyDescriptor&lt;P extends keyof T ? T[P] : any&gt; | undefined</span>&#125;</span></span><br><span class="line"><span class="comment">   *         属性的描述符或 `undefined`。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> getOwnPropertyDescriptor&lt;T <span class="keyword">extends</span> <span class="built_in">object</span>, P <span class="keyword">extends</span> <span class="title class_">PropertyKey</span>&gt;(</span><br><span class="line">      <span class="attr">target</span>: T,</span><br><span class="line">      <span class="attr">propertyKey</span>: P,</span><br><span class="line">  ): <span class="title class_">TypedPropertyDescriptor</span>&lt;P <span class="keyword">extends</span> keyof T ? T[P] : <span class="built_in">any</span>&gt; | <span class="literal">undefined</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 7、返回对象的原型。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 引用原型的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">object | null</span>&#125; 对象的原型或 `null`。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">getPrototypeOf</span>(<span class="params">target: <span class="built_in">object</span></span>): <span class="built_in">object</span> | <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 8、等效于 `propertyKey in target`。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 包含属性的对象，可以是直接在对象上定义的属性，也可以是原型链中继承的属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否存在。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">has</span>(<span class="params">target: <span class="built_in">object</span>, propertyKey: PropertyKey</span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 9、返回一个值，指示是否可以向对象添加新属性。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 要测试的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示对象是否可扩展。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">isExtensible</span>(<span class="params">target: <span class="built_in">object</span></span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 10、返回对象的自有字符串和符号键。对象的自有属性是直接在该对象上定义的属性，</span></span><br><span class="line"><span class="comment">   * 不是从对象的原型继承的属性。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 包含自有属性的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">(string | symbol)[]</span>&#125; 包含对象自有的所有属性键的数组。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">ownKeys</span>(<span class="params">target: <span class="built_in">object</span></span>): (<span class="built_in">string</span> | symbol)[];</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 11、防止向对象添加新属性。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 要使其不可扩展的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示对象是否已成功变为不可扩展。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">preventExtensions</span>(<span class="params">target: <span class="built_in">object</span></span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 12、设置目标的属性，相当于 `target[propertyKey] = value` 当 `receiver === target` 时。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 包含属性的对象，可以是直接在对象上定义的属性，也可以是原型链中继承的属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">PropertyKey</span>&#125; <span class="variable">propertyKey</span> - 属性名称。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">value</span> - 要设置的新值。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">any</span>&#125; <span class="variable">receiver</span> - 作为 setter 函数中的 `this` 值使用的对象，</span></span><br><span class="line"><span class="comment">   *        如果 `target[propertyKey]` 是访问器属性。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示属性是否成功设置。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> set&lt;T <span class="keyword">extends</span> <span class="built_in">object</span>, P <span class="keyword">extends</span> <span class="title class_">PropertyKey</span>&gt;(</span><br><span class="line">      <span class="attr">target</span>: T,</span><br><span class="line">      <span class="attr">propertyKey</span>: P,</span><br><span class="line">      <span class="attr">value</span>: P <span class="keyword">extends</span> keyof T ? T[P] : <span class="built_in">any</span>,</span><br><span class="line">      receiver?: <span class="built_in">any</span>,</span><br><span class="line">  ): <span class="built_in">boolean</span>;</span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">set</span>(<span class="params">target: <span class="built_in">object</span>, propertyKey: PropertyKey, value: <span class="built_in">any</span>, receiver?: <span class="built_in">any</span></span>): <span class="built_in">boolean</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/**</span></span><br><span class="line"><span class="comment">   * 13、设置指定对象的原型为对象 proto 或 null。</span></span><br><span class="line"><span class="comment">   *</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object</span>&#125; <span class="variable">target</span> - 要更改其原型的对象。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@param</span> &#123;<span class="type">object | null</span>&#125; <span class="variable">proto</span> - 新原型的值，或 `null`。</span></span><br><span class="line"><span class="comment">   * <span class="doctag">@returns</span> &#123;<span class="type">boolean</span>&#125; 一个布尔值，指示是否成功设置对象的原型。</span></span><br><span class="line"><span class="comment">   */</span></span><br><span class="line">  <span class="keyword">function</span> <span class="title function_">setPrototypeOf</span>(<span class="params">target: <span class="built_in">object</span>, proto: <span class="built_in">object</span> | <span class="literal">null</span></span>): <span class="built_in">boolean</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="案例"><a href="#案例" class="headerlink" title="案例"></a>案例</h2><p><strong>判断成年的案例：</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> person = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;chuckle&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> personProxy = <span class="keyword">new</span> <span class="title class_">Proxy</span>(person, &#123;</span><br><span class="line">  <span class="title function_">get</span>(<span class="params">target, p, receiver</span>) &#123;</span><br><span class="line">    <span class="keyword">if</span> (target.<span class="property">age</span> &lt; <span class="number">18</span>) &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, p, receiver)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="string">&#x27;已成年&#x27;</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(personProxy.<span class="property">age</span>) <span class="comment">// 已成年</span></span><br><span class="line"><span class="title class_">Reflect</span>.<span class="title function_">set</span>(person, <span class="string">&#x27;age&#x27;</span>, <span class="number">16</span>)</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(personProxy.<span class="property">age</span>) <span class="comment">// 16</span></span><br></pre></td></tr></table></figure>
<p><strong>实现简单的响应式Demo：</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ref = &lt;T <span class="keyword">extends</span> <span class="built_in">object</span>&gt;(<span class="attr">params</span>: T): <span class="function"><span class="params">T</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Proxy</span>(params, &#123;</span><br><span class="line">    <span class="title function_">get</span>(target, key, receiver): <span class="built_in">any</span> &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver)</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="title function_">set</span>(target, key, value, receiver): <span class="built_in">boolean</span> &#123;</span><br><span class="line">      <span class="comment">// 获取原来的值</span></span><br><span class="line">      <span class="keyword">const</span> oldValue = <span class="title class_">Reflect</span>.<span class="title function_">get</span>(target, key, receiver);</span><br><span class="line">      <span class="comment">// 输出变化，或做一些响应式操作</span></span><br><span class="line">      <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">`set [<span class="subst">$&#123;<span class="built_in">String</span>(key)&#125;</span>] from &quot;<span class="subst">$&#123;oldValue&#125;</span>&quot; to &quot;<span class="subst">$&#123;value&#125;</span>&quot;`</span>);</span><br><span class="line">      <span class="comment">// 映射实际操作</span></span><br><span class="line">      <span class="keyword">const</span> result = <span class="title class_">Reflect</span>.<span class="title function_">set</span>(target, key, value, receiver);</span><br><span class="line">      <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> person = <span class="title function_">ref</span>(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;chuckle&#x27;</span>,</span><br><span class="line">  <span class="attr">age</span>: <span class="number">20</span>,</span><br><span class="line">&#125;);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(person); <span class="comment">// &#123; name: &#x27;chuckle&#x27;, age: 20 &#125;</span></span><br><span class="line">person.<span class="property">age</span> = <span class="number">16</span>; <span class="comment">// set [age] from &quot;20&quot; to &quot;16&quot;</span></span><br></pre></td></tr></table></figure>
<h1 id="类型兼容性"><a href="#类型兼容性" class="headerlink" title="类型兼容性"></a>类型兼容性</h1><h2 id="协变-鸭子类型"><a href="#协变-鸭子类型" class="headerlink" title="协变(鸭子类型)"></a>协变(鸭子类型)</h2><p><strong>协变:鸭子类型</strong>在程序设计中是动态类型的一种风格。<br>在这种风格中，一个物件有效的语义，不是由继承自特定的类或实现特定的接口决定，而是由<strong>当前方法和属性的集合</strong>决定</p>
<p>一只鸟走路像鸭子，游泳也像，做什么都像，那么这只鸟就可以成为鸭子类型。</p>
<p>当子类型中的属性满足父类型就可以进行赋值，即协变不能少可以多</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">say</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">bird</span>: <span class="title class_">Bird</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;鸟&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">duck</span>: <span class="title class_">Duck</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;鸭子&#x27;</span>,</span><br><span class="line">  <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">bird = duck</span><br></pre></td></tr></table></figure>
<p>Duck类型包含了Bird类型，且比Bird类型更具体，属性更多，从继承角度讲，Duck就是Bird的子类型，而子类型当然可以赋值给父类型，但会抛弃子类型中不属于父类型的多余属性</p>
<h2 id="逆变"><a href="#逆变" class="headerlink" title="逆变"></a>逆变</h2><p>逆变同样是子类型赋给父类型，多发生在函数参数上</p>
<p>接收子类型的函数变量不能赋给接收父类型的函数变量</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">say</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnBird</span> = (<span class="params">params: Bird</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnDuck</span> = (<span class="params">params: Duck</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">  params.<span class="title function_">say</span>();</span><br><span class="line">&#125;</span><br><span class="line">fnBird = fnDuck <span class="comment">// 错误</span></span><br><span class="line"><span class="comment">// 不能将类型“(params: Duck) =&gt; void”分配给类型“(params: Bird) =&gt; void”。</span></span><br><span class="line"><span class="comment">// 参数“params”和“params” 的类型不兼容。</span></span><br><span class="line"><span class="comment">// 类型 &quot;Bird&quot; 中缺少属性 &quot;say&quot;，但类型 &quot;Duck&quot; 中需要该属性。</span></span><br><span class="line">fnDuck = fnBird <span class="comment">// 允许</span></span><br></pre></td></tr></table></figure>
<p>函数变量发生赋值后，调用<code>fnBird()</code>，实际上仍然调用的是<code>(params: Duck)=&gt;&#123;&#125;</code>，若是传入<code>params: Bird</code>，其成员不足以覆盖<code>params: Duck</code>，<code>params.say()</code>会报错，所以是不安全的，仍然要符合<strong>不能少可以多</strong></p>
<h2 id="双向协变"><a href="#双向协变" class="headerlink" title="双向协变"></a>双向协变</h2><p>这是一种不安全的类型兼容操作，在TS2.0后需要关闭严格的函数类型检查，来允许函数参数双向协变</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;compilerOptions&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;strictFunctionTypes&quot;</span><span class="punctuation">:</span> <span class="keyword">false</span><span class="punctuation">,</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
<p>现在函数变量可以自由赋值</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="title function_">fnBird</span> = (<span class="params">params: Bird</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnDuck</span> = (<span class="params">params: Duck</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">  params.<span class="title function_">say</span>();</span><br><span class="line">&#125;</span><br><span class="line">fnBird = fnDuck <span class="comment">// 允许</span></span><br><span class="line">fnDuck = fnBird <span class="comment">// 允许</span></span><br></pre></td></tr></table></figure>
<p>因为保存函数的仅仅是一个变量，赋值后到另一个函数变量后调用，再调用的仍然同一个函数，看起来没问题，但若是在赋值后再调用原本的变量调用函数，就会存在问题</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Bird</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">Duck</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span>;</span><br><span class="line">  <span class="title function_">say</span>(): <span class="built_in">void</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">bird</span>: <span class="title class_">Bird</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;鸟&#x27;</span>,</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="attr">duck</span>: <span class="title class_">Duck</span> = &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;鸭子&#x27;</span>,</span><br><span class="line">  <span class="title function_">say</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="variable language_">this</span>.<span class="property">name</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnBird</span> = (<span class="params">params: Bird</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> <span class="title function_">fnDuck</span> = (<span class="params">params: Duck</span>) =&gt; &#123;</span><br><span class="line">  <span class="variable language_">console</span>.<span class="title function_">log</span>(params.<span class="property">name</span>);</span><br><span class="line">  params.<span class="title function_">say</span>();</span><br><span class="line">&#125;</span><br><span class="line">fnBird = fnDuck</span><br><span class="line"><span class="title function_">fnBird</span>(bird) <span class="comment">// 运行时报错：params.say is not a function</span></span><br><span class="line"><span class="title function_">fnDuck</span>(duck)</span><br></pre></td></tr></table></figure>
<p>fnBird在经过赋值后，实际的函数是fnDuck，需要的是Duck类型参数，但仍然传入的是Bird类型参数，父类型赋给子类型当然会出错</p>
<p>所以，<strong>不要使用双向协变</strong>，这可能导致运行时的意外错误</p>
<h1 id="Set-Map"><a href="#Set-Map" class="headerlink" title="Set,Map"></a>Set,Map</h1><p>set和map是ES6新增的引用数据类型，详见：<a href="/article/383b041f.html#Map对象">ES6查缺补漏</a></p>
<p>Set类似于数组，但自动去重</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>: <span class="built_in">number</span>[] = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">1</span>];</span><br><span class="line"><span class="keyword">const</span> <span class="attr">set</span>: <span class="title class_">Set</span>&lt;<span class="built_in">number</span>&gt; = <span class="keyword">new</span> <span class="title class_">Set</span>(arr);</span><br><span class="line">set.<span class="title function_">add</span>(<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set); <span class="comment">// Set(4) &#123; 1, 2, 3, 4 &#125; 自动去重</span></span><br><span class="line">set.<span class="title function_">delete</span>(<span class="number">4</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set); <span class="comment">// Set(3) &#123; 1, 2, 3 &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(set.<span class="title function_">has</span>(<span class="number">4</span>)); <span class="comment">// false</span></span><br></pre></td></tr></table></figure>
<p>Map类似对象，但键可以是任意类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> <span class="attr">arr</span>: [<span class="built_in">any</span>, <span class="built_in">any</span>][] = [</span><br><span class="line">  [<span class="string">&#x27;x&#x27;</span>, <span class="number">1</span>],</span><br><span class="line">  [<span class="string">&#x27;y&#x27;</span>, <span class="number">2</span>],</span><br><span class="line">]</span><br><span class="line"><span class="keyword">const</span> <span class="attr">map</span>: <span class="title class_">Map</span>&lt;<span class="built_in">any</span>, <span class="built_in">any</span>&gt; = <span class="keyword">new</span> <span class="title class_">Map</span>(arr);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map); <span class="comment">// Map(2) &#123; &#x27;x&#x27; =&gt; 1, &#x27;y&#x27; =&gt; 2 &#125;</span></span><br><span class="line">map.<span class="title function_">set</span>(<span class="string">&#x27;z&#x27;</span>, <span class="number">3</span>);</span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">get</span>(<span class="string">&#x27;z&#x27;</span>)); <span class="comment">// 3</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">keys</span>()); <span class="comment">// [Map Iterator] &#123; &#x27;x&#x27;, &#x27;y&#x27;, &#x27;z&#x27; &#125;</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">values</span>()); <span class="comment">// [Map Iterator] &#123; 1, 2, 3 &#125;</span></span><br></pre></td></tr></table></figure>
<h2 id="weakSet-weakMap"><a href="#weakSet-weakMap" class="headerlink" title="weakSet,weakMap"></a>weakSet,weakMap</h2><p>Weak在英语的意思是<strong>弱</strong>，表示<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakSet">weakSet</a>的值、<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/WeakMap">weakMap</a>的键必须是引用类型，且引用是弱引用，不计入垃圾回收策略，如果没有其他的对Weak中对象的引用存在，那么这些对象会被垃圾回收</p>
<p><strong>垃圾回收：</strong>JavaScript引擎在值“可达”和可能被使用时会将其保持在内存中，否则会自动进行垃圾回收</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> john = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line"><span class="comment">// 该对象能被访问，john 是它的引用</span></span><br><span class="line"><span class="comment">// 覆盖引用</span></span><br><span class="line">john = <span class="literal">null</span>;</span><br><span class="line"><span class="comment">// 该对象将会被从内存中清除</span></span><br></pre></td></tr></table></figure>
<p>通常，当对象、数组之类的数据结构在内存中时，它们的子元素，如对象的属性、数组的元素都被认为是可达的。</p>
<p>例如，如果把一个对象放入到Map中作为键，那么只要这个Map存在，那么这个对象也就存在，即使没有其他对该对象的引用。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> <span class="title class_">Map</span>();</span><br><span class="line">map.<span class="title function_">set</span>(john, <span class="string">&quot;...&quot;</span>);</span><br><span class="line">john = <span class="literal">null</span>; <span class="comment">// 覆盖引用</span></span><br><span class="line"><span class="comment">// john 被存储在了 map 中，</span></span><br><span class="line"><span class="comment">// 我们可以使用 map.keys() 来获取它</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(map.<span class="title function_">keys</span>()) <span class="comment">// [Map Iterator] &#123; &#123; name: &#x27;John&#x27; &#125; &#125;</span></span><br></pre></td></tr></table></figure>
<p>WeakMap在这方面有着根本上的不同。它不会阻止垃圾回收机制对作为键的对象（key object）的回收</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> <span class="attr">john</span>: <span class="built_in">any</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line"><span class="keyword">let</span> weakMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>();</span><br><span class="line">weakMap.<span class="title function_">set</span>(john, <span class="string">&quot;...&quot;</span>);</span><br><span class="line">john = <span class="literal">null</span>; <span class="comment">// 覆盖引用</span></span><br><span class="line"><span class="comment">// john 被从内存中删除了！没有任何办法获取原来的对象</span></span><br><span class="line"><span class="comment">// weakMap没有keys()方法</span></span><br><span class="line"><span class="comment">// WeakMap 只有以下的方法：</span></span><br><span class="line"><span class="comment">// 1. weakMap.get(key)</span></span><br><span class="line"><span class="comment">// 2. weakMap.set(key, value)</span></span><br><span class="line"><span class="comment">// 3. weakMap.delete(key)</span></span><br><span class="line"><span class="comment">// 4. weakMap.has(key)</span></span><br></pre></td></tr></table></figure>
<p>WeakMap和WeakSet在第三方库处理外部数据、或用作缓存时非常有用，可以防止垃圾数据堆积在内存中</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> visitsCountMap = <span class="keyword">new</span> <span class="title class_">WeakMap</span>(); <span class="comment">// weakmap: user =&gt; visits count</span></span><br><span class="line"><span class="comment">// 递增用户来访次数</span></span><br><span class="line"><span class="keyword">function</span> <span class="title function_">countUser</span>(<span class="params">user: <span class="built_in">object</span></span>) &#123;</span><br><span class="line">  <span class="keyword">let</span> count = visitsCountMap.<span class="title function_">get</span>(user) || <span class="number">0</span>;</span><br><span class="line">  visitsCountMap.<span class="title function_">set</span>(user, count + <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> <span class="attr">john</span>: <span class="built_in">any</span> = &#123; <span class="attr">name</span>: <span class="string">&quot;John&quot;</span> &#125;;</span><br><span class="line"><span class="title function_">countUser</span>(john); <span class="comment">// count his visits</span></span><br><span class="line"><span class="comment">// john 离开了，WeakMap自动释放该键值对</span></span><br><span class="line">john = <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>
<h1 id="内置高级类型"><a href="#内置高级类型" class="headerlink" title="内置高级类型"></a>内置高级类型</h1><p>TS内置了许多高级类型（常用的工具类型），可以看作是类型的函数，接收一个类型，返回加工后的类型</p>
<p>例如：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 T 中的所有属性变为可选的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 T 中的所有属性变为必需的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Required</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]-?: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将 T 中的所有属性变为只读的</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从 T 中挑选出键在联合类型 K 中的一组属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 构造一个具有一组属性 K，属性类型为 T 的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 从 T 中排除那些可分配给 U 的类型</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Exclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 去掉某些属性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure>
<h2 id="Partial"><a href="#Partial" class="headerlink" title="Partial"></a>Partial</h2><p><code>Partial&lt;T&gt;</code>可以将原来的类型变为<strong>可选</strong>的</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> p1 = <span class="title class_">Partial</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// type p1 = &#123;</span></span><br><span class="line"><span class="comment">//   name?: string | undefined;</span></span><br><span class="line"><span class="comment">//   age?: number | undefined;</span></span><br><span class="line"><span class="comment">//   gender?: &quot;male&quot; | &quot;female&quot; | undefined;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>keyof</strong>获取一个对象类型的所有键，作为联合类型，<strong>in</strong>是映射类型语法，用于遍历<strong>keyof T</strong>让联合类型的每一项作为属性，<strong>?</strong> 将每一个属性变成可选项，<strong>T[P]</strong>索引访问操作符，与访问属性值的操作类似</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Partial</span>&lt;T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> keyof T]?: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Pick"><a href="#Pick" class="headerlink" title="Pick"></a>Pick</h2><p><strong>筛选类型的属性</strong>。从类型的属性中，选取指定一组属性，返回一个新的类型定义。</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> p2 = <span class="title class_">Pick</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;name&#x27;</span> | <span class="string">&#x27;age&#x27;</span>&gt;</span><br><span class="line"><span class="comment">// type p2 = &#123;</span></span><br><span class="line"><span class="comment">//   name: string;</span></span><br><span class="line"><span class="comment">//   age: number;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><strong>K extends keyof T</strong>限制key必须是传入类型的属性，<strong>in</strong>遍历<strong>K</strong>让联合类型的每一项作为属性，<strong>T[P]</strong>索引访问操作符</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Pick</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T[P];</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<h2 id="Readonly"><a href="#Readonly" class="headerlink" title="Readonly"></a>Readonly</h2><p>将类型中所有属性变为<strong>只读</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> p3 = <span class="title class_">Readonly</span>&lt;<span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// type p3 = &#123;</span></span><br><span class="line"><span class="comment">//   readonly name: string;</span></span><br><span class="line"><span class="comment">//   readonly age: number;</span></span><br><span class="line"><span class="comment">//   readonly gender: &#x27;male&#x27; | &#x27;female&#x27;;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p>源码上和Partial很像，只是把 <strong>?</strong> 换为了<strong>readonly</strong></p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Readonly</span>&lt;T&gt; = &#123;</span><br><span class="line">  <span class="keyword">readonly</span> [P <span class="keyword">in</span> keyof T]: T[P];</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// type Partial&lt;T&gt; = &#123;</span></span><br><span class="line"><span class="comment">//   [P in keyof T]?: T[P];</span></span><br><span class="line"><span class="comment">// &#125;;</span></span><br></pre></td></tr></table></figure>
<h2 id="Record"><a href="#Record" class="headerlink" title="Record"></a>Record</h2><p>构造一个具有一组属性 K，属性类型为 T 的类型，做到同时对 key 和 value 进行类型定义</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> persons = <span class="title class_">Record</span>&lt;<span class="built_in">string</span>, <span class="title class_">Person</span>&gt;</span><br><span class="line"><span class="comment">// type persons = &#123;</span></span><br><span class="line"><span class="comment">//   [x: string]: Person;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<p><code>keyof any</code>: any 可以代表任何类型。那么任何类型的 key 都可能为 string 、 number 或者 symbol 。所以自然 keyof any 为 string | number | symbol 的联合类型。<br><code>K extends keyof any</code>: 类型约束，表示类型参数 K 必须是类型 string | number | symbol 的子集或相同类型。<br><code>[P in K]</code> 表示对类型 K 中的每个属性键 P 进行映射（遍历）。其中 K 是一个联合类型或是一个具有多个属性的类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Record</span>&lt;K <span class="keyword">extends</span> keyof <span class="built_in">any</span>, T&gt; = &#123;</span><br><span class="line">  [P <span class="keyword">in</span> K]: T;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">type</span> keys = keyof <span class="built_in">any</span></span><br><span class="line"><span class="comment">// type keys = string | number | symbol</span></span><br></pre></td></tr></table></figure>
<h2 id="Omit"><a href="#Omit" class="headerlink" title="Omit"></a>Omit</h2><p>去掉某些属性</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> p4 = <span class="title class_">Omit</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;gender&#x27;</span>&gt;</span><br><span class="line"><span class="comment">// type p4 = &#123;</span></span><br><span class="line"><span class="comment">//   name: string;</span></span><br><span class="line"><span class="comment">//   age: number;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 从 T 中排除那些可分配给 U 的类型 </span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Exclude</span>&lt;T, U&gt; = T <span class="keyword">extends</span> U ? <span class="built_in">never</span> : T;</span><br><span class="line"><span class="comment">// 去掉某些属性</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Omit</span>&lt;T, K <span class="keyword">extends</span> keyof <span class="built_in">any</span>&gt; = <span class="title class_">Pick</span>&lt;T, <span class="title class_">Exclude</span>&lt;keyof T, K&gt;&gt;;</span><br></pre></td></tr></table></figure>
<h2 id="ReturnType"><a href="#ReturnType" class="headerlink" title="ReturnType"></a>ReturnType</h2><p><code>ReturnType&lt;T&gt;</code> 获取函数返回值的类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">ReturnType</span>&lt;T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; <span class="built_in">any</span>&gt; = T <span class="keyword">extends</span> (...<span class="attr">args</span>: <span class="built_in">any</span>) =&gt; infer R ? R : <span class="built_in">any</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="title function_">fn</span> = (<span class="params"></span>) =&gt; <span class="string">&#x27;hello&#x27;</span></span><br><span class="line"><span class="keyword">type</span> T = <span class="title class_">ReturnType</span>&lt;<span class="keyword">typeof</span> fn&gt;;  <span class="comment">// string</span></span><br></pre></td></tr></table></figure>
<h1 id="类型工具"><a href="#类型工具" class="headerlink" title="类型工具"></a>类型工具</h1><p>内置高级类型就是类型工具，但还有一些常用的类型工具并没有内置，需要自己实现</p>
<p>1、将部分属性变为可选</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">Person</span> &#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="built_in">string</span></span><br><span class="line">  <span class="attr">age</span>: <span class="built_in">number</span>,</span><br><span class="line">  <span class="attr">gender</span>: <span class="string">&#x27;male&#x27;</span> | <span class="string">&#x27;female&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Optional</span>&lt;T, K <span class="keyword">extends</span> keyof T&gt; = <span class="title class_">Omit</span>&lt;T, K&gt; &amp; <span class="title class_">Partial</span>&lt;<span class="title class_">Pick</span>&lt;T, K&gt;&gt;</span><br><span class="line"><span class="keyword">type</span> newPerson = <span class="title class_">Optional</span>&lt;<span class="title class_">Person</span>, <span class="string">&#x27;gender&#x27;</span>&gt;</span><br><span class="line"><span class="comment">// type newPerson = &#123;</span></span><br><span class="line"><span class="comment">//   name: string</span></span><br><span class="line"><span class="comment">//   age: number,</span></span><br><span class="line"><span class="comment">//   gender?: &#x27;male&#x27; | &#x27;female&#x27;</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br></pre></td></tr></table></figure>
<h1 id="占位符infer"><a href="#占位符infer" class="headerlink" title="占位符infer"></a>占位符infer</h1><p><strong>infer</strong>关键字定义一个占位符，可以自动推断类型，简化代码</p>
<p>案例：传入一个类型，若是数组类型，则返回数组元素的类型组成的联合类型，否则原样返回</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">TypeDeconstruct</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="title class_">Array</span>&lt;<span class="built_in">any</span>&gt; ? T[<span class="built_in">number</span>] : T</span><br><span class="line"><span class="comment">// 在 TypeScript 中，对于任何具有数字索引签名的对象（比如数组），使用 [number] 可以获取其元素类型。</span></span><br><span class="line"><span class="comment">// 这是 TypeScript 的索引访问类型的一部分，用于表示通过索引访问数组、元组或对象属性的类型。</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">type</span> A = <span class="title class_">TypeDeconstruct</span>&lt;<span class="keyword">typeof</span> arr&gt; <span class="comment">// type A = string | number</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="title class_">TypeDeconstruct</span>&lt;<span class="built_in">boolean</span>&gt; <span class="comment">// type B = boolean</span></span><br></pre></td></tr></table></figure>
<p>使用<strong>infer</strong>自动推断数组中元素的类型</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">TypeDeconstruct</span>&lt;T&gt; = T <span class="keyword">extends</span> <span class="title class_">Array</span>&lt;infer U&gt; ? U : T</span><br><span class="line"><span class="comment">// 使用infer定义的占位符U，自动推断数组中元素的类型作为联合类型</span></span><br><span class="line"><span class="keyword">const</span> arr = [<span class="number">1</span>, <span class="string">&#x27;a&#x27;</span>, <span class="number">2</span>, <span class="string">&#x27;b&#x27;</span>];</span><br><span class="line"><span class="keyword">type</span> A = <span class="title class_">TypeDeconstruct</span>&lt;<span class="keyword">typeof</span> arr&gt; <span class="comment">// type A = string | number</span></span><br><span class="line"><span class="keyword">type</span> B = <span class="title class_">TypeDeconstruct</span>&lt;<span class="built_in">boolean</span>&gt; <span class="comment">// type B = boolean</span></span><br></pre></td></tr></table></figure>
<h2 id="提取-删除元素"><a href="#提取-删除元素" class="headerlink" title="提取/删除元素"></a>提取/删除元素</h2><p>1、提取头部元素</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">First</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; =  T <span class="keyword">extends</span> [infer <span class="title class_">First</span>,...<span class="built_in">any</span>[]] ? <span class="title class_">First</span> : []</span><br><span class="line"><span class="keyword">type</span> a = <span class="title class_">First</span>&lt;<span class="title class_">Arr</span>&gt; <span class="comment">// type a = &quot;a&quot;</span></span><br></pre></td></tr></table></figure>
<p>2、提取尾部元素</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Last</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [...<span class="built_in">any</span>[], infer <span class="title class_">Last</span>,] ? <span class="title class_">Last</span> : []</span><br><span class="line"><span class="keyword">type</span> a = <span class="title class_">Last</span>&lt;<span class="title class_">Arr</span>&gt; <span class="comment">// type a = &quot;c&quot;</span></span><br></pre></td></tr></table></figure>
<p>3、剔除第一个元素 Shift</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Shift</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; =  T <span class="keyword">extends</span> [unknown,...infer <span class="title class_">Rest</span>] ? <span class="title class_">Rest</span> : []</span><br><span class="line"><span class="keyword">type</span> a = <span class="title class_">Shift</span>&lt;<span class="title class_">Arr</span>&gt; <span class="comment">// type a = [&quot;b&quot;, &quot;c&quot;]</span></span><br></pre></td></tr></table></figure>
<p>4、剔除尾部元素 Pop</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Pop</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; =  T <span class="keyword">extends</span> [...infer <span class="title class_">Rest</span>,unknown] ? <span class="title class_">Rest</span> : []</span><br><span class="line"><span class="keyword">type</span> a = <span class="title class_">Pop</span>&lt;<span class="title class_">Arr</span>&gt; <span class="comment">// type a = [&quot;a&quot;, &quot;b&quot;]</span></span><br></pre></td></tr></table></figure>
<h2 id="递归"><a href="#递归" class="headerlink" title="递归"></a>递归</h2><p>通过递归将类型数组逆序：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>,<span class="string">&#x27;b&#x27;</span>,<span class="string">&#x27;c&#x27;</span>]</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">ReveArr</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [infer <span class="title class_">First</span>, ...infer rest] ? [...<span class="title class_">ReveArr</span>&lt;rest&gt;, <span class="title class_">First</span>] : T</span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Res</span> = <span class="title class_">ReveArr</span>&lt;<span class="title class_">Arr</span>&gt; <span class="comment">// type Res = [&quot;c&quot;, &quot;b&quot;, &quot;a&quot;]</span></span><br></pre></td></tr></table></figure>
<p>提取指定位置上的元素：</p>
<figure class="highlight ts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">type</span> <span class="title class_">Arr</span> = [<span class="string">&#x27;a&#x27;</span>, <span class="string">&#x27;b&#x27;</span>, <span class="string">&#x27;c&#x27;</span>];</span><br><span class="line"><span class="comment">// 简单写法，不用递归</span></span><br><span class="line"><span class="comment">// type Index&lt;T extends any[], K extends number&gt; = T[K];</span></span><br><span class="line"><span class="comment">// type aa = Index&lt;Arr, 1&gt;; // type aa = &quot;b&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 递归写法</span></span><br><span class="line"><span class="comment">// 获取类型数组指定位置上的元素，索引从1开始</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">IndexOf</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[], K <span class="keyword">extends</span> <span class="built_in">number</span>, <span class="title class_">Acc</span> <span class="keyword">extends</span> <span class="built_in">any</span>[] = []&gt; = &#123;</span><br><span class="line">  <span class="comment">// 如果 K 等于 0，说明已经达到了目标索引位置，返回 Acc 中的第一个元素</span></span><br><span class="line">  <span class="number">0</span>: <span class="title class_">Acc</span>[<span class="number">0</span>];</span><br><span class="line">  <span class="comment">// 否则，继续递归，Acc 中添加数组的第一个元素，同时 K 减 1</span></span><br><span class="line">  <span class="number">1</span>: K <span class="keyword">extends</span> <span class="number">0</span> ? <span class="title class_">Acc</span>[<span class="number">0</span>] : <span class="title class_">IndexOf</span>&lt;<span class="title class_">Tail</span>&lt;T&gt;, K, [<span class="title class_">Head</span>&lt;T&gt;, ...<span class="title class_">Acc</span>]&gt;;</span><br><span class="line">&#125;[K <span class="keyword">extends</span> <span class="title class_">Acc</span>[<span class="string">&#x27;length&#x27;</span>] ? <span class="number">0</span> : <span class="number">1</span>];</span><br><span class="line"><span class="comment">// 辅助类型：获取数组的第一个元素</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Head</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [infer H, ...<span class="built_in">any</span>[]] ? H : <span class="built_in">never</span>;</span><br><span class="line"><span class="comment">// 辅助类型：获取数组的剩余部分</span></span><br><span class="line"><span class="keyword">type</span> <span class="title class_">Tail</span>&lt;T <span class="keyword">extends</span> <span class="built_in">any</span>[]&gt; = T <span class="keyword">extends</span> [infer _H, ...infer R] ? R : [];</span><br><span class="line"></span><br><span class="line"><span class="keyword">type</span> a = <span class="title class_">IndexOf</span>&lt;<span class="title class_">Arr</span>, <span class="number">1</span>&gt;; <span class="comment">// type a = &quot;a&quot;</span></span><br><span class="line"><span class="keyword">type</span> b = <span class="title class_">IndexOf</span>&lt;<span class="title class_">Arr</span>, <span class="number">2</span>&gt;; <span class="comment">// type b = &quot;b&quot;</span></span><br><span class="line"><span class="keyword">type</span> c = <span class="title class_">IndexOf</span>&lt;<span class="title class_">Arr</span>, <span class="number">3</span>&gt;; <span class="comment">// type b = &quot;c&quot;</span></span><br></pre></td></tr></table></figure>
</article><div class="post-copyright"><div class="post-copyright__title"><span class="post-copyright-info"><h>TypeScript笔记</h></span></div><div class="post-copyright__type"><span class="post-copyright-info"><a href="https://www.qcqx.cn/article/9d362be7.html">https://www.qcqx.cn/article/9d362be7.html</a></span></div><div class="post-copyright-m"><div class="post-copyright-m-info"><div class="post-copyright-a"><h>作者</h><div class="post-copyright-cc-info"><h>轻笑Chuckle</h></div></div><div class="post-copyright-c"><h>发布于</h><div class="post-copyright-cc-info"><h>2023-05-17</h></div></div><div class="post-copyright-u"><h>更新于</h><div class="post-copyright-cc-info"><h>2023-11-27</h></div></div><div class="post-copyright-c"><h>许可协议</h><div class="post-copyright-cc-info"><a class="icon" rel="noopener" target="_blank" title="Creative Commons" href="https://creativecommons.org/"><i class="fab fa-creative-commons"></i></a><a rel="noopener" target="_blank" title="CC BY-NC-SA 4.0" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a></div></div></div></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E5%89%8D%E7%AB%AF/">前端</a><a class="post-meta__tags" href="/tags/TypeScript/">TypeScript</a></div><div class="post_share"></div></div><div class="post-reward"><button class="tip-button reward-button"><span class="tip-button__text">投 喂</span><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/blog/pay/weixin.webp" alt="微信" loading="lazy"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a><img class="post-qr-code-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/blog/pay/alipay.webp" alt="支付宝" loading="lazy"/></a><div class="post-qr-code-desc">支付宝</div></li><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">一个博客 一叶孤舟 一方世界</div></a></ul></div></button></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/article/31e8cb77.html"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/60-1.webp" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">⇦上一篇</div><div class="prev_info">Vite、Pinia、Router</div></div></a></div><div class="next-post pull-right"><a href="/article/63b3ee69.html"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/58-1.webp" onerror="onerror=null;src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇⇨</div><div class="next_info">Vue笔记[六]-Vue3</div></div></a></div></nav><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="fas fa-comments fa-fw"></i><span> 评论</span></div></div><div class="comment-wrap"><div><div id="waline-wrap"></div></div></div></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp" data-no-lazy="data-no-lazy" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.gif'" alt="avatar"/></div><div class="author-info__name">『轻笑Chuckle』</div><div class="author-info__description">漫天倾尘 风中轻笑</div></div><div class="card-info-data is-center"><div class="card-info-data-item"><a href="/archives/"><div class="headline">文章</div><div class="length-num">88</div></a></div><div class="card-info-data-item"><a href="/tags/"><div class="headline">标签</div><div class="length-num">32</div></a></div><div class="card-info-data-item"><a href="/categories/"><div class="headline">分类</div><div class="length-num">6</div></a></div></div><a id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/qxchuckle"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://blog.csdn.net/qxchuckle" target="_blank" title="CSDN"><i class="iconfont icon-csdn"></i></a><a class="social-icon" href="https://gitee.com/qxchuckle" target="_blank" title="Gitee"><i class="iconfont icon-gitee"></i></a><a class="social-icon" href="https://space.bilibili.com/353049313" target="_blank" title="bilibili"><i class="iconfont icon-bilibili"></i></a><a class="social-icon" href="https://music.163.com/#/user/home?id=1395730595" target="_blank" title="网易云"><i class="iconfont icon-wangyiyunyinle"></i></a><a class="social-icon" href="http://www.coolapk.com/u/4137393" target="_blank" title="酷安"><i class="iconfont icon-kuan"></i></a></div></div><a class="card-widget" id="card-tuijian" href="https://afdian.net/a/chuckle" target="_blank" style="display:block"><div id="tj-box"><div id="tj-box1"><div id="tj-left"><p>扫一扫</p>
<span>快速打开移动端➤</span></div><div id="tj-right"><div id="tj-img-box"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACFElEQVR42u3aURLCIAwFQO9/aT2B9ZEARd1+dZxqWZwp9CWP508fDzw8PDw8PDw8PDw8PDw8PDw8PLw/5j3i4/r6d78ZDW5wDHh4eHgn8JLbv/vkw40DfG0MeHh4eCfwrheD5Fv5XfpjwMPDw/sW3vWDPtlqJ+d4eHh4/8BLNs3vhoiHh4f3vbzOFCRBQ7Jg3Jy14OHh4S0rgK04P6i+h4eHh/ec2XSVNwqMRr2tUeHh4eFt5PUDgloBbHQZmPzGgIeHh7fsbf36+nyjXCueLX9jwMPDw2u8reet/LVBz5pWPDw8vDN5yRJS+1YeDQ+3w+Lh4eFt5CUhQr4V7oe/xanHw8PD28hLBpFvwTuLQW2rjYeHh3cvL3/0502rtfbWaY3+eHh4eFt4tQB3brgwuvnGw8PD28+rxQ15DJEvCUvCCDw8PLwFMe4oZrSINTqJkwtgeHh4eAtaB0aD2uRRXoszknM8PDy803ijRf3RjXU+TcuzFjw8PLypW+paW0Dn+tYU4OHh4W3kzdpq1yYlD23x8PDwzuF1HvSdglneroqHh4d3Jm+0saBDumFhwMPDw1vGq7UFXD++j8ha8PDw8G7lJQX+WkNAUgbDw8PD+15eJ5iotRrg4eHhncmrhRH9FoTrKcPDw8M7kzerADa6/OTLzIc/AA8PD28j7zcOPDw8PDw8PDw8PDw8PDw8PDw8vD/gvQCTvMcy70g22AAAAABJRU5ErkJggg=="/></div></div></div><div id="tj-box2"><div id="tj-left"><p>爱发电</p>
<span>扫码或<span class="tj-light">点击跳转</span>➤</span></div><div id="tj-right"><div id="tj-img-box"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACEElEQVR42u3bQXKDMAwFUO5/6fYAmbRfEhiTPK8YhiR+XtiKJI6fjx4HHh4eHh4eHh4eHh4eHh4eHh4e3hfzjnj88wMvz7x+9t33zOeAh4eHt56XT/31OrmTX/fmiYeHh3cX791GnPCSY+DdFl+dAx4eHt4TeclWXiXh4eHhfSqvGgRXkxR4eHh4z+JNUrTl9MGeuRY8PDy8Cwpg111vUd/Dw8PDC3jVkS9BHlKfMCs8PDy8hbxe60C+cfeSwuWWLzw8PLybeHm6tpfwrR4YeHh4eDvz8ibUKiAJu+ehNh4eHt5KXh7CzstU+fPl78HDw8NbzpuAJ4mG/Eg4uQCGh4eHN+ZNylr5ElxXMMPDw8O7i5ds7tV2qPwI6ZW+8PDw8NbzquWrfMvu3U+WAA8PD28fXu+oOOtIqIbReHh4ePvwJlPptZ/2khR4eHh49/KqbVVRmNsqjCWLjoeHh7cDL5/iJNQ+N3WLh4eHtxuvWhLLExB/H0iX/2PAw8PDG/PKW3ALk0+3dzzg4eHhreQd8chD7XlJ7OQCGB4eHt5l/ZyThMVZjftLcy14eHh4Y97fSYFeeF09fi4JqfHw8PA24FVfmuotXOEVLDw8PLxH8arg5Ek8PDy8p/DmRa9ei391UfDw8PB24OVbc34/b+fqvUiAh4eHdxfvMwYeHh4eHh4eHh4eHh4eHh4eHh7eF/B+Acr1Qv2GlsE8AAAAAElFTkSuQmCC"/></div></div></div></div></a><div class="card-widget card-announcement"><div class="item-headline"><i class="iconfont icon-gonggao"></i><span>公告</span></div><div class="announcement_content">欢迎来到『轻笑Chuckle』的小站<br>(￣▽￣)～■干杯□～(￣▽￣)<br>如果有什么加载不出来或者其它滴小bug,「刷新网页/Ctrl+F5」应该、也许能解决</div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%88%9D%E8%AF%86"><span class="toc-number">1.</span> <span class="toc-text">初识</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="toc-number">2.</span> <span class="toc-text">配置文件</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#TS%E6%A3%80%E6%9F%A5%E7%9B%B8%E5%85%B3%E6%B3%A8%E9%87%8A"><span class="toc-number">3.</span> <span class="toc-text">TS检查相关注释</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%A0%87%E6%B3%A8"><span class="toc-number">4.</span> <span class="toc-text">类型标注</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.1.</span> <span class="toc-text">基本类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%A9%BA%E5%80%BCvoid"><span class="toc-number">4.2.</span> <span class="toc-text">空值void</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#any%E5%92%8Cunknown"><span class="toc-number">4.3.</span> <span class="toc-text">any和unknown</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Object%E3%80%81object%E5%92%8C"><span class="toc-number">4.4.</span> <span class="toc-text">Object、object和{}</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A5%E5%8F%A3%E5%92%8C%E5%AF%B9%E8%B1%A1%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.5.</span> <span class="toc-text">接口和对象类型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E7%BB%84%E7%B1%BB%E5%9E%8B"><span class="toc-number">4.6.</span> <span class="toc-text">数组类型</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%83%E7%BB%84"><span class="toc-number">4.6.1.</span> <span class="toc-text">元组</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%BD%E6%95%B0%E7%B1%BB%E5%9E%8B%E4%B8%8E%E5%AE%9A%E4%B9%89"><span class="toc-number">4.7.</span> <span class="toc-text">函数类型与定义</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%AF%E9%80%89%E7%AC%A6"><span class="toc-number">5.</span> <span class="toc-text">?可选符</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%81%94%E5%90%88%E7%B1%BB%E5%9E%8B"><span class="toc-number">6.</span> <span class="toc-text">联合类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BA%A4%E5%8F%89%E7%B1%BB%E5%9E%8B"><span class="toc-number">7.</span> <span class="toc-text">交叉类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%96%AD%E8%A8%80"><span class="toc-number">8.</span> <span class="toc-text">类型断言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%AF%B9%E8%B1%A1"><span class="toc-number">9.</span> <span class="toc-text">内置对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%A3%E7%A0%81%E9%9B%A8"><span class="toc-number">9.1.</span> <span class="toc-text">代码雨</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Class"><span class="toc-number">10.</span> <span class="toc-text">Class</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%A7%E6%89%BF"><span class="toc-number">10.1.</span> <span class="toc-text">继承</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BF%E9%97%AE%E4%BF%AE%E9%A5%B0%E7%AC%A6"><span class="toc-number">10.2.</span> <span class="toc-text">访问修饰符</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="toc-number">10.3.</span> <span class="toc-text">抽象类</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%9E%9A%E4%B8%BE%E7%B1%BB%E5%9E%8B"><span class="toc-number">11.</span> <span class="toc-text">枚举类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E6%8E%A8%E8%AE%BA"><span class="toc-number">12.</span> <span class="toc-text">类型推论</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%88%AB%E5%90%8D"><span class="toc-number">13.</span> <span class="toc-text">类型别名</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#never%E7%B1%BB%E5%9E%8B"><span class="toc-number">14.</span> <span class="toc-text">never类型</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B"><span class="toc-number">15.</span> <span class="toc-text">泛型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%9B%E5%9E%8B%E7%BA%A6%E6%9D%9Fkeyof"><span class="toc-number">15.1.</span> <span class="toc-text">泛型约束keyof</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#tsconfig-json"><span class="toc-number">16.</span> <span class="toc-text">tsconfig.json</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4"><span class="toc-number">17.</span> <span class="toc-text">命名空间</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%89%E6%96%9C%E7%BA%BF%E6%8C%87%E4%BB%A4"><span class="toc-number">18.</span> <span class="toc-text">三斜线指令</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%A3%B0%E6%98%8E%E6%96%87%E4%BB%B6d-ts"><span class="toc-number">19.</span> <span class="toc-text">声明文件d.ts</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Mixins%E6%B7%B7%E5%85%A5"><span class="toc-number">20.</span> <span class="toc-text">Mixins混入</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.</span> <span class="toc-text">装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%B1%BB%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.1.</span> <span class="toc-text">类装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%BF%94%E5%9B%9E%E5%80%BC"><span class="toc-number">21.1.1.</span> <span class="toc-text">返回值</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E5%B7%A5%E5%8E%82"><span class="toc-number">21.2.</span> <span class="toc-text">装饰器工厂</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.3.</span> <span class="toc-text">方法装饰器</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9E%E7%8E%B0GET%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.3.1.</span> <span class="toc-text">实现GET装饰器</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%82%E6%95%B0%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.4.</span> <span class="toc-text">参数装饰器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E8%A3%85%E9%A5%B0%E5%99%A8"><span class="toc-number">21.5.</span> <span class="toc-text">属性装饰器</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%A1%BA%E5%BA%8F"><span class="toc-number">21.6.</span> <span class="toc-text">顺序</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A3%85%E9%A5%B0%E5%99%A8%E6%B1%82%E5%80%BC"><span class="toc-number">21.6.1.</span> <span class="toc-text">装饰器求值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">22.</span> <span class="toc-text">元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9A%E4%B9%89-%E8%8E%B7%E5%8F%96%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">22.1.</span> <span class="toc-text">定义&#x2F;获取元数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%A8%E7%B1%BB%E4%B8%AD%E5%AE%9A%E4%B9%89"><span class="toc-number">22.1.1.</span> <span class="toc-text">在类中定义</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B6%E5%AE%83%E6%96%B9%E6%B3%95"><span class="toc-number">22.2.</span> <span class="toc-text">其它方法</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E5%85%83%E6%95%B0%E6%8D%AE"><span class="toc-number">22.3.</span> <span class="toc-text">内置元数据</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%83%E6%95%B0%E6%8D%AE%E7%9A%84%E7%BB%A7%E6%89%BF"><span class="toc-number">22.4.</span> <span class="toc-text">元数据的继承</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E6%90%AD%E5%BB%BATS%E7%8E%AF%E5%A2%83"><span class="toc-number">23.</span> <span class="toc-text">搭建TS环境</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Rollup"><span class="toc-number">23.1.</span> <span class="toc-text">Rollup</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Webpack"><span class="toc-number">23.2.</span> <span class="toc-text">Webpack</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#esbuild-swc"><span class="toc-number">23.3.</span> <span class="toc-text">esbuild+swc</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%9E%E6%88%98"><span class="toc-number">24.</span> <span class="toc-text">实战</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%81%E8%A3%85LocalStorage"><span class="toc-number">24.1.</span> <span class="toc-text">封装LocalStorage</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F"><span class="toc-number">24.2.</span> <span class="toc-text">发布订阅模式</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Proxy%E3%80%81Reflect"><span class="toc-number">25.</span> <span class="toc-text">Proxy、Reflect</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C"><span class="toc-number">25.1.</span> <span class="toc-text">基本操作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A1%88%E4%BE%8B"><span class="toc-number">25.2.</span> <span class="toc-text">案例</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%85%BC%E5%AE%B9%E6%80%A7"><span class="toc-number">26.</span> <span class="toc-text">类型兼容性</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%8F%E5%8F%98-%E9%B8%AD%E5%AD%90%E7%B1%BB%E5%9E%8B"><span class="toc-number">26.1.</span> <span class="toc-text">协变(鸭子类型)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%86%E5%8F%98"><span class="toc-number">26.2.</span> <span class="toc-text">逆变</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%8C%E5%90%91%E5%8D%8F%E5%8F%98"><span class="toc-number">26.3.</span> <span class="toc-text">双向协变</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#Set-Map"><span class="toc-number">27.</span> <span class="toc-text">Set,Map</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#weakSet-weakMap"><span class="toc-number">27.1.</span> <span class="toc-text">weakSet,weakMap</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%86%85%E7%BD%AE%E9%AB%98%E7%BA%A7%E7%B1%BB%E5%9E%8B"><span class="toc-number">28.</span> <span class="toc-text">内置高级类型</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#Partial"><span class="toc-number">28.1.</span> <span class="toc-text">Partial</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Pick"><span class="toc-number">28.2.</span> <span class="toc-text">Pick</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Readonly"><span class="toc-number">28.3.</span> <span class="toc-text">Readonly</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Record"><span class="toc-number">28.4.</span> <span class="toc-text">Record</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Omit"><span class="toc-number">28.5.</span> <span class="toc-text">Omit</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#ReturnType"><span class="toc-number">28.6.</span> <span class="toc-text">ReturnType</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E7%B1%BB%E5%9E%8B%E5%B7%A5%E5%85%B7"><span class="toc-number">29.</span> <span class="toc-text">类型工具</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8D%A0%E4%BD%8D%E7%AC%A6infer"><span class="toc-number">30.</span> <span class="toc-text">占位符infer</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8F%90%E5%8F%96-%E5%88%A0%E9%99%A4%E5%85%83%E7%B4%A0"><span class="toc-number">30.1.</span> <span class="toc-text">提取&#x2F;删除元素</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%80%92%E5%BD%92"><span class="toc-number">30.2.</span> <span class="toc-text">递归</span></a></li></ol></li></ol></div></div><div class="card-widget card-recommend-post"><div class="item-headline"><i class="fas fa-dharmachakra"></i><span>相关推荐</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/article/55cefeb1.html" title="React-记-3"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" alt="React-记-3"></a><div class="content"><a class="title" href="/article/55cefeb1.html" title="React-记-3">React-记-3</a><time datetime="2024-10-13" title="发表于 2024-10-13">2024-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/f17dfea3.html" title="React-记-2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" alt="React-记-2"></a><div class="content"><a class="title" href="/article/f17dfea3.html" title="React-记-2">React-记-2</a><time datetime="2024-09-26" title="发表于 2024-09-26">2024-09-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/cb488cbf.html" title="React-记-1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" alt="React-记-1"></a><div class="content"><a class="title" href="/article/cb488cbf.html" title="React-记-1">React-记-1</a><time datetime="2024-09-23" title="发表于 2024-09-23">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/d186ebdd.html" title="闭包与内存泄漏"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/103-4.webp" alt="闭包与内存泄漏"></a><div class="content"><a class="title" href="/article/d186ebdd.html" title="闭包与内存泄漏">闭包与内存泄漏</a><time datetime="2024-09-12" title="发表于 2024-09-12">2024-09-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/d22c87fc.html" title="Vue3.5 更新了啥"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/102-0.webp" alt="Vue3.5 更新了啥"></a><div class="content"><a class="title" href="/article/d22c87fc.html" title="Vue3.5 更新了啥">Vue3.5 更新了啥</a><time datetime="2024-09-12" title="发表于 2024-09-12">2024-09-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/93c63660.html" title="Git lint 相关"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/1.webp" alt="Git lint 相关"></a><div class="content"><a class="title" href="/article/93c63660.html" title="Git lint 相关">Git lint 相关</a><time datetime="2024-09-10" title="发表于 2024-09-10">2024-09-10</time></div></div></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最近更新</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/article/1be64a8d.html" title="NestJS实践杂记"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/77-0.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="NestJS实践杂记"/></a><div class="content"><a class="title" href="/article/1be64a8d.html" title="NestJS实践杂记">NestJS实践杂记</a><time datetime="2024-12-09T07:10:08.000Z" title="更新于 2024-12-09 15:10:08">2024-12-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/55cefeb1.html" title="React-记-3"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="React-记-3"/></a><div class="content"><a class="title" href="/article/55cefeb1.html" title="React-记-3">React-记-3</a><time datetime="2024-10-12T17:26:31.000Z" title="更新于 2024-10-13 01:26:31">2024-10-13</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/f17dfea3.html" title="React-记-2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="React-记-2"/></a><div class="content"><a class="title" href="/article/f17dfea3.html" title="React-记-2">React-记-2</a><time datetime="2024-09-26T11:26:24.000Z" title="更新于 2024-09-26 19:26:24">2024-09-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/cb488cbf.html" title="React-记-1"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/104-0.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="React-记-1"/></a><div class="content"><a class="title" href="/article/cb488cbf.html" title="React-记-1">React-记-1</a><time datetime="2024-09-23T13:15:26.000Z" title="更新于 2024-09-23 21:15:26">2024-09-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/article/d186ebdd.html" title="闭包与内存泄漏"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/images/103-4.webp" onerror="this.onerror=null;this.src='https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/404.jpg'" alt="闭包与内存泄漏"/></a><div class="content"><a class="title" href="/article/d186ebdd.html" title="闭包与内存泄漏">闭包与内存泄漏</a><time datetime="2024-09-12T12:04:03.000Z" title="更新于 2024-09-12 20:04:03">2024-09-12</time></div></div></div></div></div></div></main><footer id="footer" style="background: rgba(0, 0, 0, 0);"><div id="footer-wrap"><div id="footer_icon"><div class="icon_left"><a class="icon_link" target="_blank" href="http://foreverblog.cn/go.html" rel="noopener external nofollow" title="虫洞-随机访问十年之约成员博客"><i class="fa-solid fa-circle-notch fa-fw"></i></a><a class="icon_link" target="_blank" href="https://travellings.cn" rel="noopener external nofollow" title="开往-随机跳转到另一个加入开往的网页"><i class="fa-solid fa-subway fa-fw"></i></a><a class="icon_link" href="/link/" title="友链"><i class="fa-solid fa-link fa-fw"></i></a><a class="icon_link" href="/messageboard/" title="留言"><i class="fa-regular fa-comment fa-fw"></i></a></div><img class="footer_logo entered loaded" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/head.webp" onclick="btf.scrollToDest(0,500)" title="返回顶部"/><div class="icon_left"><a class="icon_link" target="_blank" rel="noopener" href="https://www.qcqx.cn/" title="我的主页"><i class="fa-solid fa-compass fa-fw"></i></a><a class="icon_link" target="_blank" href="https://res.abeim.cn/api/qq/?qq=1934009145" rel="noopener external nofollow" title="联系QQ"><i class="fa-brands fa-qq fa-fw"></i></a><a class="icon_link" target="_blank" href="https://github.com/qxchuckle" rel="noopener external nofollow" title="我的Github主页"><i class="fa-brands fa-github fa-fw"></i></a><a class="icon_link" href="mailto:chuckle@chuckle.top" rel="noopener external nofollow" title="邮件联系"><i class="fa-solid fa-envelope fa-fw"></i></a></div></div><div class="copyright">&copy;2022 - 2025 By 『轻笑Chuckle』<a id="beianhao" style="color:#fff;font-size:0.9rem;font-weight:400;" href="https://beian.miit.gov.cn/" target="_blank">粤ICP备2022076449号</a></div><div class="footer_custom_text">『Another branch will grow and flourish in the future』</div><div class="footer-banner"><div id="footer-banner-time"><span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span><script>if(! (navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i))){
function createtime() {
var now = new Date();
var grt= new Date("03/10/2022 00:00:00");
now.setTime(now.getTime()+1000);
days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days);
hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours);
if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum);
mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;}
seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum);
snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;}
document.getElementById("timeDate").innerHTML = "自 2022-3-10 建站以来，小站已苟活 "+dnum+" 天 ";
document.getElementById("times").innerHTML = hnum + " 时 " + mnum + " 分 ( =•ω•= )m";
}
createtime();
if(typeof footer_time == "undefined"){
  var footer_time = setInterval("createtime()",1000*60);
}else{
  clearInterval(footer_time);
  footer_time = setInterval("createtime()",1000*60);
}
}
</script></div></div><p id="ghbdages"><a class="github-badge" target="_blank" href="https://hexo.io/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/hexo.svg"/></a><a class="github-badge" target="_blank" href="https://butterfly.js.org/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/butterfly.svg"/></a><a class="github-badge" target="_blank" href="https://github.com/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/github.svg"/></a><a class="github-badge" target="_blank" href="https://icp.gov.moe/?keyword=20220160" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/20220160.svg"/></a><a class="github-badge" target="_blank" href="https://beian.miit.gov.cn/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/2022076449.svg"/></a><a class="github-badge" target="_blank" href="https://cloud.tencent.com/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/tx.svg"/></a><a class="github-badge" target="_blank" href="https://vercel.com/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/vercel.svg"/></a><a class="github-badge" target="_blank" href="https://tianli-blog.club/jsd/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/tianlicdn.svg"/></a><a class="github-badge" target="_blank" href="https://www.upyun.com/?utm_source=lianmeng&amp;utm_medium=referral" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/ypy.svg"/></a><a class="github-badge" target="_blank" href="http://creativecommons.org/licenses/by-nc-sa/4.0/" style="margin-inline:5px"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/img/cc.svg"/></a></p></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="refresh-cache" type="button" title="刷新缓存" onclick="refreshCache()"><i class="fas fa-refresh fa-spin"></i></button><button id="enlargePage-btn" type="button" title="放大页面" onclick="enlargePage()"><i class="fa fa-plus"></i></button><button id="narrowPage-btn" type="button" title="缩小页面" onclick="narrowPage()"><i class="fa fa-minus"></i></button><button type="button" title="切换背景" onclick="toggleWinbox()"><i class="fa fa-images"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="to_comment" type="button" title="直达评论" onclick="FixedCommentBtn();"><i class="fas fa-comments"></i></button><button id="share-link" type="button" title="分享链接"><i class="fa fa-share-alt"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i><span id="percent">0<span>%</span></span></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">本地搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="fa-solid fa-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="fa-solid fa-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="fa-solid fa-arrow-rotate-right"></i></div><div class="rightMenu-item" id="menu-top"><i class="fa fa-angles-up"></i></div></div><div class="rightMenu-group rightMenu-line hide" id="menu-text"><a class="rightMenu-item" href="javascript:kk.copySelect();"><i class="fa fa-copy"></i><span>复制</span></a><a class="rightMenu-item" href="javascript:window.open(&quot;https://www.baidu.com/s?wd=&quot;+window.getSelection().toString());window.location.reload();"><i class="fa fa-magnifying-glass"></i><span>百度搜索</span></a></div><div class="rightMenu-group rightMenu-line hide" id="menu-read"><a class="rightMenu-item" href="javascript:kk.pasteText();"><i class="fa fa-paste"></i><span>粘贴</span></a></div><div class="rightMenu-group rightMenu-line"><a class="rightMenu-item" id="menu-radompage" href="/"><i class="fa-solid fa-shoe-prints"></i><span>博客主页</span></a><div class="rightMenu-item" id="menu-darkmode"><i class="fa-solid fa-adjust"></i><span>昼夜切换</span></div><div class="rightMenu-item" id="share-chuckle"><i class="fa fa-share-alt"></i><span>分享本页</span></div><a class="rightMenu-item" id="menu-radompage" href="/categories/"><i class="fa fa-archive"></i><span>分类</span></a><a class="rightMenu-item" id="menu-radompage" href="/tags/"><i class="fa fa-tags"></i><span>标签</span></a></div></div><div id="rightmenu-mask" onclick="RemoveRightMenu()"></div><div><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/utils.js"></script><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/main.js?6"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox.umd.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module" defer></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/search/local-search.js?2"></script><script async="async">var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',preloader.endLoading())
setTimeout(function(){preloader.endLoading();}, 2500);</script><div class="js-pjax"><script>function loadWaline () {
  function initWaline () {
    const waline = new Waline(Object.assign({
      el: '#waline-wrap',
      serverURL: 'https://waline.qcqx.cn',
      path: location.pathname,
      visitor: true,
      dark: 'html[data-theme="dark"]'
    }, {"requiredMeta":["nick","mail"],"wordLimit":400,"placeholder":"来评论交流吧，通过邮件通知（表情点不出来请刷新页面）"}))
  }

  if (typeof Waline === 'function') initWaline()
  else getScript('https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/waline.min.js?7').then(initWaline)
}

if ('Waline' === 'Waline' || !false) {
  if (false) btf.loadComment(document.getElementById('waline-wrap'),loadWaline)
  else setTimeout(loadWaline, 0)
} else {
  function loadOtherComment () {
    loadWaline()
  }
}</script></div><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/qx-tracker.min.js?1"></script><script>const tracker = new Tracker({requestUrl:'https://tracker-api.qcqx.cn/api/tracker',historyTracker:true,realTime:true});</script><script defer="true" src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/random.min.js?14"></script><script defer="true" src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/chuckle.js?15"></script><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/chuckle-post-ai.js?11"></script><script defer>new ChucklePostAI({el:'#post>#article-container',key:'tN2jLmG7fX9zHk5dVbQr',title_el:'.post-title',rec_method:'web',whitelist:['article/17d3383a.html'],pjax:true})</script><script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/pjax.min.js"></script><script>let pjaxSelectors = ["title","#config-diff","#body-wrap","#fixedcard-dashboard","#rightside-config-hide","#rightside-config-show",".js-pjax"]

var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {

  // removeEventListener scroll 
  window.tocScrollFn && window.removeEventListener('scroll', window.tocScrollFn)
  window.scrollCollect && window.removeEventListener('scroll', scrollCollect)

  typeof preloader === 'object' && preloader.initLoading()
  document.getElementById('rightside').style.cssText = "opacity: ''; transform: ''"
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')

})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()

  typeof preloader === 'object' && preloader.endLoading()
})

document.addEventListener('pjax:error', (e) => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><div id="fixedcard-dashboard"><button class="fixedcard-activebtn" type="button" title="用户信息" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-info&quot;,&quot;0&quot;)"><i class="fas fa-address-book"></i></button><button class="fixedcard-activebtn" type="button" title="公告" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-announcement&quot;,&quot;0&quot;)"><i class="fa fa-bullhorn"></i></button><button class="fixedcard-activebtn" type="button" title="相关推荐" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-recommend-post&quot;,&quot;0&quot;)"><i class="fas fa-dharmachakra"></i></button><button class="fixedcard-activebtn" type="button" title="最近更新" onclick="FixedCardWidget(&quot;class&quot;,&quot;card-recent-post&quot;,&quot;0&quot;)"><i class="fas fa-history"></i></button><div class="fixedcard-user-avatar fixedcard-activebtn" onclick="RemoveFixedCardWidget()"><img class="fixedcard-user-avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" data-lazy-src="/head.webp" title="『轻笑Chuckle』"></div></div></div><!-- hexo injector body_end start --><script data-pjax>function hope_light_loader_injector_config(){
                var parent_div_git = document.getElementById('body-wrap');
                var item_html = '<div id="loading-bar-wrapper">';
                // parent_div_git.innerHTML=item_html+parent_div_git.innerHTML // 无报错，但不影响使用(支持pjax跳转)
                parent_div_git.insertAdjacentHTML("afterbegin",item_html) // 有报错，但不影响使用(支持pjax跳转)
            }if( document.getElementById('body-wrap') && (location.pathname ==='all'|| 'all' ==='all')){
            hope_light_loader_injector_config()
        } </script>
    <script src="https://cdn.jsdelivr.net/gh/qxchuckle/qxchuckle.github.io/js/nprogress.min.js"></script>
    <script>NProgress.configure({parent:"#loading-bar-wrapper",trickleSpeed: 100})</script></div>
    <script data-pjax>
      window.ShowLoading = function() {
        NProgress.start();
      };
      window.HideLoading = function() {
        NProgress.done();
      }
      document.addEventListener('pjax:send', window.ShowLoading)
      document.addEventListener('pjax:success', window.HideLoading)
      document.addEventListener('pjax:error', window.HideLoading)
    </script>
<!-- hexo injector body_end end --></body></html>