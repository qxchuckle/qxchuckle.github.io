function GetUrlRelativePath(){var e=document.location.toString().split("//"),t=e[1].indexOf("/"),r=e[1].substring(t);return-1!=r.indexOf("?")&&(r=r.split("?")[0]),r}function isInViewPortOfOne(e){const t=window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight;return e.offsetTop-document.documentElement.scrollTop<=t}function initCommentBarrage(){const{Query:e,User:t}=AV;AV.init({appId:commentBarrageConfig.lcAppId,appKey:commentBarrageConfig.lcAppKey,serverURL:commentBarrageConfig.lcUrl});const r=new AV.Query("Comment");r.equalTo("url",GetUrlRelativePath()),r.find().then((e=>{console.log(e);for(var t=0;t<e.length;t++)e[t].attributes.mailMd5=md5(e[t].attributes.mail),commentBarrageConfig.barrageList.push(e[t].attributes)}))}function commentLinkFilter(e){e.sort(((e,t)=>e.created-t.created));let t=[];return e.forEach((e=>{t.push(...getCommentReplies(e))})),t}function getCommentReplies(e){if(e.replies){let t=[e];return e.replies.forEach((e=>{t.push(...getCommentReplies(e))})),t}return[]}function popCommentBarrage(e){let t=document.createElement("div");commentBarrageConfig.dom.clientWidth,commentBarrageConfig.dom.clientHeight;t.className="comment-barrage-item";let r=Math.floor(Math.random()*commentBarrageConfig.lightColors.length);document.getElementById("barragesColor").innerHTML=`[data-theme='light'] .comment-barrage-item { background-color:${commentBarrageConfig.lightColors[r][0]};color:${commentBarrageConfig.lightColors[r][1]}}[data-theme='dark'] .comment-barrage-item{ background-color:${commentBarrageConfig.darkColors[r][0]};color:${commentBarrageConfig.darkColors[r][1]}}`,t.innerHTML=`\n\t\t<div class="barrageHead">\n\t\t\t<img class="barrageAvatar" src="https://cravatar.cn/avatar/${e.mailMd5}?d=${commentBarrageConfig.noAvatarType}"/>\n\t\t\t<div class="barrageNick">${e.nick}</div>\n\t\t\t<a href="javascript:switchCommentBarrage()" style="font-size:20px">Ã—</a>\n\t\t</div>\n\t\t<div class="barrageContent">${e.comment}</div>\n\t`,commentBarrageConfig.barrageTimer.push(t),commentBarrageConfig.dom.append(t)}function removeCommentBarrage(e){e.className="comment-barrage-item out",1!=commentBarrageConfig.maxBarrage?setTimeout((()=>{commentBarrageConfig.dom.removeChild(e)}),1e3):commentBarrageConfig.dom.removeChild(e)}function switchCommentBarrage(){let e=document.querySelector(".comment-barrage");e&&$(e).toggle()}function dmtime(){commentBarrageConfig.barrageList.length&&(popCommentBarrage(commentBarrageConfig.barrageList[commentBarrageConfig.barrageIndex]),commentBarrageConfig.barrageIndex+=1,commentBarrageConfig.barrageIndex%=commentBarrageConfig.barrageList.length),commentBarrageConfig.barrageTimer.length>(commentBarrageConfig.barrageList.length>commentBarrageConfig.maxBarrage?commentBarrageConfig.maxBarrage:commentBarrageConfig.barrageList.length)&&removeCommentBarrage(commentBarrageConfig.barrageTimer.shift())}!function(e){"use strict";function t(e,t){var r=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(r>>16)<<16|65535&r}function r(e,r,n,a,o,m){return t(function(e,t){return e<<t|e>>>32-t}(t(t(r,e),t(a,m)),o),n)}function n(e,t,n,a,o,m,i){return r(t&n|~t&a,e,t,o,m,i)}function a(e,t,n,a,o,m,i){return r(t&a|n&~a,e,t,o,m,i)}function o(e,t,n,a,o,m,i){return r(t^n^a,e,t,o,m,i)}function m(e,t,n,a,o,m,i){return r(n^(t|~a),e,t,o,m,i)}function i(e,r){e[r>>5]|=128<<r%32,e[14+(r+64>>>9<<4)]=r;var i,c,g,l,u,f=1732584193,s=-271733879,d=-1732584194,C=271733878;for(i=0;i<e.length;i+=16)c=f,g=s,l=d,u=C,s=m(s=m(s=m(s=m(s=o(s=o(s=o(s=o(s=a(s=a(s=a(s=a(s=n(s=n(s=n(s=n(s,d=n(d,C=n(C,f=n(f,s,d,C,e[i],7,-680876936),s,d,e[i+1],12,-389564586),f,s,e[i+2],17,606105819),C,f,e[i+3],22,-1044525330),d=n(d,C=n(C,f=n(f,s,d,C,e[i+4],7,-176418897),s,d,e[i+5],12,1200080426),f,s,e[i+6],17,-1473231341),C,f,e[i+7],22,-45705983),d=n(d,C=n(C,f=n(f,s,d,C,e[i+8],7,1770035416),s,d,e[i+9],12,-1958414417),f,s,e[i+10],17,-42063),C,f,e[i+11],22,-1990404162),d=n(d,C=n(C,f=n(f,s,d,C,e[i+12],7,1804603682),s,d,e[i+13],12,-40341101),f,s,e[i+14],17,-1502002290),C,f,e[i+15],22,1236535329),d=a(d,C=a(C,f=a(f,s,d,C,e[i+1],5,-165796510),s,d,e[i+6],9,-1069501632),f,s,e[i+11],14,643717713),C,f,e[i],20,-373897302),d=a(d,C=a(C,f=a(f,s,d,C,e[i+5],5,-701558691),s,d,e[i+10],9,38016083),f,s,e[i+15],14,-660478335),C,f,e[i+4],20,-405537848),d=a(d,C=a(C,f=a(f,s,d,C,e[i+9],5,568446438),s,d,e[i+14],9,-1019803690),f,s,e[i+3],14,-187363961),C,f,e[i+8],20,1163531501),d=a(d,C=a(C,f=a(f,s,d,C,e[i+13],5,-1444681467),s,d,e[i+2],9,-51403784),f,s,e[i+7],14,1735328473),C,f,e[i+12],20,-1926607734),d=o(d,C=o(C,f=o(f,s,d,C,e[i+5],4,-378558),s,d,e[i+8],11,-2022574463),f,s,e[i+11],16,1839030562),C,f,e[i+14],23,-35309556),d=o(d,C=o(C,f=o(f,s,d,C,e[i+1],4,-1530992060),s,d,e[i+4],11,1272893353),f,s,e[i+7],16,-155497632),C,f,e[i+10],23,-1094730640),d=o(d,C=o(C,f=o(f,s,d,C,e[i+13],4,681279174),s,d,e[i],11,-358537222),f,s,e[i+3],16,-722521979),C,f,e[i+6],23,76029189),d=o(d,C=o(C,f=o(f,s,d,C,e[i+9],4,-640364487),s,d,e[i+12],11,-421815835),f,s,e[i+15],16,530742520),C,f,e[i+2],23,-995338651),d=m(d,C=m(C,f=m(f,s,d,C,e[i],6,-198630844),s,d,e[i+7],10,1126891415),f,s,e[i+14],15,-1416354905),C,f,e[i+5],21,-57434055),d=m(d,C=m(C,f=m(f,s,d,C,e[i+12],6,1700485571),s,d,e[i+3],10,-1894986606),f,s,e[i+10],15,-1051523),C,f,e[i+1],21,-2054922799),d=m(d,C=m(C,f=m(f,s,d,C,e[i+8],6,1873313359),s,d,e[i+15],10,-30611744),f,s,e[i+6],15,-1560198380),C,f,e[i+13],21,1309151649),d=m(d,C=m(C,f=m(f,s,d,C,e[i+4],6,-145523070),s,d,e[i+11],10,-1120210379),f,s,e[i+2],15,718787259),C,f,e[i+9],21,-343485551),f=t(f,c),s=t(s,g),d=t(d,l),C=t(C,u);return[f,s,d,C]}function c(e){var t,r="",n=32*e.length;for(t=0;t<n;t+=8)r+=String.fromCharCode(e[t>>5]>>>t%32&255);return r}function g(e){var t,r=[];for(r[(e.length>>2)-1]=void 0,t=0;t<r.length;t+=1)r[t]=0;var n=8*e.length;for(t=0;t<n;t+=8)r[t>>5]|=(255&e.charCodeAt(t/8))<<t%32;return r}function l(e){var t,r,n="";for(r=0;r<e.length;r+=1)t=e.charCodeAt(r),n+="0123456789abcdef".charAt(t>>>4&15)+"0123456789abcdef".charAt(15&t);return n}function u(e){return unescape(encodeURIComponent(e))}function f(e){return function(e){return c(i(g(e),8*e.length))}(u(e))}function s(e,t){return function(e,t){var r,n,a=g(e),o=[],m=[];for(o[15]=m[15]=void 0,a.length>16&&(a=i(a,8*e.length)),r=0;r<16;r+=1)o[r]=909522486^a[r],m[r]=1549556828^a[r];return n=i(o.concat(g(t)),512+8*t.length),c(i(m.concat(n),640))}(u(e),u(t))}function d(e,t,r){return t?r?s(t,e):function(e,t){return l(s(e,t))}(t,e):r?f(e):function(e){return l(f(e))}(e)}"function"==typeof define&&define.amd?define((function(){return d})):"object"==typeof module&&module.exports?module.exports=d:e.md5=d}(this),commentBarrageConfig={lightColors:[["var(--lyx-white-acrylic2)","var(--lyx-black)"]],darkColors:[["var(--lyx-black-acrylic2)","var(--lyx-white)"]],maxBarrage:2,barrageTime:3e3,lcAppId:"pDKVDnXh7GbECgaaQijn1q9l-MdYXbMMI",lcAppKey:"S2yx40LyEmvoov91aGwcxUPG",lcUrl:"https://leancloud.chuckle.top",pageUrl:window.location.pathname,barrageTimer:[],barrageList:[],barrageIndex:0,noAvatarType:"retro",dom:document.querySelector(".comment-barrage")},document.onscroll=function(){isInViewPortOfOne(document.getElementById("post-comment"))?document.getElementsByClassName("comment-barrage")[0].setAttribute("style","display:none;"):document.getElementsByClassName("comment-barrage")[0].setAttribute("style","")},clearInterval(functime),initCommentBarrage();var functime=setInterval("dmtime()",3e3);